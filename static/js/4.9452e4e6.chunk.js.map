{"version":3,"sources":["../node_modules/d3-shape/src/link/index.js","../node_modules/d3-shape/src/pointRadial.js","general/Search/SearchDropDownControlled.js","../node_modules/lodash/mapValues.js","general/MiniInfoBox/MiniInfoBox.js","visualizations/Realismo/utils.js","visualizations/Realismo/CircleWorms.js","visualizations/Realismo/WormDetail.js","visualizations/Realismo/RealismoMain.js"],"names":["linkSource","d","source","linkTarget","target","link","curve","x","pointX","y","pointY","context","buffer","argv","slice","call","arguments","s","apply","this","t","path","_","length","constant","curveVertical","x0","y0","x1","y1","moveTo","bezierCurveTo","linkVertical","Math","cos","PI","sin","Search","props","maxTokens","selectedOptions","className","style","fontSize","position","top","ref","typeahead","multiple","onChange","selected","selectedGroups","groupBy","value","dupes","Object","keys","filter","newSelected","item","indexOf","changeOptions","disabled","onInputChange","options","data","id","filterBy","option","text","label","toLowerCase","renderMenu","results","menuProps","map","result","index","isSelected","key","renderMenuItemChildren","idx","selectedValues","search","renderToken","onRemove","tabIndex","onClick","focus","Component","defaultProps","gridColumn","baseAssignValue","require","baseForOwn","baseIteratee","module","exports","object","iteratee","MiniInfoBox","children","onClose","realismoDataNormalized","realismoData","startNorm","start","endNorm","end","locationNorm","yearsExtent","extent","year","Date","racconti","uniqBy","title","volume","volume_primo","dataset","maxLength","max","Boolean","detailWormsCircles","mapValues","dataFilled","reduce","filledWithCream","calv0","i","push","level","occurrence_location","Number","ghost","prevCalvix","lastData","startTotalNorm","endTotalNorm","locationTotalNorm","lengthTotalNorm","intersectionCircleItem","colorScale","scaleOrdinal","range","domain","unknown","uniqueYears","sort","unitDeg","acc","lastRotation","LEGEND_SIZE","raccontiDegs","racconto","rotation","byYear","yearsArcs","startAngleDeg","startAngle","endAngle","angleLabel","calculateDegs","arcGenerator","arc","Worm","React","memo","circles","radius","labelSize","wormSize","isOmitted","wormStart","size","flipText","circleRadius","animationDelays","animationGroups","opacity","cursor","undefined","circle","cx","movement","delay","direction","category","transformOrigin","animationDelay","r","cy","place","fill","CicrleYears","wormEnd","flipTextStyle","transform","alignmentBaseline","width","height","radiusStrokeSize","yearArc","textX","textAnchor","outerRadius","innerRadius","Legend","endLineStart","endLineEnd","y2","x2","stroke","strokeWidth","CircleWorms","heightCircle","circlesMap","omitted","raccontiJoinLines","toggleSelect","handleClick","useCallback","selectedKeys","allSelected","INNER_CIRCLE_STROKE_WIDTH","paddingTop","offset","stopColor","type","slope","pointAX","pointAY","pointBX","pointBY","strokeDasharray","angle","yScale","makeItemFill","color","makeItemGradientUrl","n","totalLabelX","ghostWorm","allWidth","CHART_PADDING_X","dataWorms","useMemo","xLocation","labalesData","dataForLabels","dataWormsLabeled","mul","linePath","levelsData","dataLevelWorms","hasData","dataLabel","totalLength","margin","marginLeft","attributeName","values","dur","repeatCount","datum","rx","ry","MINI_RADIUS","occurrence","circleWidth","out","interectionItems","sortBy","reverse","searchOptionsTitolo","searchOptionsVolume","keyByTitolo","volumeLabel","titoliByVolume","optionsMovimento","optionsSpace","cercaOptions","RealismoMain","useState","helpSidePanelOpen","setHelpSidePanelOpen","toggleHelpSidePanel","a","findFor","setFindFor","ricerca","setRicerca","helpPage","GlobalData","helpPages","plot","main","useDimensions","liveMeasure","refCirlce","movimento","setMovimento","spazio","setSpazio","timeFilter","setTimeFilter","spazioLabels","omittedStuff","spazioValues","forEach","titolo","keep","some","every","categories","getFullYear","mapSelected","volumeSelected","newRicerca","concat","selctedTitoliSorted","ricercaTitoli","leftRacconti","rightRacconti","lineHeightRight","lineHeightLeft","abs","REALISMO_DIAMETER","HelpSidePanel","open","page","closeButtonClicked","MainMenu","PageTitle","AltOptions","newOptions","MoreInfo","onClicked","CompassButton","backgroundColor","lineHeight","allowEmpty","m","textAlign","RangeFilter","timeSpan"],"mappings":"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","file":"static/js/4.9452e4e6.chunk.js","sourcesContent":["import {path} from \"d3-path\";\nimport {slice} from \"../array.js\";\nimport constant from \"../constant.js\";\nimport {x as pointX, y as pointY} from \"../point.js\";\nimport pointRadial from \"../pointRadial.js\";\n\nfunction linkSource(d) {\n  return d.source;\n}\n\nfunction linkTarget(d) {\n  return d.target;\n}\n\nfunction link(curve) {\n  var source = linkSource,\n      target = linkTarget,\n      x = pointX,\n      y = pointY,\n      context = null;\n\n  function link() {\n    var buffer, argv = slice.call(arguments), s = source.apply(this, argv), t = target.apply(this, argv);\n    if (!context) context = buffer = path();\n    curve(context, +x.apply(this, (argv[0] = s, argv)), +y.apply(this, argv), +x.apply(this, (argv[0] = t, argv)), +y.apply(this, argv));\n    if (buffer) return context = null, buffer + \"\" || null;\n  }\n\n  link.source = function(_) {\n    return arguments.length ? (source = _, link) : source;\n  };\n\n  link.target = function(_) {\n    return arguments.length ? (target = _, link) : target;\n  };\n\n  link.x = function(_) {\n    return arguments.length ? (x = typeof _ === \"function\" ? _ : constant(+_), link) : x;\n  };\n\n  link.y = function(_) {\n    return arguments.length ? (y = typeof _ === \"function\" ? _ : constant(+_), link) : y;\n  };\n\n  link.context = function(_) {\n    return arguments.length ? ((context = _ == null ? null : _), link) : context;\n  };\n\n  return link;\n}\n\nfunction curveHorizontal(context, x0, y0, x1, y1) {\n  context.moveTo(x0, y0);\n  context.bezierCurveTo(x0 = (x0 + x1) / 2, y0, x0, y1, x1, y1);\n}\n\nfunction curveVertical(context, x0, y0, x1, y1) {\n  context.moveTo(x0, y0);\n  context.bezierCurveTo(x0, y0 = (y0 + y1) / 2, x1, y0, x1, y1);\n}\n\nfunction curveRadial(context, x0, y0, x1, y1) {\n  var p0 = pointRadial(x0, y0),\n      p1 = pointRadial(x0, y0 = (y0 + y1) / 2),\n      p2 = pointRadial(x1, y0),\n      p3 = pointRadial(x1, y1);\n  context.moveTo(p0[0], p0[1]);\n  context.bezierCurveTo(p1[0], p1[1], p2[0], p2[1], p3[0], p3[1]);\n}\n\nexport function linkHorizontal() {\n  return link(curveHorizontal);\n}\n\nexport function linkVertical() {\n  return link(curveVertical);\n}\n\nexport function linkRadial() {\n  var l = link(curveRadial);\n  l.angle = l.x, delete l.x;\n  l.radius = l.y, delete l.y;\n  return l;\n}\n","export default function(x, y) {\n  return [(y = +y) * Math.cos(x -= Math.PI / 2), y * Math.sin(x)];\n}\n","import React, { Component, createRef } from \"react\";\nimport \"../../App.css\";\nimport \"./SearchDropDown.css\";\nimport {\n  Typeahead,\n  Token,\n  Highlighter,\n  Menu,\n  MenuItem\n} from \"react-bootstrap-typeahead\";\nimport \"react-bootstrap-typeahead/css/Typeahead.css\";\nimport \"react-bootstrap-typeahead/css/Typeahead-bs4.css\";\nimport groupBy from \"lodash/groupBy\";\n\nconst renderToken = (option, props, idx) => (\n  <Token\n    disabled={props.disabled}\n    key={idx}\n    onRemove={props.onRemove}\n    tabIndex={props.tabIndex}\n  >\n    {option.label}\n  </Token>\n);\n\nconst renderMenuItemChildren = (option, props, idx, selectedValues) => {\n\n  return (\n    <Highlighter search={props.text} key={idx}>\n      {option.label}\n    </Highlighter>\n  );\n};\n\nclass Search extends Component {\n  render() {\n    let isSelection = false;\n    const { maxTokens, selectedOptions } = this.props;\n\n    return (\n      <div className=\"search-component\" style={this.props.style}>\n        {!isSelection && (\n          <span style={{ fontSize: \"1rem\", position: \"relative\", top: \"-3px\" }}>\n            /\n          </span>\n        )}\n        <Typeahead\n          ref={typeahead => (this.typeahead = typeahead)}\n          multiple\n          onChange={selected => {\n            const selectedGroups = groupBy(selected, x => x.value);\n            const dupes = Object.keys(selectedGroups).filter(\n              x => selectedGroups[x].length > 1\n            );\n            const newSelected = selected.filter(\n              item => dupes.indexOf(item.value) === -1\n            );\n            this.props.changeOptions(newSelected);\n          }}\n          selected={selectedOptions}\n          disabled={false}\n          onInputChange={this.props.onInputChange}\n          options={this.props.data.options}\n          id=\"main-search\"\n          filterBy={(option, props) => {\n            if (!props.text) {\n              return option;\n            }\n            return option.label.toLowerCase().indexOf(props.text.toLowerCase()) !== -1 ? option : null;\n          }}\n          renderMenu={(results, menuProps) => (\n            <Menu {...menuProps} className=\"rbt-menu-container\">\n              {results.map((result, index) => {\n                const isSelected =\n                selectedOptions.map(x => x.value).indexOf(result.value) !== -1;\n                return (\n                  <MenuItem\n                    key={index}\n                    option={result}\n                    position={index}\n                    className={`dropdown-item-selectable ${isSelected ? 'selected' : ''}`}\n                  >\n                    {result.label}\n                  </MenuItem>\n                );\n              })}\n            </Menu>\n          )}\n          renderMenuItemChildren={(option, props, idx) =>\n            renderMenuItemChildren(option, props, idx, selectedOptions)\n          }\n          renderToken={(option, props, index) => {\n            if (selectedOptions.length - index - 1 < maxTokens) {\n              return renderToken(option, props, index)\n            } else if (selectedOptions.length - index - 1 === maxTokens) {\n              return (\n                <span key={index} className=\"rbt-token\" onClick={() => this.typeahead.focus()}>\n                  +{selectedOptions.length - maxTokens}\n                </span>\n              )\n            } else {\n              return null\n            }\n          }}\n        />\n      </div>\n    );\n  }\n}\n\nexport default Search;\n\nSearch.defaultProps = {\n  maxTokens: 2,\n  style: {\n    gridColumn: \"span 4\"\n  }\n};\n","var baseAssignValue = require('./_baseAssignValue'),\n    baseForOwn = require('./_baseForOwn'),\n    baseIteratee = require('./_baseIteratee');\n\n/**\n * Creates an object with the same keys as `object` and values generated\n * by running each own enumerable string keyed property of `object` thru\n * `iteratee`. The iteratee is invoked with three arguments:\n * (value, key, object).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Object\n * @param {Object} object The object to iterate over.\n * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n * @returns {Object} Returns the new mapped object.\n * @see _.mapKeys\n * @example\n *\n * var users = {\n *   'fred':    { 'user': 'fred',    'age': 40 },\n *   'pebbles': { 'user': 'pebbles', 'age': 1 }\n * };\n *\n * _.mapValues(users, function(o) { return o.age; });\n * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)\n *\n * // The `_.property` iteratee shorthand.\n * _.mapValues(users, 'age');\n * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)\n */\nfunction mapValues(object, iteratee) {\n  var result = {};\n  iteratee = baseIteratee(iteratee, 3);\n\n  baseForOwn(object, function(value, key, object) {\n    baseAssignValue(result, key, iteratee(value, key, object));\n  });\n  return result;\n}\n\nmodule.exports = mapValues;\n","import React from 'react'\nimport './MiniInfoBox.css'\n\nexport default function MiniInfoBox({ children, onClose, style }) {\n  return (\n    <div className=\"MiniInfoBox\" style={style}>\n      <div className=\"MiniInfoBox-start\">{children}</div>\n      <div className=\"MiniInfoBox-end\" onClick={onClose}>\n        &times;\n      </div>\n    </div>\n  )\n}\n","import realismoData from './data/realismo.json'\nimport groupBy from 'lodash/groupBy'\nimport uniqBy from 'lodash/uniqBy'\nimport { scaleOrdinal } from 'd3-scale'\nimport range from 'lodash/range'\nimport find from 'lodash/find'\nimport mapValues from 'lodash/mapValues'\nimport { extent } from 'd3-array'\nimport { sortBy } from 'lodash'\n\nconst realismoDataNormalized = realismoData.map((item) => ({\n  ...item,\n  startNorm: +item.start / item.length,\n  endNorm: +item.end / item.length,\n  locationNorm: +item['occurrence_location'] / +item.length,\n}))\n\nexport const yearsExtent = extent(realismoData, (d) => +d.year).map(\n  (y) => new Date(y, 0)\n)\n\nexport const racconti = uniqBy(realismoData, 'title').map((item) => ({\n  title: item.title,\n  length: item.length,\n  year: +item.year,\n  volume: item.volume_primo,\n}))\n\nexport const dataset = groupBy(realismoDataNormalized, 'title')\n\nconst maxLength = Math.max(\n  ...realismoData.map((d) => +d.length).filter(Boolean)\n)\nexport const detailWormsCircles = mapValues(dataset, (data) => {\n  // Fill the pie\n  const dataFilled = data.reduce((filledWithCream, calv0, i) => {\n    if (i === 0) {\n      // We are about to start\n      if (+calv0.start > 0) {\n        // The first piece of our story start from n0000where\n        // filled the start\n        filledWithCream.push({\n          ...calv0,\n          level: 0,\n          occurrence_location: 0,\n          start: 0,\n          end: Number(calv0.start) - 1,\n          ghost: true,\n        })\n      }\n    } else {\n      // Rewind back 2 prev\n      const prevCalvix = data[i - 1]\n      if (calv0.start > Number(prevCalvix.end) + 1) {\n        filledWithCream.push({\n          ...calv0,\n          level: 0,\n          occurrence_location: Number(prevCalvix.end) + 1,\n          start: Number(prevCalvix.end) + 1,\n          end: Number(calv0.start) - 1,\n          ghost: true,\n        })\n      }\n    }\n    // Add item\n    filledWithCream.push(calv0)\n    return filledWithCream\n  }, [])\n  if (dataFilled.length > 0) {\n    const lastData = dataFilled[dataFilled.length - 1]\n    if (lastData.end < lastData.length) {\n      dataFilled.push({\n        ...lastData,\n        level: 0,\n        occurrence_location: lastData.end + 1,\n        start: lastData.end + 1,\n        end: lastData.length,\n        ghost: true,\n      })\n    }\n  }\n\n  return dataFilled.map((item) => ({\n    ...item,\n    startTotalNorm: +item.start / maxLength,\n    endTotalNorm: +item.end / maxLength,\n    locationTotalNorm: +item['occurrence_location'] / maxLength,\n    lengthTotalNorm: +item.length / maxLength,\n  }))\n})\n\nfunction intersectionCircleItem(item, startNorm, endNorm) {\n  if (endNorm < item.startNorm) {\n    return 0\n  }\n  if (startNorm > item.endNorm) {\n    return 0\n  }\n  const diffStart = Math.max(0, item.startNorm - startNorm)\n  const diffEnd = Math.max(0, endNorm - item.endNorm)\n\n  return endNorm - startNorm - diffStart - diffEnd\n}\n\nexport function datasetToCircles(n) {\n  return mapValues(dataset, (data) => {\n    const circleWidth = 1 / n\n\n    const circles = range(n).reduce((acc, item, i) => {\n      const startNorm = i * circleWidth\n      const endNorm = (i + 1) * circleWidth\n      let interectionItems = sortBy(data, (item) =>\n        intersectionCircleItem(item, startNorm, endNorm)\n      ).reverse()\n      let out\n      if (\n        interectionItems.length > 0 &&\n        intersectionCircleItem(interectionItems[0], startNorm, endNorm) > 0\n      ) {\n        out = interectionItems[0]\n      } else {\n        out = {}\n      }\n      let place = false\n      if (\n        out.occurrence &&\n        out.locationNorm >= startNorm &&\n        out.locationNorm <= endNorm\n      ) {\n        place = true\n      }\n      acc.push({ ...out, place })\n      return acc\n    }, [])\n\n    return circles\n  })\n}\n\nexport const colorScale = scaleOrdinal()\n  .range(['#ffc33e', '#00c97c', '#4a4aff'])\n  .domain(['indoor', 'outdoor', 'transportation'])\n  .unknown(['#ccc'])\n\nconst GAP_SIZE = 1\nexport const LEGEND_SIZE = 10\n\nfunction calculateDegs() {\n  const uniqueYears = uniqBy(racconti, (item) => item.year)\n    .map((x) => x.year)\n    .sort()\n\n  const numGaps = uniqueYears.reduce((acc, year, i) => {\n    if (i > 0) {\n      return acc + year - uniqueYears[i - 1]\n    }\n    return acc\n  }, 0)\n  const unitDeg = (360 - LEGEND_SIZE - numGaps * GAP_SIZE) / racconti.length\n\n  let lastRotation = LEGEND_SIZE / 2 + unitDeg / 2\n  const raccontiDegs = racconti.map((racconto, i) => {\n    if (i > 0) {\n      lastRotation =\n        lastRotation +\n        unitDeg +\n        (racconto.year - racconti[i - 1].year) * GAP_SIZE\n    }\n    return {\n      ...racconto,\n      rotation: lastRotation - 90,\n    }\n  })\n\n  const byYear = groupBy(raccontiDegs, 'year')\n  const yearsArcs = uniqueYears.map((year) => {\n    const data = byYear[year]\n    const startAngleDeg = data[0].rotation + 90 - unitDeg / 2\n    const startAngle = (startAngleDeg / 360) * (2 * Math.PI)\n\n    const endAngle =\n      ((data[data.length - 1].rotation + 90 + unitDeg / 2) / 360) *\n      (2 * Math.PI)\n\n    return {\n      startAngle,\n      angleLabel: startAngleDeg + unitDeg - 90 + unitDeg / 2,\n      endAngle,\n      year,\n    }\n  })\n\n  return { raccontiDegs, yearsArcs }\n}\n\nexport const { raccontiDegs, yearsArcs } = calculateDegs()\n","import React, { useCallback } from 'react'\nimport { colorScale, yearsArcs } from './utils'\nimport { scaleLinear } from 'd3-scale'\nimport { arc } from 'd3'\n\nconst LABEL_VISIBLE_SIZE = 0\nconst LABEL_SIZE_PERCENT = 0\nconst WORM_SIZE_PERCENT = 0.55\nconst LABEL_PADDING = 10\nconst INNER_CIRCLE_PADDING = 10\nconst INNER_CIRCLE_STROKE_WIDTH = 5\nconst LEGEND_TEXT_MARGIN = 3\n\nconst arcGenerator = arc()\n\nconst Worm = React.memo(\n  ({\n    racconto,\n    circles,\n    radius,\n    labelSize,\n    wormSize,\n    onClick,\n    isSelected,\n    isOmitted,\n    size,\n    flipText = false,\n  }) => {\n    const wormStart = radius - labelSize - wormSize - LABEL_PADDING\n    const wormEnd = radius - labelSize\n\n    const circleRadius = wormSize / circles.length / 2\n\n    //var for animations delays\n    const animationDelays = circles.reduce((acc, item) => {\n      if (!acc[item.occurrence_location]) {\n        acc[item.occurrence_location] = 1\n      }\n      acc[item.occurrence_location] += 1\n      return acc\n    }, {})\n\n    const animationGroups = {}\n\n    return (\n      <g\n        style={{\n          opacity: isSelected ? 1 : 0.3,\n        }}\n      >\n        <title>{racconto.title}</title>\n        <g\n          onClick={() => {\n            if (!isOmitted) {\n              onClick(racconto)\n            }\n          }}\n          style={{\n            cursor: isOmitted ? undefined : 'pointer',\n          }}\n        >\n          {circles.map((circle, i) => {\n            const cx = wormStart + i * circleRadius * 2 + circleRadius\n            const cy = 0\n\n            if (circle.movement === 'TRUE') {\n              animationGroups[circle.occurrence_location] =\n                animationGroups[circle.occurrence_location] === undefined\n                  ? 0\n                  : animationGroups[circle.occurrence_location] + 1\n            }\n\n            const delay =\n              circle.direction === 'forward'\n                ? animationGroups[circle.occurrence_location] * 0.2\n                : (animationDelays[circle.occurrence_location] -\n                    animationGroups[circle.occurrence_location]) *\n                  0.2\n\n            return (\n              <g key={i}>\n                <circle\n                  className={`${\n                    circle.movement === 'TRUE' && !isOmitted ? 'movement' : ''\n                  } fill-realismo-circle-${circle.category ?? 'unknown'}`}\n                  style={{\n                    // fill: colorScale(circle.category),\n                    transformOrigin: `${cx}px ${cy}px`,\n                    animationDelay: `${delay}s`,\n                  }}\n                  r={isOmitted ? circleRadius * 0.5 : circleRadius * 1.5}\n                  cy={cy}\n                  cx={cx}\n                ></circle>\n                {circle.place && (\n                  <circle\n                    style={{ fill: '#fff' }}\n                    r={circleRadius / 3}\n                    cy={cy}\n                    cx={cx}\n                  ></circle>\n                )}\n              </g>\n            )\n          })}\n        </g>\n      </g>\n    )\n  }\n)\n\nconst WormLabel = React.memo(\n  ({\n    racconto,\n    circles,\n    radius,\n    labelSize,\n    wormSize,\n    onClick,\n    isSelected,\n    isOmitted,\n    size,\n    flipText = false,\n  }) => {\n    const wormStart = radius - labelSize - wormSize - LABEL_PADDING\n    const wormEnd = radius - labelSize\n\n    const circleRadius = wormSize / circles.length / 2\n    const flipTextStyle = flipText\n      ? {\n          transform: 'rotate(180deg)',\n          transformOrigin: `${wormEnd}px 0px`,\n        }\n      : undefined\n\n    return (\n      <g\n        className={`worm-label-container${flipText ? '-flipped' : ''}`}\n        style={{\n          opacity: isSelected ? 1 : 0.3,\n        }}\n      >\n        <g style={flipTextStyle}>\n          <text\n            style={{ alignmentBaseline: 'middle' }}\n            x={wormEnd - (flipText ? LABEL_VISIBLE_SIZE : 0)}\n          >\n            {racconto.title}\n          </text>\n        </g>\n        <g>\n          {!flipText && (\n            <rect\n              className=\"worm-label-gradient-rect\"\n              x={wormEnd + LABEL_VISIBLE_SIZE}\n              y={-7}\n              width={size / 2 - wormSize}\n              height={14}\n              fill=\"url(#label-gradient)\"\n            />\n          )}\n          {flipText && (\n            <rect\n              className=\"worm-label-gradient-rect\"\n              x={30}\n              y={-7}\n              width={wormEnd}\n              height={14}\n              fill=\"url(#label-gradient-flip)\"\n            />\n          )}\n        </g>\n      </g>\n    )\n  }\n)\n\nconst CicrleYears = React.memo(({ x, y, radius, radiusStrokeSize }) => {\n  return (\n    <g transform={`translate(${x}, ${y})`}>\n      {yearsArcs.map((yearArc) => {\n        const flipText = yearArc.angleLabel >= 90 && yearArc.angleLabel <= 270\n        const textX = radius - radiusStrokeSize\n        return (\n          <g key={yearArc.year}>\n            <g style={{ transform: `rotate(${yearArc.angleLabel}deg)` }}>\n              <text\n                textAnchor={flipText ? 'start' : 'end'}\n                x={textX}\n                y={0}\n                style={{\n                  transformOrigin: `${textX}px -3px`,\n                  transform: flipText ? 'rotate(180deg)' : undefined,\n                  fontSize: 10,\n                }}\n              >\n                {yearArc.year}\n              </text>\n            </g>\n            <path\n              style={{ fill: '#ddd' }}\n              d={arcGenerator({\n                ...yearArc,\n                outerRadius: radius - radiusStrokeSize / 2,\n                innerRadius: radius + radiusStrokeSize / 2,\n              })}\n            />\n          </g>\n        )\n      })}\n    </g>\n  )\n})\n\nconst Legend = React.memo(\n  ({ labelSize, x, wormSize, endLineStart, endLineEnd }) => {\n    return (\n      <g>\n        <line\n          y1={0}\n          y2={labelSize}\n          x1={x}\n          x2={x}\n          stroke=\"black\"\n          strokeWidth={2}\n        />\n        {/* <text\n          x={x}\n          y={labelSize - LEGEND_TEXT_MARGIN}\n          className=\"realismo-legend-text\"\n          style={{\n            transformOrigin: `${x}px ${labelSize}px`,\n            transform: 'rotate(270deg)',\n          }}\n        >\n          TITOLO\n        </text> */}\n        <line\n          y1={labelSize + LABEL_PADDING}\n          y2={labelSize + LABEL_PADDING + wormSize}\n          x1={x}\n          x2={x}\n          stroke=\"black\"\n          strokeWidth={2}\n        />\n        <text\n          x={x}\n          y={labelSize + LABEL_PADDING - LEGEND_TEXT_MARGIN}\n          className=\"realismo-legend-text\"\n          textAnchor={'end'}\n          style={{\n            transformOrigin: `${x}px ${labelSize + LABEL_PADDING}px`,\n            transform: 'rotate(270deg)',\n          }}\n        >\n          FINE\n        </text>\n        <text\n          x={x}\n          y={labelSize + LABEL_PADDING + wormSize - LEGEND_TEXT_MARGIN}\n          className=\"realismo-legend-text\"\n          textAnchor={'start'}\n          style={{\n            transformOrigin: `${x}px ${labelSize + LABEL_PADDING + wormSize}px`,\n            transform: 'rotate(270deg)',\n          }}\n        >\n          INIZIO DEL TESTO\n        </text>\n\n        <line\n          y1={endLineStart}\n          y2={endLineEnd}\n          x1={x}\n          x2={x}\n          stroke=\"black\"\n          strokeWidth={2}\n        />\n        <g\n          style={{\n            transform: `translate(${x - 14}px, ${endLineEnd}px) rotate(270deg)`,\n          }}\n        >\n          <text\n            x={0}\n            y={0}\n            className=\"realismo-legend-text\"\n            textAnchor={'start'}\n          >\n            ANNO PRIMA\n          </text>\n          <text\n            x={0}\n            y={10}\n            className=\"realismo-legend-text\"\n            textAnchor={'start'}\n          >\n            PUBBLICAZIONE\n          </text>\n        </g>\n      </g>\n    )\n  }\n)\n\nexport default function CircleWorms({\n  heightCircle,\n  radius,\n  circlesMap,\n  selected,\n  omitted,\n  racconti,\n  raccontiJoinLines,\n  toggleSelect,\n}) {\n  const size = radius * 2\n  const handleClick = useCallback(\n    (racconto) => {\n      toggleSelect(racconto.title)\n    },\n    [toggleSelect]\n  )\n\n  const selectedKeys = Object.keys(selected)\n  const allSelected = selectedKeys.length === 0\n\n  const labelSize = (size / 2) * LABEL_SIZE_PERCENT\n  const wormSize = (size / 2) * WORM_SIZE_PERCENT\n  const innerRadius =\n    size / 2 - labelSize - wormSize - LABEL_PADDING - INNER_CIRCLE_PADDING\n\n  const endLineStart =\n    labelSize +\n    LABEL_PADDING +\n    wormSize +\n    INNER_CIRCLE_PADDING -\n    INNER_CIRCLE_STROKE_WIDTH / 2\n  const endLineEnd = endLineStart + 90\n\n  const paddingTop = (heightCircle - size) / 2\n\n  // 0 - 90\n  return (\n    <svg width={size + 200} height={heightCircle}>\n      <defs>\n        <linearGradient id=\"label-gradient\">\n          <stop offset=\"0%\" stopColor=\"rgba(255, 255, 255, 0)\"></stop>\n          <stop offset=\"10%\" stopColor=\"var(--bg)\"></stop>\n        </linearGradient>\n        <linearGradient id=\"label-gradient-flip\">\n          <stop offset=\"90%\" stopColor=\"var(--bg)\"></stop>\n          <stop offset=\"100%\" stopColor=\"rgba(255, 255, 255, 0)\"></stop>\n        </linearGradient>\n        <filter id=\"brightness\">\n          <feComponentTransfer>\n            <feFuncR type=\"linear\" slope=\"1.2\" />\n            <feFuncG type=\"linear\" slope=\"1.2\" />\n            <feFuncB type=\"linear\" slope=\"1.2\" />\n          </feComponentTransfer>\n        </filter>\n      </defs>\n\n      <g transform={`translate(${size / 2 + 100}, ${size / 2 + paddingTop})`}>\n        {selectedKeys.map((title) => {\n          const {\n            x1,\n            y1,\n            x2,\n            y2,\n            pointAX,\n            pointAY,\n            pointBX,\n            pointBY,\n          } = raccontiJoinLines[title]\n          return (\n            <g key={title}>\n              {/* <line x1={x1} y1={y1} x2={x2} y2={y2} fill=\"red\" stroke=\"red\" />\n              <circle cx={pointAX} cy={pointAY} r={5} fill={'blue'} />\n              <circle cx={pointBX} cy={pointBY} r={5} fill={'purple'} /> */}\n              <path\n                strokeDasharray=\"2\"\n                className=\"realismo-label-join\"\n                fill=\"none\"\n                stroke=\"black\"\n                d={`M ${x1} ${y1} C ${pointAX} ${pointAY}, ${pointBX} ${pointBY}, ${x2} ${y2}`}\n              />\n            </g>\n          )\n        })}\n\n        {/* {racconti.map((racconto, i) => {\n          const angle = racconto.rotation\n          return (\n            <g\n              key={i}\n              className={`worm-label worm-label-${i}`}\n              style={{ transform: `rotate(${angle}deg)` }}\n            >\n              <WormLabel\n                size={size}\n                flipText={angle >= 90 && angle <= 270}\n                isSelected={allSelected || !!selected[racconto.title]}\n                isOmitted={!!omitted[racconto.title]}\n                onClick={handleClick}\n                radius={size / 2}\n                labelSize={(size / 2) * LABEL_SIZE_PERCENT}\n                wormSize={(size / 2) * WORM_SIZE_PERCENT}\n                racconto={racconto}\n                circles={circlesMap[racconto.title]}\n              ></WormLabel>\n            </g>\n          )\n        })} */}\n        {/* <circle cx={0} cy={0} r={size / 2 - labelSize} fill='transparent' /> */}\n        {racconti.map((racconto, i) => {\n          const angle = racconto.rotation\n          return (\n            <g\n              key={i}\n              className={`worm-${i}`}\n              style={{ transform: `rotate(${angle}deg)` }}\n            >\n              <Worm\n                size={size}\n                flipText={angle >= 90 && angle <= 270}\n                isSelected={allSelected || !!selected[racconto.title]}\n                isOmitted={!!omitted[racconto.title]}\n                onClick={handleClick}\n                radius={size / 2}\n                labelSize={(size / 2) * LABEL_SIZE_PERCENT}\n                wormSize={(size / 2) * WORM_SIZE_PERCENT}\n                racconto={racconto}\n                circles={circlesMap[racconto.title]}\n              ></Worm>\n            </g>\n          )\n        })}\n      </g>\n      <g transform={`translate(100, ${paddingTop})`}>\n        <Legend\n          x={radius}\n          wormSize={wormSize}\n          labelSize={labelSize}\n          endLineStart={endLineStart}\n          endLineEnd={endLineEnd}\n        />\n\n        <CicrleYears\n          x={radius}\n          y={radius}\n          radius={innerRadius}\n          radiusStrokeSize={INNER_CIRCLE_STROKE_WIDTH}\n        />\n      </g>\n    </svg>\n  )\n}\n","import React, { useMemo } from 'react'\nimport { linkVertical } from 'd3-shape'\nimport { colorScale } from './utils'\nimport range from 'lodash/range'\nimport MiniInfoBox from '../../general/MiniInfoBox'\n\nconst CHART_PADDING_X = 80\nconst LEGEND_TEXT_HEIGHT = 150\n\nconst MINI_RADIUS = 20\nconst LOCATION_RADIUS = 2\n\nconst LEVEL_HEIGHT = 40\n\nconst WORM_MARGIN_TOP = 20\n\nconst CHART_MARGIN_LEFT = 100\n\nfunction yScale(level) {\n  return WORM_MARGIN_TOP + LEVEL_HEIGHT * level\n}\n\nfunction makeItemFill(item) {\n  if (item.ghost) {\n    return 'rgba(95, 102, 100, 0.5)'\n  }\n  if (item.movement === 'FALSE') {\n    return item.color\n  }\n  return `url(${makeItemGradientUrl(item)})`\n}\n\nfunction makeItemGradientUrl(item) {\n  let direction = ''\n  if (item.direction === 'forward') {\n    direction = '-forward'\n  } else if (item.direction === 'backward') {\n    direction = '-backward'\n  }\n  return `#worm-detail-${item.category}${direction}`\n}\n\nfunction WormDetail({ data, width: allWidth, title, year, toggleSelect }) {\n  const width = allWidth - CHART_PADDING_X * 2 - CHART_MARGIN_LEFT\n  const dataWorms = useMemo(() => {\n    return data.map((item) => {\n      const x1 =\n        item.startTotalNorm * width + CHART_PADDING_X + CHART_MARGIN_LEFT\n      const x2 = item.endTotalNorm * width + CHART_PADDING_X + CHART_MARGIN_LEFT\n      const xLocation =\n        item.locationTotalNorm * width + CHART_PADDING_X + CHART_MARGIN_LEFT\n      const color = colorScale(item.category)\n      return {\n        ...item,\n        level: +item.level,\n        color,\n        x1,\n        x2,\n        xLocation,\n      }\n    })\n  }, [data, width])\n\n  const maxLevel = 3\n\n  const labalesData = useMemo(() => {\n    let dataForLabels\n    const dataWormsLabeled = dataWorms.filter(d => d.ghost !== true)\n    if (dataWormsLabeled.length < 13) {\n      dataForLabels = dataWormsLabeled.map((item, i) => {\n        const x = CHART_PADDING_X + CHART_MARGIN_LEFT + i * 60\n        return {\n          ...item,\n          x,\n          y: yScale(maxLevel),\n        }\n      })\n    } else {\n      const mul = width / (dataWormsLabeled.length - 1)\n      dataForLabels = dataWormsLabeled.map((item, i) => {\n        const x = CHART_PADDING_X + CHART_MARGIN_LEFT + i * mul\n        return {\n          ...item,\n          x,\n          y: yScale(maxLevel),\n        }\n      })\n    }\n    const link = linkVertical()\n    return dataForLabels.map((item) => {\n      const linePath = link({\n        source: [item.xLocation, yScale(item.level)],\n        target: [item.x, item.y - 5],\n      })\n      return {\n        ...item,\n        linePath,\n      }\n    })\n  }, [dataWorms, width])\n\n  const levelsData = useMemo(() => {\n    return range(maxLevel).map((level) => {\n      const dataLevelWorms = dataWorms.filter((d) => d.level === level)\n      const hasData = dataLevelWorms.length > 0\n      const dataLabel = labalesData.filter((d) => d.level === level)\n\n      return {\n        level,\n        dataLevelWorms,\n        hasData,\n        dataLabel,\n      }\n    })\n  }, [dataWorms, labalesData])\n\n  const totalLength = data[0]?.length ?? 0\n  let totalLabelX\n  const height = yScale(maxLevel) + LEGEND_TEXT_HEIGHT\n\n  let ghostWorm\n\n  // GHOST (no ambientazione)\n  if (dataWorms.length === 1 && dataWorms[0].occurrence_location === '0') {\n    ghostWorm = {\n      x1: 0 + CHART_PADDING_X + CHART_MARGIN_LEFT,\n      x2:\n        dataWorms[0].lengthTotalNorm * width +\n        CHART_PADDING_X +\n        CHART_MARGIN_LEFT,\n    }\n    totalLabelX = ghostWorm.x2\n  } else {\n    totalLabelX = dataWorms[dataWorms.length - 1]?.x2\n  }\n\n  return (\n    <div className=\"realismo-detail\">\n      <div className=\"realismo-detail-info-legend\">\n        Livelli\n        <br />\n        di annidamento\n        <br />\n        dei luoghi\n      </div>\n      <div style={{ margin: `0px ${CHART_PADDING_X}px` }}>\n        <MiniInfoBox\n          onClose={() => toggleSelect(title)}\n          style={{ marginLeft: CHART_MARGIN_LEFT }}\n        >\n          {title}, {year}\n        </MiniInfoBox>\n      </div>\n      <svg className=\"worm-detail-svg\" style={{ height }}>\n        <linearGradient id=\"worm-detail-indoor\">\n          <stop offset={'0%'} stopColor={'#ffc33e'} />\n          <stop offset={'50%'} stopColor={'#FFF3D7'}>\n            <animate\n              attributeName=\"offset\"\n              values=\"0;1;0\"\n              dur=\"8s\"\n              repeatCount=\"indefinite\"\n            ></animate>\n          </stop>\n          <stop offset={'100%'} stopColor={'#ffc33e'} />\n        </linearGradient>\n        <linearGradient id=\"worm-detail-indoor-backward\">\n          <stop offset={'0%'} stopColor={'#ffc33e'} />\n          <stop offset={'50%'} stopColor={'#FFF3D7'}>\n            <animate\n              attributeName=\"offset\"\n              values=\"1;0\"\n              dur=\"4s\"\n              repeatCount=\"indefinite\"\n            ></animate>\n          </stop>\n          <stop offset={'100%'} stopColor={'#ffc33e'} />\n        </linearGradient>\n        <linearGradient id=\"worm-detail-indoor-forward\">\n          <stop offset={'0%'} stopColor={'#ffc33e'} />\n          <stop offset={'50%'} stopColor={'#FFF3D7'}>\n            <animate\n              attributeName=\"offset\"\n              values=\"0;1\"\n              dur=\"4s\"\n              repeatCount=\"indefinite\"\n            ></animate>\n          </stop>\n          <stop offset={'100%'} stopColor={'#ffc33e'} />\n        </linearGradient>\n        <linearGradient id=\"worm-detail-outdoor\">\n          <stop offset={'0%'} stopColor={'#00c97c'} />\n          <stop offset={'50%'} stopColor={'#63FFC3'}>\n            <animate\n              attributeName=\"offset\"\n              values=\"0;1;0\"\n              dur=\"8s\"\n              repeatCount=\"indefinite\"\n            ></animate>\n          </stop>\n          <stop offset={'100%'} stopColor={'#00c97c'} />\n        </linearGradient>\n        <linearGradient id=\"worm-detail-outdoor-forward\">\n          <stop offset={'0%'} stopColor={'#00c97c'} />\n          <stop offset={'50%'} stopColor={'#63FFC3'}>\n            <animate\n              attributeName=\"offset\"\n              values=\"0;1\"\n              dur=\"4s\"\n              repeatCount=\"indefinite\"\n            ></animate>\n          </stop>\n          <stop offset={'100%'} stopColor={'#00c97c'} />\n        </linearGradient>\n        <linearGradient id=\"worm-detail-outdoor-backward\">\n          <stop offset={'0%'} stopColor={'#00c97c'} />\n          <stop offset={'50%'} stopColor={'#63FFC3'}>\n            <animate\n              attributeName=\"offset\"\n              values=\"1;0\"\n              dur=\"4s\"\n              repeatCount=\"indefinite\"\n            ></animate>\n          </stop>\n          <stop offset={'100%'} stopColor={'#00c97c'} />\n        </linearGradient>\n        <linearGradient id=\"worm-detail-transportation\">\n          <stop offset={'0%'} stopColor={'#4a4aff'} />\n          <stop offset={'50%'} stopColor={'#E3E3FF'}>\n            <animate\n              attributeName=\"offset\"\n              values=\"0;1;0\"\n              dur=\"8s\"\n              repeatCount=\"indefinite\"\n            ></animate>\n          </stop>\n          <stop offset={'100%'} stopColor={'#4a4aff'} />\n        </linearGradient>\n        <linearGradient id=\"worm-detail-transportation-forward\">\n          <stop offset={'0%'} stopColor={'#4a4aff'} />\n          <stop offset={'50%'} stopColor={'#E3E3FF'}>\n            <animate\n              attributeName=\"offset\"\n              values=\"0;1\"\n              dur=\"4s\"\n              repeatCount=\"indefinite\"\n            ></animate>\n          </stop>\n          <stop offset={'100%'} stopColor={'#4a4aff'} />\n        </linearGradient>\n        <linearGradient id=\"worm-detail-transportation-backward\">\n          <stop offset={'0%'} stopColor={'#4a4aff'} />\n          <stop offset={'50%'} stopColor={'#E3E3FF'}>\n            <animate\n              attributeName=\"offset\"\n              values=\"1;0\"\n              dur=\"4s\"\n              repeatCount=\"indefinite\"\n            ></animate>\n          </stop>\n          <stop offset={'100%'} stopColor={'#4a4aff'} />\n        </linearGradient>\n        <g transform={'translate(0, 10)'}>\n          {levelsData.map((datum) => (\n            <g\n              key={datum.level}\n              className={`worm-detail-grid-container ${\n                datum.hasData ? 'level-enabled' : 'level-disabled'\n              }`}\n            >\n              <line\n                x1={CHART_PADDING_X + CHART_MARGIN_LEFT}\n                x2={width + CHART_PADDING_X + CHART_MARGIN_LEFT}\n                y1={yScale(datum.level)}\n                y2={yScale(datum.level)}\n                className={`worm-detail-y-grid`}\n              ></line>\n              <text\n                className={'worm-detail-level-label'}\n                y={yScale(datum.level) + 4}\n                x={CHART_PADDING_X - 10 + CHART_MARGIN_LEFT}\n              >\n                {datum.level}\n              </text>\n            </g>\n          ))}\n\n          {levelsData.map((datum) => (\n            <g key={datum.level}>\n              {datum.dataLevelWorms.map((item) => (\n                <g key={item.occurrence_location}>\n                  <rect\n                    rx={2}\n                    ry={2}\n                    x={item.x1}\n                    width={item.x2 - item.x1}\n                    height={MINI_RADIUS}\n                    style={{\n                      fill: makeItemFill(item),\n                    }}\n                    y={yScale(item.level) - MINI_RADIUS / 2}\n                  />\n                </g>\n              ))}\n              {datum.dataLabel.map((item) => (\n                <g key={item.occurrence_location}>\n                  <path d={item.linePath} fill=\"none\" stroke=\"#858585\" />\n                  <text\n                    x={item.x}\n                    y={item.y}\n                    textAnchor=\"end\"\n                    style={{\n                      transformOrigin: `${item.x}px ${item.y}px`,\n                      transform: `rotate(-45deg)`,\n                    }}\n                  >\n                    {item.occurrence}\n                  </text>\n                </g>\n              ))}\n              {datum.dataLevelWorms.filter(d => d.ghost !== true).map((item) => (\n                <g key={item.occurrence_location}>\n                  <circle\n                    fill=\"black\"\n                    cx={item.xLocation}\n                    cy={yScale(item.level)}\n                    r={LOCATION_RADIUS}\n                  />\n                </g>\n              ))}\n            </g>\n          ))}\n          {ghostWorm && (\n            <rect\n              rx={2}\n              ry={2}\n              x={ghostWorm.x1}\n              width={ghostWorm.x2 - ghostWorm.x1}\n              height={MINI_RADIUS}\n              style={{\n                fill: 'rgba(95, 102, 100, 0.5)',\n              }}\n              y={yScale(0) - MINI_RADIUS / 2}\n            />\n          )}\n        </g>\n\n        <text\n          textAnchor={totalLabelX / width >= 0.75 ? 'end' : 'middle'}\n          x={totalLabelX}\n          y={10}\n          style={{ fontSize: 12 }}\n        >\n          {totalLength} caratteri\n        </text>\n        <line\n          x1={totalLabelX}\n          x2={totalLabelX}\n          y1={12}\n          y2={18}\n          stroke={'black'}\n        />\n      </svg>\n    </div>\n  )\n}\n\nexport default React.memo(WormDetail)\n","import React, {\n  useState,\n  useCallback,\n  useRef,\n  useLayoutEffect,\n  useMemo,\n} from 'react'\nimport HelpSidePanel from '../../panels/HelpSidePanel/HelpSidePanel'\nimport MainMenu from '../../general/MainMenu'\nimport PageTitle from '../../general/PageTitle'\nimport AltOptions from '../../general/Options/AltOptions'\nimport SearchDropDown from '../../general/Search/SearchDropDownControlled'\nimport MoreInfo from '../../general/MoreInfo'\nimport CompassButton from '../../general/CompassButton/CompassButton'\nimport useDimensions from 'react-use-dimensions'\nimport GlobalData from '../../utilities/GlobalData'\nimport RangeFilter from '../../general/RangeFilter'\n\nimport sortBy from 'lodash/sortBy'\nimport uniqBy from 'lodash/uniqBy'\n\nimport {\n  datasetToCircles,\n  dataset,\n  raccontiDegs as racconti,\n  yearsExtent,\n  detailWormsCircles,\n} from './utils'\nimport CircleWorms from './CircleWorms'\nimport WormDetail from './WormDetail'\nimport { groupBy } from 'lodash'\n\nconst LABEL_BEZIER_DELTA_A = 30\nconst RESET_BOX_HEIGHT = 70\nconst REALISMO_DIAMETER = 760\nconst REALISMO_RADIUS = REALISMO_DIAMETER / 2\n\nconst circlesMap = datasetToCircles(40)\n\nconst searchOptionsTitolo = racconti.map((racconto) => ({\n  label: racconto.title,\n  value: racconto.title,\n}))\nconst searchOptionsVolume = (() => {\n  const keyByTitolo = racconti.reduce((acc, r) => {\n    acc[r.title] = true\n    return acc\n  }, {})\n  return uniqBy(racconti, 'volume').map((racconto) => {\n    const volume = racconto.volume\n    let volumeLabel = volume\n    if (keyByTitolo[volumeLabel]) {\n      volumeLabel += ' (volume)'\n    }\n    return {\n      label: volumeLabel,\n      value: volumeLabel,\n      volume: volume,\n    }\n  })\n})()\n\nconst titoliByVolume = groupBy(racconti, 'volume')\n\nconst optionsMovimento = [\n  {\n    label: 'SI MOVIMENTO',\n  },\n  {\n    label: 'NO MOVIMENTO',\n  },\n]\n\nconst optionsSpace = [\n  {\n    label: 'INTERNO',\n    value: 'indoor',\n  },\n  {\n    label: 'ESTERNO',\n    value: 'outdoor',\n  },\n  {\n    label: 'MEZZO DI TRANSPORTO',\n    value: 'transportation',\n  },\n  {\n    label: 'ASSENZA DI AMBIENTAZIONE',\n    value: 'no_setting',\n  },\n]\n\nconst cercaOptions = [\n  { label: 'Volume', value: 'volume' },\n  { label: 'Titolo', value: 'titolo' },\n]\n\nexport default function RealismoMain({ title }) {\n  const [helpSidePanelOpen, setHelpSidePanelOpen] = useState(false)\n  const toggleHelpSidePanel = useCallback(() => {\n    setHelpSidePanelOpen((a) => !a)\n  }, [])\n  const [findFor, setFindFor] = useState('Titolo')\n  const [ricerca, setRicerca] = useState([])\n\n  const helpPage = GlobalData.helpPages.plot.main\n\n  // const containerRef = useRef()\n  // const [measures, setMeasures] = useState(null)\n  // useLayoutEffect(() => {\n  //   const m = containerRef.current.getBoundingClientRect()\n  //   setMeasures(m)\n  // }, [])\n  const [ref, { width }] = useDimensions({ liveMeasure: false })\n  const [refCirlce, { height: heightCircle }] = useDimensions({\n    liveMeasure: false,\n  })\n\n  const [movimento, setMovimento] = useState(null)\n  const [spazio, setSpazio] = useState([])\n  const [timeFilter, setTimeFilter] = useState(yearsExtent)\n  const spazioLabels = useMemo(() => spazio.map((s) => s.label), [spazio])\n\n  const omitted = useMemo(() => {\n    const omittedStuff = {}\n    const spazioValues = spazio.map((s) => s.value)\n    Object.keys(dataset).forEach((titolo) => {\n      let keep = true\n\n      if (keep && movimento !== null) {\n        if (movimento === 'SI MOVIMENTO') {\n          keep = dataset[titolo].some((datum) => {\n            if (movimento === 'SI MOVIMENTO') {\n              return datum.movement === 'TRUE'\n            }\n            return false\n          })\n        } else {\n          keep = dataset[titolo].every((datum) => {\n            if (movimento === 'NO MOVIMENTO') {\n              return datum.movement === 'FALSE'\n            }\n            return false\n          })\n        }\n      }\n\n      if (keep && spazioValues.length > 0) {\n        const categories = dataset[titolo].map((i) => i.category)\n        keep = spazioValues.some((category) => {\n          return categories.indexOf(category) !== -1\n        })\n      }\n\n      if (keep) {\n        keep = dataset[titolo].every((d) => {\n          return (\n            d.year >= timeFilter[0].getFullYear() &&\n            d.year <= timeFilter[1].getFullYear()\n          )\n        })\n      }\n\n      if (!keep) {\n        omittedStuff[titolo] = true\n      }\n    })\n    return omittedStuff\n  }, [movimento, spazio, timeFilter])\n\n  const selected = useMemo(() => {\n    const mapSelected = {}\n    const volumeSelected = {}\n    ricerca.forEach((item) => {\n      if (!item.volume) {\n        mapSelected[item.value] = true\n      } else {\n        volumeSelected[item.volume] = true\n      }\n    })\n    racconti\n      .filter((r) => volumeSelected[r.volume])\n      .forEach((item) => {\n        mapSelected[item.title] = true\n      })\n    return mapSelected\n  }, [ricerca])\n\n  const toggleSelect = useCallback((title) => {\n    setRicerca((ricerca) => {\n      const newRicerca = ricerca.filter((item) => item.value !== title)\n      if (ricerca.length === newRicerca.length) {\n        return ricerca.concat({ label: title, value: title })\n      }\n      return newRicerca\n    })\n  }, [])\n\n  const selctedTitoliSorted = useMemo(() => {\n    const ricercaTitoli = uniqBy(\n      ricerca\n        .filter((r) => r.volume)\n        .reduce(\n          (acc, r) =>\n            acc.concat(\n              titoliByVolume[r.volume].map((r) => ({\n                value: r.title,\n                label: r.title,\n              }))\n            ),\n          []\n        )\n        .concat(ricerca.filter((r) => !r.volume)),\n      'value'\n    )\n    return sortBy(ricercaTitoli, (item) => dataset[item.value]?.[0]?.year)\n  }, [ricerca])\n\n  const leftRacconti = useMemo(() => {\n    return racconti\n      .filter((r) => r.rotation >= 90 && r.rotation <= 270)\n      .reverse()\n  }, [])\n\n  const rightRacconti = useMemo(() => {\n    return racconti.filter((r) => !(r.rotation >= 90 && r.rotation <= 270))\n  }, [])\n\n  const lineHeightRight = heightCircle / rightRacconti.length\n  const lineHeightLeft = (heightCircle - RESET_BOX_HEIGHT) / leftRacconti.length\n\n  const raccontiJoinLines = useMemo(() => {\n    const paddingTop = (heightCircle - REALISMO_DIAMETER) / 2\n\n    return racconti.reduce((acc, racconto) => {\n      const isLeft = racconto.rotation >= 90 && racconto.rotation <= 270\n\n      let x1, x2, y1, y2, pointAX, pointAY, pointBX, pointBY\n\n      if (isLeft) {\n        const angle = Math.abs(180 - racconto.rotation)\n        const index = leftRacconti.indexOf(racconto)\n        x2 = -(REALISMO_DIAMETER / 2 + 100) + 5\n        y2 =\n          -(REALISMO_DIAMETER / 2) +\n          index * lineHeightLeft +\n          lineHeightLeft / 2 -\n          paddingTop +\n          RESET_BOX_HEIGHT\n\n        y1 =\n          -Math.sin((Math.PI / 180) * angle) *\n          (REALISMO_RADIUS - 5) *\n          (racconto.rotation > 180 ? 1 : -1)\n        x1 = -Math.cos((Math.PI / 180) * angle) * (REALISMO_RADIUS - 5)\n\n        pointAY =\n          -Math.sin((Math.PI / 180) * angle) *\n          (REALISMO_RADIUS + LABEL_BEZIER_DELTA_A) *\n          (racconto.rotation > 180 ? 1 : -1)\n        pointAX =\n          -Math.cos((Math.PI / 180) * angle) *\n          (REALISMO_RADIUS + LABEL_BEZIER_DELTA_A)\n      } else {\n        const index = rightRacconti.indexOf(racconto)\n        x2 = REALISMO_DIAMETER / 2 + 100 - 5\n        y2 =\n          -(REALISMO_DIAMETER / 2) +\n          index * lineHeightRight +\n          lineHeightRight / 2 -\n          paddingTop\n\n        const angle = Math.abs(racconto.rotation)\n\n        y1 =\n          -Math.sin((Math.PI / 180) * angle) *\n          (REALISMO_RADIUS - 5) *\n          (racconto.rotation > 0 ? -1 : 1)\n        x1 = Math.cos((Math.PI / 180) * angle) * (REALISMO_RADIUS - 5)\n\n        pointAY =\n          -Math.sin((Math.PI / 180) * angle) *\n          (REALISMO_RADIUS + LABEL_BEZIER_DELTA_A) *\n          (racconto.rotation > 0 ? -1 : 1)\n        pointAX =\n          Math.cos((Math.PI / 180) * angle) *\n          (REALISMO_RADIUS + LABEL_BEZIER_DELTA_A)\n      }\n\n      pointBX = (x1 + x2) / 2\n      pointBY = y2\n\n      acc[racconto.title] = {\n        x1,\n        y1,\n        x2,\n        y2,\n        pointAX,\n        pointAY,\n        pointBX,\n        pointBY,\n      }\n\n      return acc\n    }, {})\n  }, [\n    leftRacconti,\n    rightRacconti,\n    heightCircle,\n    lineHeightRight,\n    lineHeightLeft,\n  ])\n\n  return (\n    <div>\n      <HelpSidePanel\n        open={helpSidePanelOpen}\n        page={helpPage}\n        closeButtonClicked={toggleHelpSidePanel}\n      />\n      <div className=\"top-nav navigations\">\n        <MainMenu className=\"main-menu\" style={{ gridColumn: 'span 1' }} />\n        <PageTitle title={title} style={{ gridColumn: 'span 10' }} />\n        <AltOptions\n          multiple={false}\n          title=\"Cerca per\"\n          options={cercaOptions}\n          value={findFor}\n          onChange={(x) => setFindFor(x.label)}\n          style={{\n            gridColumn: 'span 3',\n          }}\n        />\n        <SearchDropDown\n          style={{\n            gridColumn: 'span 8',\n          }}\n          data={{\n            options:\n              findFor === 'Titolo' ? searchOptionsTitolo : searchOptionsVolume,\n          }}\n          changeOptions={(newOptions) => {\n            setRicerca(newOptions)\n          }}\n          selectedOptions={ricerca}\n        />\n        <MoreInfo\n          style={{ gridColumn: 'span 1' }}\n          onClicked={toggleHelpSidePanel}\n        />\n        <CompassButton\n          style={{\n            gridColumn: 'span 1',\n            color: 'white',\n            backgroundColor: 'black',\n          }}\n        />\n      </div>\n      <div className=\"realismo-content\">\n        <div\n          className=\"h-100 w-100 d-flex justify-content-center realismo-circle-wrapper\"\n          style={{\n            position: 'relative',\n          }}\n        >\n          <div className=\"realismo-labels-container on-left text-right\">\n            <div className=\"realismo-reset\">\n              <div>\n                <div>Seleziona i test e poi scorri in basso</div>\n                <button\n                  onClick={() => {\n                    // Reset Selection\n                    setRicerca([])\n                    // Reset Filters\n                    // setSpazio([])\n                    // setMovimento(null)\n                    // setTimeFilter(yearsExtent)\n                  }}\n                >\n                  Reset\n                </button>\n              </div>\n            </div>\n            {leftRacconti.map((racconto, i) => {\n              return (\n                <div\n                  onClick={() => toggleSelect(racconto.title)}\n                  className={`realismo-label ${\n                    selected[racconto.title] ? 'realismo-label-selected' : ''\n                  }`}\n                  style={{\n                    height: `${lineHeightLeft}px`,\n                    lineHeight: `${lineHeightLeft}px`,\n                  }}\n                  key={i}\n                >\n                  {racconto.title}\n                </div>\n              )\n            })}\n          </div>\n          <div className=\"circle-worms-the-wrapper\" ref={refCirlce}>\n            {heightCircle && (\n              <CircleWorms\n                heightCircle={heightCircle}\n                toggleSelect={toggleSelect}\n                selected={selected}\n                omitted={omitted}\n                circlesMap={circlesMap}\n                racconti={racconti}\n                raccontiJoinLines={raccontiJoinLines}\n                radius={REALISMO_RADIUS}\n              ></CircleWorms>\n            )}\n          </div>\n          <div className=\"realismo-labels-container on-right\">\n            {rightRacconti.map((racconto, i) => {\n              return (\n                <div\n                  style={{\n                    lineHeight: `${lineHeightRight}px`,\n                    height: `${lineHeightRight}px`,\n                  }}\n                  onClick={() => toggleSelect(racconto.title)}\n                  className={`realismo-label ${\n                    selected[racconto.title] ? 'realismo-label-selected' : ''\n                  }`}\n                  key={i}\n                >\n                  {racconto.title}\n                </div>\n              )\n            })}\n          </div>\n        </div>\n        <div className=\"bottom-nav navigations\">\n          <AltOptions\n            title=\"Movimento\"\n            options={optionsMovimento}\n            value={movimento}\n            allowEmpty={true}\n            onChange={(m) => {\n              if (m) {\n                setMovimento(m.label)\n              } else {\n                setMovimento(null)\n              }\n            }}\n            style={{\n              gridColumn: 'span 8',\n              textAlign: 'center',\n            }}\n          />\n          <AltOptions\n            title=\"Spazio\"\n            multiple\n            options={optionsSpace}\n            value={spazioLabels}\n            allowEmpty={true}\n            onChange={(s) => {\n              setSpazio(s)\n            }}\n            style={{\n              gridColumn: 'span 8',\n              textAlign: 'center',\n            }}\n          />\n          <RangeFilter\n            style={{ gridColumn: 'span 8' }}\n            data={timeFilter}\n            changeOptions={(timeSpan) => {\n              setTimeFilter(timeSpan)\n            }}\n          />\n        </div>\n      </div>\n      {ricerca.length > 0 && (\n        <div className=\"realismo-details-container\" ref={ref}>\n          <h4>VEDI IN DETTAGLIO I TESTI SELEZIONATI</h4>\n          {width &&\n            selctedTitoliSorted.map((item) => (\n              <WormDetail\n                data={detailWormsCircles[item.value]}\n                year={detailWormsCircles[item.value]?.[0]?.year}\n                title={item.value}\n                width={width}\n                key={item.value}\n                toggleSelect={toggleSelect}\n              />\n            ))}\n        </div>\n      )}\n    </div>\n  )\n}\n"],"sourceRoot":""}