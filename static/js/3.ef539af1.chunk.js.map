{"version":3,"sources":["../node_modules/d3-shape/src/curve/monotone.js","general/Search/SearchDropDownControlled.js","../node_modules/lodash/mapValues.js","../node_modules/lodash/minBy.js","../node_modules/lodash/_baseLt.js","../node_modules/lodash/take.js","visualizations/Trama2/utils.js","visualizations/Trama2/GradientsDefinitions.js","visualizations/Trama2/RaccontoInfoBoxSvg.js","visualizations/Trama2/Brush.js","visualizations/Trama2/LineeTrama.js","visualizations/Trama2/BoxPlotGradientsDefinitions.js","visualizations/Trama2/BoxPlot.js","visualizations/Trama2/TramaDetail.js","visualizations/Trama2/SideBar.js","visualizations/Trama2/Trama2Content.js","visualizations/Trama2/Trama2Main.js"],"names":["sign","x","slope3","that","x2","y2","h0","_x1","_x0","h1","s0","_y1","_y0","s1","p","Math","min","abs","slope2","t","h","point","t0","t1","x0","y0","x1","y1","dx","_context","bezierCurveTo","MonotoneX","context","this","MonotoneY","ReflectContext","monotoneX","prototype","areaStart","_line","areaEnd","NaN","lineStart","_t0","_point","lineEnd","lineTo","closePath","y","moveTo","Object","create","call","Search","props","maxTokens","selectedOptions","className","style","fontSize","position","top","ref","typeahead","multiple","onChange","selected","selectedGroups","groupBy","value","dupes","keys","filter","length","newSelected","item","indexOf","changeOptions","disabled","onInputChange","options","data","id","filterBy","option","text","label","toLowerCase","renderMenu","results","menuProps","map","result","index","isSelected","key","renderMenuItemChildren","idx","selectedValues","search","renderToken","onRemove","tabIndex","onClick","focus","Component","defaultProps","gridColumn","baseAssignValue","require","baseForOwn","baseIteratee","module","exports","object","iteratee","baseExtremum","baseLt","array","undefined","other","baseSlice","toInteger","n","guard","MOTIVO_LINE_HEIGHT","motivoExtent","extent","ordineColore","makeScalaMotivoY","lineHeight","scaleLinear","domain","range","splitPath","d","pieces","split","reduce","acc","i","path","push","reverse","a","b","React","memo","prefix","gradientsType","byTipologia","gradientType","tipoFromName","tipoToName","tipoFrom","tipoTo","offset","stopColor","colore","colori","RaccontoInfoBoxSvg","titolo","containerRef","useRef","useState","measures","setMeasures","view","useContext","CurretTramaViewContext","useLayoutEffect","m","current","getBoundingClientRect","transform","cursor","width","height","rx","stroke","textAnchor","userSelect","BRUSH_HANDLE_WIDTH","Brush","onNextClick","onPrevClick","controlledX","onXChange","uncontrolledX","setX","rawNextX","nextX","icon","faArrowLeft","axis","bounds","left","right","onDrag","e","faArrowRight","lineGenerator","line","curve","curveMonotoneX","SubPathsWithColors","subPaths","itemSelected","subPath","strokeSelected","motivo_type","fill","TramaPoints","transformOrigin","cx","cy","r","LineaTrama","racconto","selectedPoint","xScale","gradient","toggleItem","onRaccontoClick","useMemo","handleClickRacconto","useCallback","element","anno","ReactDOM","createPortal","document","getElementsByClassName","SelectedContainers","LineeTramaList","dataRacconti","currentXHoverRacconti","racconti","scalaColore","scalaMotivoY","toggleSelect","datum","LineeTramaWithMeasures","colors","tipologieByTipologia","tipologie","setYears","svgRef","useEffect","imperativeTranslate","currentScaleY","selectAll","attr","svg","scaleY","selection","select","zoom","scaleExtent","translateExtent","on","newScaleY","currentEvent","rescaleY","lowIndex","max","floor","hiIndex","prevYears","newYears","dataByRaccontiFinal","gradientsSet","Set","out","add","originalX","Array","from","dataByRacconti","handleNexPoint","nextPoints","forEach","handlePrevPoint","xKey","toFixed","GradientsDefinitions","forwardRef","useImperativeHandle","rotateView","cb","overflow","scalaMotivo","colorsItems","values","sort","ordineMotivo","delta","motivi","uniqueItems","gradientUnits","tipologia","BoxPlotElement","zoomFactor","yScale","widthBar","fillOpacity","first","last","translations","setZoomFactor","actualScaleX","currentScaleX","scaleX","newScaleX","rescaleX","round","k","unstable_batchedUpdates","finalDataByRacconti","dataForRacconto","head","_last","uniqBy","minBy","maxBy","dataTrama","realX","console","log","years","BoxPlotGradientsDefinitions","CHART_X_PADDING","TramaDetail","onBack","detailHeight","newData","fullData","SideBar","addBound","boundsByKey","setBounds","keyBy","itemHeight","lookupMap","looks","minDatum","maxDatum","lookup","background","createContext","Trama2Content","byRacconto","setSelected","sidePanelOpen","setSidePanelOpen","toggleSidePanel","concat","orderedBounds","sortBy","bound","indexes","indenx","sel","some","fromBounds","listRef","currentView","setCurrentView","currentTramaDetail","setCurrentTramaDetail","faAngleDoubleRight","borderBottom","bottom","Provider","display","ordineByCluster","coloriPosizioni","get","ordine","clusterByMotivo","mapValues","mappaMotivoTipologia","ordineMotivoByMotivo","datasetLinesNormalized","datasetLines","tot","motivo","cluster","coloreCluster","ordineCluster","startMotivoNorm","start_motivo","endMotivoNorm","end_motivo","mese","makeVizData","searchOptions","cercaOptions","Trama2Main","title","helpSidePanelOpen","setHelpSidePanelOpen","ricerca","setRicerca","toggleHelpSidePanel","helpPage","GlobalData","helpPages","plot","main","newRicerca","clearedBounds","HelpSidePanel","open","page","closeButtonClicked","MainMenu","PageTitle","AltOptions","newOptions","o","MoreInfo","onClicked","CompassButton","color","backgroundColor"],"mappings":"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","file":"static/js/3.ef539af1.chunk.js","sourcesContent":["function sign(x) {\n  return x < 0 ? -1 : 1;\n}\n\n// Calculate the slopes of the tangents (Hermite-type interpolation) based on\n// the following paper: Steffen, M. 1990. A Simple Method for Monotonic\n// Interpolation in One Dimension. Astronomy and Astrophysics, Vol. 239, NO.\n// NOV(II), P. 443, 1990.\nfunction slope3(that, x2, y2) {\n  var h0 = that._x1 - that._x0,\n      h1 = x2 - that._x1,\n      s0 = (that._y1 - that._y0) / (h0 || h1 < 0 && -0),\n      s1 = (y2 - that._y1) / (h1 || h0 < 0 && -0),\n      p = (s0 * h1 + s1 * h0) / (h0 + h1);\n  return (sign(s0) + sign(s1)) * Math.min(Math.abs(s0), Math.abs(s1), 0.5 * Math.abs(p)) || 0;\n}\n\n// Calculate a one-sided slope.\nfunction slope2(that, t) {\n  var h = that._x1 - that._x0;\n  return h ? (3 * (that._y1 - that._y0) / h - t) / 2 : t;\n}\n\n// According to https://en.wikipedia.org/wiki/Cubic_Hermite_spline#Representations\n// \"you can express cubic Hermite interpolation in terms of cubic Bézier curves\n// with respect to the four values p0, p0 + m0 / 3, p1 - m1 / 3, p1\".\nfunction point(that, t0, t1) {\n  var x0 = that._x0,\n      y0 = that._y0,\n      x1 = that._x1,\n      y1 = that._y1,\n      dx = (x1 - x0) / 3;\n  that._context.bezierCurveTo(x0 + dx, y0 + dx * t0, x1 - dx, y1 - dx * t1, x1, y1);\n}\n\nfunction MonotoneX(context) {\n  this._context = context;\n}\n\nMonotoneX.prototype = {\n  areaStart: function() {\n    this._line = 0;\n  },\n  areaEnd: function() {\n    this._line = NaN;\n  },\n  lineStart: function() {\n    this._x0 = this._x1 =\n    this._y0 = this._y1 =\n    this._t0 = NaN;\n    this._point = 0;\n  },\n  lineEnd: function() {\n    switch (this._point) {\n      case 2: this._context.lineTo(this._x1, this._y1); break;\n      case 3: point(this, this._t0, slope2(this, this._t0)); break;\n    }\n    if (this._line || (this._line !== 0 && this._point === 1)) this._context.closePath();\n    this._line = 1 - this._line;\n  },\n  point: function(x, y) {\n    var t1 = NaN;\n\n    x = +x, y = +y;\n    if (x === this._x1 && y === this._y1) return; // Ignore coincident points.\n    switch (this._point) {\n      case 0: this._point = 1; this._line ? this._context.lineTo(x, y) : this._context.moveTo(x, y); break;\n      case 1: this._point = 2; break;\n      case 2: this._point = 3; point(this, slope2(this, t1 = slope3(this, x, y)), t1); break;\n      default: point(this, this._t0, t1 = slope3(this, x, y)); break;\n    }\n\n    this._x0 = this._x1, this._x1 = x;\n    this._y0 = this._y1, this._y1 = y;\n    this._t0 = t1;\n  }\n}\n\nfunction MonotoneY(context) {\n  this._context = new ReflectContext(context);\n}\n\n(MonotoneY.prototype = Object.create(MonotoneX.prototype)).point = function(x, y) {\n  MonotoneX.prototype.point.call(this, y, x);\n};\n\nfunction ReflectContext(context) {\n  this._context = context;\n}\n\nReflectContext.prototype = {\n  moveTo: function(x, y) { this._context.moveTo(y, x); },\n  closePath: function() { this._context.closePath(); },\n  lineTo: function(x, y) { this._context.lineTo(y, x); },\n  bezierCurveTo: function(x1, y1, x2, y2, x, y) { this._context.bezierCurveTo(y1, x1, y2, x2, y, x); }\n};\n\nexport function monotoneX(context) {\n  return new MonotoneX(context);\n}\n\nexport function monotoneY(context) {\n  return new MonotoneY(context);\n}\n","import React, { Component, createRef } from \"react\";\nimport \"../../App.css\";\nimport \"./SearchDropDown.css\";\nimport {\n  Typeahead,\n  Token,\n  Highlighter,\n  Menu,\n  MenuItem\n} from \"react-bootstrap-typeahead\";\nimport \"react-bootstrap-typeahead/css/Typeahead.css\";\nimport \"react-bootstrap-typeahead/css/Typeahead-bs4.css\";\nimport groupBy from \"lodash/groupBy\";\n\nconst renderToken = (option, props, idx) => (\n  <Token\n    disabled={props.disabled}\n    key={idx}\n    onRemove={props.onRemove}\n    tabIndex={props.tabIndex}\n  >\n    {option.label}\n  </Token>\n);\n\nconst renderMenuItemChildren = (option, props, idx, selectedValues) => {\n\n  return (\n    <Highlighter search={props.text} key={idx}>\n      {option.label}\n    </Highlighter>\n  );\n};\n\nclass Search extends Component {\n  render() {\n    let isSelection = false;\n    const { maxTokens, selectedOptions } = this.props;\n\n    return (\n      <div className=\"search-component\" style={this.props.style}>\n        {!isSelection && (\n          <span style={{ fontSize: \"1rem\", position: \"relative\", top: \"-3px\" }}>\n            /\n          </span>\n        )}\n        <Typeahead\n          ref={typeahead => (this.typeahead = typeahead)}\n          multiple\n          onChange={selected => {\n            const selectedGroups = groupBy(selected, x => x.value);\n            const dupes = Object.keys(selectedGroups).filter(\n              x => selectedGroups[x].length > 1\n            );\n            const newSelected = selected.filter(\n              item => dupes.indexOf(item.value) === -1\n            );\n            this.props.changeOptions(newSelected);\n          }}\n          selected={selectedOptions}\n          disabled={false}\n          onInputChange={this.props.onInputChange}\n          options={this.props.data.options}\n          id=\"main-search\"\n          filterBy={(option, props) => {\n            if (!props.text) {\n              return option;\n            }\n            return option.label.toLowerCase().indexOf(props.text.toLowerCase()) !== -1 ? option : null;\n          }}\n          renderMenu={(results, menuProps) => (\n            <Menu {...menuProps} className=\"rbt-menu-container\">\n              {results.map((result, index) => {\n                const isSelected =\n                selectedOptions.map(x => x.value).indexOf(result.value) !== -1;\n                return (\n                  <MenuItem\n                    key={index}\n                    option={result}\n                    position={index}\n                    className={`dropdown-item-selectable ${isSelected ? 'selected' : ''}`}\n                  >\n                    {result.label}\n                  </MenuItem>\n                );\n              })}\n            </Menu>\n          )}\n          renderMenuItemChildren={(option, props, idx) =>\n            renderMenuItemChildren(option, props, idx, selectedOptions)\n          }\n          renderToken={(option, props, index) => {\n            return index < maxTokens ? (\n              renderToken(option, props, index)\n            ) : index === maxTokens ? (\n              <span key={index} className=\"rbt-token\" onClick={() => this.typeahead.focus()}>+{selectedOptions.length - maxTokens}</span>\n            ) : null;\n          }}\n        />\n      </div>\n    );\n  }\n}\n\nexport default Search;\n\nSearch.defaultProps = {\n  maxTokens: 2,\n  style: {\n    gridColumn: \"span 4\"\n  }\n};\n","var baseAssignValue = require('./_baseAssignValue'),\n    baseForOwn = require('./_baseForOwn'),\n    baseIteratee = require('./_baseIteratee');\n\n/**\n * Creates an object with the same keys as `object` and values generated\n * by running each own enumerable string keyed property of `object` thru\n * `iteratee`. The iteratee is invoked with three arguments:\n * (value, key, object).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Object\n * @param {Object} object The object to iterate over.\n * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n * @returns {Object} Returns the new mapped object.\n * @see _.mapKeys\n * @example\n *\n * var users = {\n *   'fred':    { 'user': 'fred',    'age': 40 },\n *   'pebbles': { 'user': 'pebbles', 'age': 1 }\n * };\n *\n * _.mapValues(users, function(o) { return o.age; });\n * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)\n *\n * // The `_.property` iteratee shorthand.\n * _.mapValues(users, 'age');\n * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)\n */\nfunction mapValues(object, iteratee) {\n  var result = {};\n  iteratee = baseIteratee(iteratee, 3);\n\n  baseForOwn(object, function(value, key, object) {\n    baseAssignValue(result, key, iteratee(value, key, object));\n  });\n  return result;\n}\n\nmodule.exports = mapValues;\n","var baseExtremum = require('./_baseExtremum'),\n    baseIteratee = require('./_baseIteratee'),\n    baseLt = require('./_baseLt');\n\n/**\n * This method is like `_.min` except that it accepts `iteratee` which is\n * invoked for each element in `array` to generate the criterion by which\n * the value is ranked. The iteratee is invoked with one argument: (value).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Math\n * @param {Array} array The array to iterate over.\n * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n * @returns {*} Returns the minimum value.\n * @example\n *\n * var objects = [{ 'n': 1 }, { 'n': 2 }];\n *\n * _.minBy(objects, function(o) { return o.n; });\n * // => { 'n': 1 }\n *\n * // The `_.property` iteratee shorthand.\n * _.minBy(objects, 'n');\n * // => { 'n': 1 }\n */\nfunction minBy(array, iteratee) {\n  return (array && array.length)\n    ? baseExtremum(array, baseIteratee(iteratee, 2), baseLt)\n    : undefined;\n}\n\nmodule.exports = minBy;\n","/**\n * The base implementation of `_.lt` which doesn't coerce arguments.\n *\n * @private\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if `value` is less than `other`,\n *  else `false`.\n */\nfunction baseLt(value, other) {\n  return value < other;\n}\n\nmodule.exports = baseLt;\n","var baseSlice = require('./_baseSlice'),\n    toInteger = require('./toInteger');\n\n/**\n * Creates a slice of `array` with `n` elements taken from the beginning.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to query.\n * @param {number} [n=1] The number of elements to take.\n * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.\n * @returns {Array} Returns the slice of `array`.\n * @example\n *\n * _.take([1, 2, 3]);\n * // => [1]\n *\n * _.take([1, 2, 3], 2);\n * // => [1, 2]\n *\n * _.take([1, 2, 3], 5);\n * // => [1, 2, 3]\n *\n * _.take([1, 2, 3], 0);\n * // => []\n */\nfunction take(array, n, guard) {\n  if (!(array && array.length)) {\n    return [];\n  }\n  n = (guard || n === undefined) ? 1 : toInteger(n);\n  return baseSlice(array, 0, n < 0 ? 0 : n);\n}\n\nmodule.exports = take;\n","//visual helpers\nimport { scaleLinear } from 'd3-scale'\nimport { extent } from 'd3-array'\n\n//data management\nimport groupBy from 'lodash/groupBy'\nimport keyBy from 'lodash/keyBy'\nimport sortBy from 'lodash/sortBy'\nimport uniqBy from 'lodash/uniqBy'\nimport minBy from 'lodash/minBy'\nimport maxBy from 'lodash/maxBy'\nimport mapValues from 'lodash/mapValues'\nimport get from 'lodash/get'\nimport take from 'lodash/take'\nimport sum from 'lodash/sum'\nimport flatten from 'lodash/flatten'\n\nimport datasetLines from './dati/dataset_lines.json'\nimport mappaMotivoTipologia from './dati/mappa_motivo_tipologia.json'\nimport coloriPosizioni from './dati/colori_posizioni.json'\nimport ordineColore from './dati/ordine_colore_y.json'\n\n\nexport const MOTIVO_LINE_HEIGHT = 50;\n\n\n\nexport const motivoExtent = extent(ordineColore, (item) => +item['ordine tipologia'])\n\nexport function makeScalaMotivoY(lineHeight) {\n\n  return scaleLinear().domain(motivoExtent).range([lineHeight, 0])\n}\n\nexport function makeVizData(scaleY) {\n  const ordineByCluster = keyBy(coloriPosizioni, 'valore')\n  const tipologie = ordineColore.map((item) => ({\n    ...item,\n    colore: get(ordineByCluster, item['cluster tipologia']),\n  }))\n  const colors = sortBy(tipologie, (item) => item.colore.ordine).map(\n    (x) => x.colore.colori\n  )\n  const tipologieByTipologia = keyBy(tipologie, (item) => item.tipologia)\n\n  const clusterByMotivo = mapValues(\n    keyBy(mappaMotivoTipologia, 'motivo_type'),\n    (item) => item['cluster tipologie']\n  )\n  const ordineMotivoByMotivo = mapValues(\n    keyBy(ordineColore, 'tipologia'),\n    (item) => +item['ordine tipologia']\n  )\n\n\n// // we must filter items with no scale associated and renormalize data\n// const datasetTmp = datasetLines.filter(item => {\n//   const motivo = item['motivo_type']\n//   return !!get(ordineMotivoByMotivo, motivo)\n// }).map(item => {\n//   const numCaratteri = +item['end_motivo'] -item['start_motivo'] + 1\n//   return {...item, numCaratteri}\n// })\n\n// function normalizeCharters(data) {\n//   let shift = []\n//   let lenHoles = data.reduce((acc, item, i) => {\n//     const motivo = item['motivo_type']\n//     const ordineMotivo = !!get(ordineMotivoByMotivo, motivo)\n//     if (ordineMotivo) {\n//       shift.push({\n//         ...item,\n//         start_motivo: item.start_motivo - acc,\n//         end_motivo: item.end_motivo - acc,\n//       })\n//       return acc\n//     } else {\n//       acc += item.end_motivo - item.start_motivo + 1\n//       return acc\n//     }\n//   }, 0)\n//   // console.log('BEFORE', lenHoles, shift)\n//   lenHoles += ((+shift[0].end_motivo) - shift[0].start_motivo) / 2\n//   lenHoles += ((+shift[shift.length - 1].end_motivo) - shift[shift.length - 1].start_motivo) / 2\n//   console.log('After', lenHoles)\n\n\n//   return shift.map(item => ({\n//     ...item,\n//     'tot caratteri': (+item['tot caratteri']) - lenHoles\n//   }))\n// }\n\n// let datasetTmpByRacconto = groupBy(datasetLines, 'titolo racconto')\n// datasetTmpByRacconto = mapValues(datasetTmpByRacconto, normalizeCharters)\n// const finalDataSet = flatten(Object.values(datasetTmpByRacconto))\n\n// console.log(finalDataSet)\n// const titoli = Object.keys(datasetTmpByRacconto)\n// datasetTmpByRacconto = titoli.reduce((acc, item) => {\n\n//   const data = datasetTmpByRacconto[item]\n//   const len = sum(data.map(item => item.numCaratteri))\n//   acc[item] = len\n//   return acc\n\n// }, {})\n\n\n// const finalDataset = datasetTmp.map(item => ({...item, len:lunghezze[item['titolo racconto']]  }))\n\n\n\n\n  const datasetLinesNormalized = datasetLines.map((item) => {\n    const tot = +item['tot caratteri']\n    const motivo = item['motivo_type']\n    const cluster = get(clusterByMotivo, motivo)\n    const coloreCluster = get(ordineByCluster, `[${cluster}].colori`)\n    const ordineCluster = get(ordineByCluster, `[${cluster}].ordine`)\n    const ordineMotivo = get(ordineMotivoByMotivo, motivo)\n\n    const startMotivoNorm = +item.start_motivo / tot\n    const endMotivoNorm = +item.end_motivo / tot\n    const y =\n      ordineMotivo !== undefined ? scaleY(ordineMotivo) : undefined\n    const x = (startMotivoNorm + endMotivoNorm) / 2\n\n    return {\n      ...item,\n      startMotivoNorm,\n      endMotivoNorm,\n      cluster,\n      coloreCluster,\n      ordineCluster: ordineCluster ? +ordineCluster : undefined,\n      ordineMotivo,\n      y,\n      x,\n    }\n  })\n\n  const byRacconto = groupBy(datasetLinesNormalized, 'titolo racconto')\n\n  let racconti = sortBy(\n    uniqBy(datasetLines, (item) => item['titolo racconto']).map((item) => ({\n      titolo: item['titolo racconto'],\n      anno: item['anno'],\n      mese: item['mese'],\n    })),\n    (item) => {\n      const anno = +item.anno\n      const mese = +item.mese\n\n      return `${anno.toFixed(4)}${mese.toFixed(2)}`\n    }\n  )\n  // //#TODO: remove this (limiting for debug)\n  // racconti = take(racconti, 5)\n  //pre-computing filters\n  racconti = racconti.map((racconto) => {\n    const minDatum = minBy(\n      byRacconto[racconto.titolo],\n      (item) => item.ordineMotivo\n    )\n    const maxDatum = maxBy(\n      byRacconto[racconto.titolo],\n      (item) => item.ordineMotivo\n    )\n    // console.log(123, racconto.titolo, minDatum, maxDatum)\n    return { ...racconto, minDatum, maxDatum }\n  })\n\n  return {\n    tipologie,\n    tipologieByTipologia,\n    colors,\n    racconti,\n    byRacconto,\n  }\n}\n\nexport const splitPath = (d) => {\n  const pieces = d.split('C')\n  const paths = pieces.reduce((acc, item, i) => {\n    if (i === 0) {\n      return acc\n    }\n    if (i === 1) {\n      const path = pieces[0] + 'C' + pieces[i]\n      acc.push(path)\n    } else {\n      const [a, b] = pieces[i - 1].split(',').reverse()\n      const path = `M${b},${a}C${pieces[i]}`\n      acc.push(path)\n    }\n\n    return acc\n  }, [])\n\n  return paths\n}","import React from 'react'\n\nfunction GrandientsDefinitions({ prefix = '', gradientsType, byTipologia }) {\n  return (\n    <defs>\n      {gradientsType.map((gradientType) => {\n        const [tipoFromName, tipoToName] = gradientType.split('-')\n        const tipoFrom = byTipologia[tipoFromName]\n        const tipoTo = byTipologia[tipoToName]\n        return (\n          <linearGradient\n            x1=\"0\"\n            x2=\"0\"\n            y1=\"0\"\n            y2=\"1\"\n            key={gradientType}\n            id={prefix + gradientType}\n          >\n            {+tipoFrom['ordine tipologia'] > +tipoTo['ordine tipologia'] && (\n              <>\n                <stop offset=\"0%\" stopColor={tipoFrom.colore.colori}></stop>\n                <stop offset=\"100%\" stopColor={tipoTo.colore.colori}></stop>\n              </>\n            )}\n            {+tipoFrom['ordine tipologia'] < +tipoTo['ordine tipologia'] && (\n              <>\n                <stop offset=\"0%\" stopColor={tipoTo.colore.colori}></stop>\n                <stop offset=\"100%\" stopColor={tipoFrom.colore.colori}></stop>\n              </>\n            )}\n          </linearGradient>\n        )\n      })}\n    </defs>\n  )\n}\n\nexport default React.memo(GrandientsDefinitions)\n","import React, { useRef, useState, useLayoutEffect, useContext } from 'react'\nimport { CurretTramaViewContext } from './Trama2Content'\n\nconst RaccontoInfoBoxSvg = ({ titolo, x, y = 0, onClick }) => {\n  const containerRef = useRef(null)\n  const [measures, setMeasures] = useState(null)\n  const view = useContext(CurretTramaViewContext)\n\n  useLayoutEffect(() => {\n    const m = containerRef.current.getBoundingClientRect()\n    setMeasures(m)\n  }, [titolo, view])\n\n  return (\n    <g\n      onClick={onClick}\n      transform={`translate(${x}, ${y})`}\n      style={{ cursor: 'pointer' }}\n    >\n      {measures && (\n        <g transform={`translate(${-measures.width - 40}, -15)`}>\n          <rect\n            height={22}\n            width={measures.width + 35}\n            rx={5}\n            className=\"trama2-info-box\"\n          />\n          <line\n            x1={measures.width + 18}\n            x2={measures.width + 18}\n            y1={0}\n            y2={22}\n            className=\"trama2-info-box\"\n          />\n          <text stroke={'var(--dark-blue)'} x={measures.width + 22} y={15}>\n            o\n          </text>\n        </g>\n      )}\n      <text\n        ref={containerRef}\n        x={-30}\n        y={0}\n        style={{ textAnchor: 'end', userSelect: 'none' }}\n      >\n        {titolo}\n      </text>\n    </g>\n  )\n}\n\nexport default RaccontoInfoBoxSvg\n","import React, { useState } from 'react'\nimport Draggable from 'react-draggable'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faArrowLeft, faArrowRight } from '@fortawesome/free-solid-svg-icons'\n\nexport const BRUSH_HANDLE_WIDTH = 12\nconst Brush = React.memo(({\n  width,\n  onNextClick,\n  onPrevClick,\n  x: controlledX,\n  onXChange,\n  className = 'trama2-brush-container',\n}) => {\n  const [uncontrolledX, setX] = useState(width - BRUSH_HANDLE_WIDTH / 2)\n  const x = controlledX === undefined ? uncontrolledX : controlledX\n\n  return (\n    <>\n      <div\n        style={{\n          transform: `translateX(${x + BRUSH_HANDLE_WIDTH / 2}px)`,\n        }}\n        className=\"trama2-index-line\"\n      />\n      <div className={`${className} trama2-brush-container-flex`}>\n        <button\n          className=\"trama2-brush-button trama2-prev-brush-button\"\n          onClick={() => {\n            if (controlledX !== undefined) {\n              onPrevClick()\n              return\n            }\n            onPrevClick(x + BRUSH_HANDLE_WIDTH / 2, (rawNextX) => {\n              const nextX = rawNextX - BRUSH_HANDLE_WIDTH / 2\n              if (nextX >= 0 && x <= width - BRUSH_HANDLE_WIDTH / 2) {\n                setX(nextX)\n              }\n            })\n          }}\n        >\n          <FontAwesomeIcon icon={faArrowLeft} />\n        </button>\n        <div className=\"trama2-list-brush\">\n          <Draggable\n            axis=\"x\"\n            position={{ x, y: 0 }}\n            bounds={{\n              left: 0,\n              right: width - BRUSH_HANDLE_WIDTH / 2,\n            }}\n            onDrag={(e, position) => {\n              if (controlledX === undefined) {\n                setX(position.x)\n              } else {\n                onXChange(position.x)\n              }\n            }}\n          >\n            <div className=\"trama2-drag-handle\" />\n          </Draggable>\n        </div>\n        <button\n          className=\"trama2-brush-button trama2-next-brush-button\"\n          onClick={() => {\n            if (controlledX !== undefined) {\n              onNextClick()\n              return\n            }\n            onNextClick(x + BRUSH_HANDLE_WIDTH / 2, (rawNextX) => {\n              const nextX = rawNextX - BRUSH_HANDLE_WIDTH / 2\n              if (nextX >= 0 && x <= width - BRUSH_HANDLE_WIDTH / 2) {\n                setX(nextX)\n              }\n            })\n          }}\n        >\n          <FontAwesomeIcon icon={faArrowRight} />\n        </button>\n      </div>\n    </>\n  )\n})\nexport default Brush","import ReactDOM from 'react-dom'\nimport React, {\n  useRef,\n  useState,\n  useMemo,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useImperativeHandle,\n  forwardRef,\n} from 'react'\nimport { line, curveMonotoneX } from 'd3-shape'\nimport { scaleLinear } from 'd3-scale'\nimport { zoom } from 'd3-zoom'\nimport { select, selectAll, event as currentEvent } from 'd3-selection'\n\nimport range from 'lodash/range'\n\nimport { splitPath } from './utils'\nimport GradientsDefinitions from './GradientsDefinitions'\nimport RaccontoInfoBoxSvg from './RaccontoInfoBoxSvg'\nimport Brush, { BRUSH_HANDLE_WIDTH } from './Brush'\n\nconst lineGenerator = line()\n  .x((d) => d.x)\n  .y((d) => d.y)\n  .curve(curveMonotoneX)\n\nconst SubPathsWithColors = React.memo(({ subPaths, data, itemSelected }) => {\n  return (\n    <g>\n      {subPaths.map((subPath, i) => {\n        const isFill = data[i + 1].motivo_type === data[i].motivo_type\n        const strokeSelected = isFill\n          ? data[i].colori\n          : `url('#${data[i + 1].motivo_type}-${data[i].motivo_type}')`\n        return (\n          <path\n            key={i}\n            d={subPath}\n            className=\"trama2-line\"\n            style={{\n              stroke: itemSelected ? strokeSelected : '#ddd',\n              fill: 'none',\n            }}\n          ></path>\n        )\n      })}\n    </g>\n  )\n})\n\nconst TramaPoints = React.memo(({ data }) => {\n  return (\n    <g>\n      {data.map((d, i) => {\n        if (i === 0) {\n          return (\n            <rect key={i} x={d.x} y={d.y} className=\"trama2-start-symbol\">\n              <title>{d.motivo_type}</title>\n            </rect>\n          )\n        }\n        if (i === data.length - 1) {\n          return (\n            <rect\n              key={i}\n              x={d.x}\n              y={d.y}\n              style={{\n                transformOrigin: `${d.x - 2}px ${d.y - 2}px`,\n              }}\n              className=\"trama2-end-symbol\"\n            >\n              <title>{d.motivo_type}</title>\n            </rect>\n          )\n        }\n        return (\n          <circle className=\"trama2-circle\" key={i} cx={d.x} cy={d.y} r={2}>\n            <title>{d.motivo_type}</title>\n          </circle>\n        )\n      })}\n    </g>\n  )\n})\n\nconst LineaTrama = React.memo(\n  ({\n    racconto,\n    data,\n    xScale,\n    selectedPoint,\n    width,\n    height,\n    index,\n    gradient,\n    itemSelected,\n    toggleItem,\n    onRaccontoClick,\n  }) => {\n    const [d, subPaths] = useMemo(() => {\n      const d = lineGenerator(data)\n      const subPaths = splitPath(d)\n      return [d, subPaths]\n    }, [data])\n\n    const handleClickRacconto = useCallback(\n      (e) => {\n        onRaccontoClick(data, e)\n      },\n      [onRaccontoClick, data]\n    )\n\n    const element = (\n      <g>\n        <SubPathsWithColors\n          subPaths={subPaths}\n          data={data}\n          itemSelected={itemSelected}\n        />\n        <path\n          d={d}\n          onClick={() => toggleItem(racconto.titolo)}\n          className={`trama2-pointer ${itemSelected ? 'selected' : ''}`}\n        ></path>\n\n        {itemSelected && (\n          <g>\n            <TramaPoints data={data} />\n            <RaccontoInfoBoxSvg\n              onClick={handleClickRacconto}\n              y={-10}\n              x={width}\n              titolo={`${data.racconto.titolo}, ${data.racconto.anno}`}\n            />\n          </g>\n        )}\n        {selectedPoint && (\n          <g>\n            <text\n              style={{\n                transformOrigin: `${selectedPoint.x}px ${selectedPoint.y}px`,\n                transform: `rotate(-30deg) translateX(-10px)`,\n              }}\n              x={selectedPoint.x}\n              y={selectedPoint.y}\n              textAnchor={'end'}\n            >\n              {selectedPoint.motivo_type}\n            </text>\n          </g>\n        )}\n      </g>\n    )\n    if (itemSelected) {\n      return ReactDOM.createPortal(\n        element,\n        document.getElementsByClassName('linea-container-selected')[index]\n      )\n    }\n    return element\n  }\n)\n\nconst SelectedContainers = React.memo(({ n }) => {\n  return (\n    <g>\n      {range(n).map((i) => (\n        <g key={i} className=\"linea-container-selected\" />\n      ))}\n    </g>\n  )\n})\n\nconst LineeTramaList = React.memo(({\n  measures,\n  dataRacconti,\n  currentXHoverRacconti,\n  racconti,\n  onRaccontoClick,\n  height,\n  scalaColore,\n  scalaMotivoY,\n  selected,\n  toggleSelect,\n  xScale,\n}) => {\n  return (\n    <g>\n      {dataRacconti.map((datum, i) => {\n        return (\n          <g key={i} className=\"linea-container\">\n            <LineaTrama\n              selectedPoint={\n                currentXHoverRacconti &&\n                currentXHoverRacconti[racconti[i].titolo]\n                  ? currentXHoverRacconti[racconti[i].titolo]\n                  : null\n              }\n              onRaccontoClick={onRaccontoClick}\n              scalaColore={scalaColore}\n              scalaMotivoY={scalaMotivoY}\n              index={i}\n              width={measures.width}\n              height={height}\n              itemSelected={selected[racconti[i].titolo]}\n              toggleItem={toggleSelect}\n              xScale={xScale}\n              racconto={racconti[i]}\n              data={datum}\n            ></LineaTrama>\n          </g>\n        )\n      })}\n    </g>\n  )\n})\n\nfunction LineeTramaWithMeasures({\n  racconti = [],\n  data = {},\n  height,\n  scalaColore,\n  scalaMotivoY,\n  colors,\n  selected,\n  toggleSelect,\n  onRaccontoClick,\n  tipologie,\n  tipologieByTipologia,\n  setYears,\n  measures,\n}) {\n  const svgRef = useRef(null)\n\n  useEffect(() => {\n    function imperativeTranslate(currentScaleY) {\n      selectAll('.linea-container').attr(\n        'transform',\n        (d, i) => 'translate(0, ' + currentScaleY(i) + ')'\n      )\n      selectAll('.linea-container-selected').attr(\n        'transform',\n        (d, i) => 'translate(0, ' + currentScaleY(i) + ')'\n      )\n    }\n\n    if (measures) {\n      const svg = svgRef.current\n      const scaleY = scaleLinear()\n        .domain([0, racconti.length])\n        .range([0 + height, measures.height - height])\n\n      imperativeTranslate(scaleY)\n\n      function handleZoom() {\n        const newScaleY = currentEvent.transform.rescaleY(scaleY)\n        imperativeTranslate(newScaleY)\n\n        const domain = newScaleY.domain()\n        const lowIndex = Math.max(0, Math.floor(domain[0]))\n        const hiIndex = Math.min(racconti.length - 1, Math.floor(domain[1]))\n\n        setYears((prevYears) => {\n          const newYears = [racconti[lowIndex].anno, racconti[hiIndex].anno]\n          if (newYears[0] !== prevYears[0] || newYears[1] !== prevYears[1]) {\n            return newYears\n          }\n          return prevYears\n        })\n      }\n\n      const selection = select(svg)\n      selection.call(\n        zoom()\n          .scaleExtent([1, 10])\n          .translateExtent([\n            [0, 0],\n            [measures.width, measures.height],\n          ])\n          .on('zoom', handleZoom)\n      )\n      return () => {\n        selection.on('.zoom', null)\n      }\n    }\n  }, [height, measures, racconti, setYears])\n\n  const xScale = useMemo(() => {\n    if (!measures) {\n      return null\n    }\n    return scaleLinear().domain([0, 1]).range([0, measures.width])\n  }, [measures])\n\n  const [dataRacconti, dataByRacconti, gradientsType] = useMemo(() => {\n    if (!xScale) {\n      return [[], []]\n    }\n    const dataByRaccontiFinal = {}\n    const gradientsSet = new Set()\n    const finalDataRacconti = racconti.map((racconto) => {\n      let out = data[racconto.titolo].filter((d) => d.y !== undefined)\n      out = out.map((d, i) => {\n        if (i > 0) {\n          gradientsSet.add(d.motivo_type + '-' + out[i - 1].motivo_type)\n        }\n        return {\n          ...d,\n          colori: tipologieByTipologia[d.motivo_type].colore.colori,\n          originalX: d.x,\n          x: xScale(d.x),\n          y: d.y,\n        }\n      })\n      out.racconto = racconto\n      dataByRaccontiFinal[racconto.titolo] = out\n      return out\n    })\n    return [finalDataRacconti, dataByRaccontiFinal, Array.from(gradientsSet)]\n  }, [data, racconti, xScale, tipologieByTipologia])\n\n  const [x, setX] = useState(measures.width - BRUSH_HANDLE_WIDTH / 2)\n\n  const handleNexPoint = useCallback(() => {\n    const nextPoints = Object.keys(selected).reduce((acc, titolo) => {\n      const dataTrama = dataByRacconti[titolo]\n      dataTrama.forEach((datum) => {\n        if (datum.x > x + BRUSH_HANDLE_WIDTH / 2) {\n          acc.push(datum.x)\n        }\n      })\n      return acc\n    }, [])\n    if (nextPoints.length) {\n      const nextX = Math.min(...nextPoints) - BRUSH_HANDLE_WIDTH / 2\n      if (nextX >= 0 && x <= measures.width - BRUSH_HANDLE_WIDTH / 2) {\n        setX(nextX)\n      }\n    }\n  }, [dataByRacconti, measures, selected, x])\n\n  const handlePrevPoint = useCallback(() => {\n    const nextPoints = Object.keys(selected).reduce((acc, titolo) => {\n      const dataTrama = dataByRacconti[titolo]\n      dataTrama.forEach((datum) => {\n        if (datum.x < x + BRUSH_HANDLE_WIDTH / 2) {\n          acc.push(datum.x)\n        }\n      })\n      return acc\n    }, [])\n    if (nextPoints.length) {\n      const nextX = Math.max(...nextPoints) - BRUSH_HANDLE_WIDTH / 2\n      if (nextX >= 0 && x <= measures.width - BRUSH_HANDLE_WIDTH / 2) {\n        setX(nextX)\n      }\n    }\n  }, [dataByRacconti, selected, measures, x])\n\n  const trameByPoints = useMemo(() => {\n    return Object.keys(selected).reduce((acc, titolo) => {\n      const racconto = dataByRacconti[titolo]\n      racconto.forEach((datum) => {\n        const xKey = datum.x.toFixed(0)\n        acc[xKey] = acc[xKey] || {}\n        acc[xKey][titolo] = {\n          motivo_type: datum.motivo_type,\n          x: datum.x,\n          y: datum.y,\n        }\n      })\n      return acc\n    }, {})\n  }, [selected, dataByRacconti])\n\n  const xPoint = +x.toFixed(0) + BRUSH_HANDLE_WIDTH / 2\n  const currentXHoverRacconti = trameByPoints[xPoint]\n\n  return (\n    <>\n      <div className=\"trama2-top-legend-list\">\n        Scrolla per zoomare\n      </div>\n      <svg\n        style={{\n          height: measures.height,\n          width: measures.width,\n        }}\n        ref={svgRef}\n      >\n        <GradientsDefinitions\n          byTipologia={tipologieByTipologia}\n          gradientsType={gradientsType}\n        />\n        <g className=\"wrapper\">\n          <LineeTramaList\n            measures={measures}\n            dataRacconti={dataRacconti}\n            currentXHoverRacconti={currentXHoverRacconti}\n            racconti={racconti}\n            onRaccontoClick={onRaccontoClick}\n            height={height}\n            scalaColore={scalaColore}\n            scalaMotivoY={scalaMotivoY}\n            selected={selected}\n            toggleSelect={toggleSelect}\n            xScale={xScale}\n          />\n          <SelectedContainers n={dataRacconti.length} />\n        </g>\n      </svg>\n      <Brush\n        x={x}\n        onXChange={setX}\n        onPrevClick={handlePrevPoint}\n        onNextClick={handleNexPoint}\n        width={measures.width}\n        className=\"trama2-brush-for-list\"\n      />\n      <div className=\"trama2-brush-legend-list\">\n        <div>Inizio del testo</div>\n        <div>Lunghezza del testo in caratteri</div>\n        <div>Fine del testo</div>\n      </div>\n    </>\n  )\n}\n\nfunction LineeTrama(props, ref) {\n  const containerRef = useRef(null)\n  const [measures, setMeasures] = useState(null)\n\n  useLayoutEffect(() => {\n    const m = containerRef.current.getBoundingClientRect()\n    setMeasures(m)\n  }, [])\n\n  useImperativeHandle(ref, () => ({\n    rotateView: (cb) => {\n      cb()\n      // const scaleY = scaleLinear()\n      //   .domain([0, racconti.length])\n      //   .range([0 + height, measures.height - height])\n\n      // const mainTransition = selectAll('.linea-container')\n      //   .transition()\n      //   .duration(1000)\n      //   .attr('transform', (d, i) => 'translate(0, ' + scaleY(i) + ')')\n      //   .end()\n\n      // const selectedTransition = selectAll('.linea-container-selected')\n      //   .transition()\n      //   .duration(1000)\n      //   .attr('transform', (d, i) => 'translate(0, ' + scaleY(i) + ')')\n      //   .end()\n\n      // Promise.all([mainTransition, selectedTransition]).then(cb)\n    },\n  }))\n\n  return (\n    <div\n      ref={containerRef}\n      className=\"w-100 h-100\"\n      style={{ overflow: 'hidden' }}\n    >\n      {measures && <LineeTramaWithMeasures {...props} measures={measures} />}\n    </div>\n  )\n}\n\nexport default React.memo(forwardRef(LineeTrama))\n","import React from 'react'\n\nfunction BoxPlotGrandientsDefinitions({ prefix = '', gradientsType, byTipologia, scalaMotivo, height }) {\n  \n  const colorsItems = Object.values(byTipologia).sort(item => +item.ordineMotivo)\n  const delta = 100 / (colorsItems.length - 1)\n\n  return (\n    <defs>\n      {gradientsType.map(({racconto, uniqueItems}) => {\n        \n        \n        \n        \n        const motivi = uniqueItems.map(item => item.motivo_type)\n\n      \n        return (\n          <linearGradient\n            x1=\"0\"\n            x2=\"0\"\n            y1=\"0\"\n            y2={height}\n            key={racconto.titolo}\n            id={prefix + racconto.titolo}\n            gradientUnits={'userSpaceOnUse'}\n          >\n            {colorsItems.map((item, i) => {\n              if(motivi.indexOf(item.tipologia) === -1){\n                return null\n              }\n              return <stop key={i} offset={`${delta*i}%`} stopColor={item.colore.colori}>\n\n\n              </stop>\n            })}\n            {/* <stop offset=\"0%\" stopColor=\"#000\"></stop>\n            <stop offset=\"100%\" stopColor=\"#fff\"></stop> */}\n            {/* {+tipoFrom['ordine tipologia'] > +tipoTo['ordine tipologia'] && (\n              <>\n                <stop offset=\"0%\" stopColor={tipoFrom.colore.colori}></stop>\n                <stop offset=\"100%\" stopColor={tipoTo.colore.colori}></stop>\n              </>\n            )}\n            {+tipoFrom['ordine tipologia'] < +tipoTo['ordine tipologia'] && (\n              <>\n                <stop offset=\"0%\" stopColor={tipoTo.colore.colori}></stop>\n                <stop offset=\"100%\" stopColor={tipoFrom.colore.colori}></stop>\n              </>\n            )} */}\n          </linearGradient>\n        )\n      })}\n    </defs>\n  )\n}\n\nexport default React.memo(BoxPlotGrandientsDefinitions)\n","import ReactDOM from 'react-dom'\nimport React, {\n  useRef,\n  useState,\n  useMemo,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  forwardRef,\n} from 'react'\nimport { scaleLinear } from 'd3-scale'\nimport { zoom } from 'd3-zoom'\nimport { select, selectAll, event as currentEvent } from 'd3-selection'\n\nimport head from 'lodash/head'\nimport _last from 'lodash/last'\nimport uniqBy from 'lodash/uniqBy'\nimport minBy from 'lodash/minBy'\nimport maxBy from 'lodash/maxBy'\n\nimport { motivoExtent } from './utils'\nimport BoxPlotGradientsDefinitions from './BoxPlotGradientsDefinitions'\nimport Brush from './Brush'\n\nconst BoxPlotElement = React.memo(\n  ({\n    zoomFactor,\n    racconto,\n    data,\n    xScale,\n    width,\n    height,\n    index,\n    gradient,\n    itemSelected,\n    toggleItem,\n    yScale,\n    onRaccontoClick,\n  }) => {\n    const handleClickRacconto = useCallback(\n      (e) => {\n        onRaccontoClick(data, e)\n      },\n      [onRaccontoClick, data]\n    )\n\n    const top = yScale(data.min.ordineMotivo)\n    const bottom = yScale(data.max.ordineMotivo)\n    const h = bottom - top\n\n    const fill = itemSelected ? `url(\"#${data.racconto.titolo}\")` : '#ddd'\n    const widthBar = 5 * zoomFactor\n\n    return (\n      <g>\n        {itemSelected && (\n          <text\n            style={{ transform: 'rotate(-30deg)', fontSize: 12 }}\n            x={0} y={0}>{data.racconto.titolo}</text>\n        )}\n        <rect\n          width={widthBar}\n          height={h}\n          y={top}\n          style={{ fill }}\n          onClick={() => toggleItem(data.racconto.titolo)}\n          stroke=\"#ccc\"\n          fillOpacity={0.6}\n        >\n          <title>{data.racconto.titolo}</title>\n        </rect>\n\n        <rect\n          width={widthBar}\n          height={widthBar}\n          style={{ fill: '#fff', stroke: '#000' }}\n          y={yScale(data.first.ordineMotivo)}\n        ></rect>\n        <rect\n          width={widthBar}\n          height={widthBar}\n          style={{ fill: '#ddd', stroke: '#000' }}\n          y={yScale(data.last.ordineMotivo)}\n        ></rect>\n      </g>\n    )\n  }\n)\n\nfunction BoxPlot(\n  {\n    racconti = [],\n    data = {},\n    height,\n    scalaColore,\n    scalaMotivoY,\n    colors,\n    selected,\n    toggleSelect,\n    onRaccontoClick,\n    tipologie,\n    tipologieByTipologia,\n  },\n  ref\n) {\n  const containerRef = useRef(null)\n  const svgRef = useRef(null)\n  const [measures, setMeasures] = useState(null)\n  const [translations, setTranslations] = useState([])\n  const [zoomFactor, setZoomFactor] = useState(1)\n\n  const actualScaleX = useRef(null)\n\n  useLayoutEffect(() => {\n    const m = containerRef.current.getBoundingClientRect()\n    setMeasures(m)\n  }, [])\n\n  useEffect(() => {\n    function declarativeTranslate(currentScaleX) {\n      const newTranslates = racconti.map((r, i) => {\n        return 'translate(' + currentScaleX(i) + ', 0)'\n      })\n      setTranslations(newTranslates)\n    }\n\n    function imperativeTranslate(currentScaleX) {\n      selectAll('.box-racconto-container').attr(\n        'transform',\n        (d, i) => 'translate(' + currentScaleX(i) + ', 0)'\n      )\n    }\n\n    if (measures) {\n      const svg = svgRef.current\n      const scaleX = scaleLinear()\n        .domain([0, racconti.length])\n        .range([10, measures.width - 10])\n\n      actualScaleX.current = scaleX\n      imperativeTranslate(scaleX)\n      // declarativeTranslate(scaleY)\n\n      function handleZoom() {\n        const newScaleX = currentEvent.transform.rescaleX(scaleX)\n        imperativeTranslate(newScaleX)\n        const zoomFactor = Math.round(currentEvent.transform.k / 2)\n\n        const domain = newScaleX.domain()\n        const lowIndex = Math.max(0, Math.floor(domain[0]))\n        const hiIndex = Math.min(racconti.length - 1, Math.floor(domain[1]))\n        const batchUpdates = ReactDOM.unstable_batchedUpdates || ((cb) => cb())\n        batchUpdates(() => {\n          setZoomFactor(zoomFactor)\n          setYears((prevYears) => {\n            const newYears = [racconti[lowIndex].anno, racconti[hiIndex].anno]\n            if (newYears[0] !== prevYears[0] || newYears[1] !== prevYears[1]) {\n              return newYears\n            }\n            return prevYears\n          })\n        })\n        actualScaleX.current = newScaleX\n        // declarativeTranslate(newScaleX)\n      }\n\n      const selection = select(svg)\n      selection.call(zoom().scaleExtent([1, 5]).on('zoom', handleZoom))\n      return () => {\n        selection.on('.zoom', null)\n      }\n    }\n  }, [height, measures, racconti])\n\n  const yScale = useMemo(() => {\n    return scaleLinear().domain(motivoExtent).range([0, height - 160])\n  }, [height])\n\n  const scalaMotivo = useMemo(() => {\n    return scaleLinear().domain(motivoExtent).range([0, 1])\n  }, [])\n\n  const [dataRacconti, dataByRacconti, gradientsType] = useMemo(() => {\n    if (!yScale) {\n      return [[], []]\n    }\n    const finalDataByRacconti = {}\n    const gradientsSet = new Set()\n    const finalDataRacconti = racconti.map((racconto, i) => {\n      let dataForRacconto = data[racconto.titolo]\n        .filter((d) => d.y !== undefined)\n        .map((d) => ({\n          ...d,\n          colori: tipologieByTipologia[d.motivo_type].colore.colori,\n        }))\n      let first = head(dataForRacconto)\n      let last = _last(dataForRacconto)\n      let uniqueItems = uniqBy(\n        dataForRacconto,\n        (item) => item.motivo_type\n      ).sort((item) => item.ordineMotivo)\n      let min = minBy(dataForRacconto, (item) => item.ordineMotivo)\n      let max = maxBy(dataForRacconto, (item) => item.ordineMotivo)\n\n      let out = {\n        racconto,\n        first,\n        last,\n        min,\n        max,\n        uniqueItems,\n        index: i,\n      }\n      finalDataByRacconti[racconto.titolo] = out\n      gradientsSet.add(out)\n\n      out.racconto = racconto\n\n      return out\n    })\n    return [finalDataRacconti, finalDataByRacconti, Array.from(gradientsSet)]\n  }, [data, racconti, tipologieByTipologia, yScale])\n\n  const handleNexPoint = useCallback(\n    (x, setX) => {\n      const widthBar = 5 * zoomFactor\n      const scaleX = actualScaleX.current\n      const nextPoints = Object.keys(selected).reduce((acc, titolo) => {\n        const dataTrama = dataByRacconti[titolo]\n        const realX = scaleX(dataTrama.index)\n        if (realX > x - widthBar / 2) {\n          acc.push(realX)\n        }\n        return acc\n      }, [])\n      if (nextPoints.length) {\n        console.log('NEXT', nextPoints, x)\n        setX(Math.min(...nextPoints) + widthBar / 2)\n      }\n    },\n    [dataByRacconti, selected, zoomFactor]\n  )\n\n  const handlePrevPoint = useCallback(\n    (x, setX) => {\n      const widthBar = 10 * zoomFactor\n      const scaleX = actualScaleX.current\n      const nextPoints = Object.keys(selected).reduce((acc, titolo) => {\n        const dataTrama = dataByRacconti[titolo]\n        const realX = scaleX(dataTrama.index)\n        if (realX < x - widthBar / 2) {\n          acc.push(realX)\n        }\n        return acc\n      }, [])\n      if (nextPoints.length) {\n        console.log('PREV', nextPoints, x)\n        setX(Math.max(...nextPoints) + widthBar / 2)\n      }\n    },\n    [dataByRacconti, selected, zoomFactor]\n  )\n\n  const [years, setYears] = useState([\n    racconti[0].anno,\n    racconti[racconti.length - 1].anno,\n  ])\n\n  return (\n    <div className=\"trama2-boxplot-content\">\n      <div\n        ref={containerRef}\n        className=\"w-100 h-100\"\n        style={{ overflow: 'hidden' }}\n      >\n        {measures && (\n          <svg\n            style={{\n              height: height,\n              width: measures.width,\n            }}\n            ref={svgRef}\n          >\n            <BoxPlotGradientsDefinitions\n              byTipologia={tipologieByTipologia}\n              gradientsType={gradientsType}\n              scalaMotivo={scalaMotivo}\n              height={measures.height}\n            />\n            <g className=\"wrapper\" style={{ transform: 'translate(0, 70px)' }}>\n              {measures &&\n                dataRacconti.map((datum, i) => {\n                  return (\n                    <g\n                      key={i}\n                      className=\"box-racconto-container\"\n                      style={{\n                        transform: translations[i],\n                      }}\n                    >\n                      <BoxPlotElement\n                        zoomFactor={zoomFactor}\n                        onRaccontoClick={onRaccontoClick}\n                        scalaColore={scalaColore}\n                        scalaMotivoY={scalaMotivoY}\n                        index={i}\n                        width={measures.width}\n                        height={measures.height}\n                        itemSelected={selected[racconti[i].titolo]}\n                        toggleItem={toggleSelect}\n                        racconto={racconti[i]}\n                        yScale={yScale}\n                        data={datum}\n                      ></BoxPlotElement>\n                    </g>\n                  )\n                })}\n            </g>\n          </svg>\n        )}\n      </div>\n      {measures && (\n        <Brush\n          className='trama2-brush-for-detail'\n          width={measures.width}\n          onNextClick={handleNexPoint}\n          onPrevClick={handlePrevPoint}\n        />\n      )}\n      <div className=\"trama2-box-plot-year\">\n        <div>{years[0]}</div>\n        <div>Testi per ordine cronologico</div>\n        <div>{years[1]}</div>\n      </div>\n    </div>\n  )\n}\n\nexport default forwardRef(BoxPlot)\n","import React, { useMemo, useRef, useLayoutEffect, useState } from 'react'\nimport { line, curveMonotoneX } from 'd3-shape'\nimport { scaleLinear } from 'd3-scale'\nimport { makeScalaMotivoY, splitPath } from './utils'\nimport GradientsDefinitions from './GradientsDefinitions'\n\nconst CHART_X_PADDING = 50\n\nconst lineGenerator = line()\n  .x((d) => d.x)\n  .y((d) => d.y)\n  .curve(curveMonotoneX)\n\nexport default function TramaDetail({\n  data,\n  tipologieByTipologia,\n  onBack,\n  detailHeight,\n}) {\n  const [measures, setMeasures] = useState(null)\n\n  useLayoutEffect(() => {\n    const m = containerRef.current.getBoundingClientRect()\n    setMeasures(m)\n  }, [])\n\n  const scalaMotivoY = useMemo(() => {\n    return makeScalaMotivoY(detailHeight)\n  }, [detailHeight])\n\n  const xScale = useMemo(() => {\n    if (!measures) {\n      return null\n    }\n    return scaleLinear()\n      .domain([0, 1])\n      .range([CHART_X_PADDING, measures.width - CHART_X_PADDING])\n  }, [measures])\n\n  // Re-Scale X, Y for fullscreen\n  const [fullData, subPaths, gradientsType] = useMemo(() => {\n    if (!xScale) {\n      return [null, null, null]\n    }\n    const gradientsSet = new Set()\n    const newData = data.reduce((acc, item, i) => {\n      if (i > 0) {\n        gradientsSet.add(item.motivo_type + '-' + acc[i - 1].motivo_type)\n      }\n      acc.push({\n        ...item,\n        x: xScale(item.originalX),\n        y: scalaMotivoY(item.ordineMotivo),\n      })\n      return acc\n    }, [])\n    const d = lineGenerator(newData)\n    const subPaths = splitPath(d)\n    return [newData, subPaths, Array.from(gradientsSet)]\n  }, [data, scalaMotivoY, xScale])\n  const containerRef = useRef(null)\n\n  return (\n    <div className=\"trama2-detail-content\">\n      <div className=\"trama2-detail-header d-flex justify-content-center align-items-center\">\n        <div className=\"trama2-detail-label\">\n          <div className=\"trama2-label-inner-start\">\n            {data.racconto.titolo}, {data.racconto.anno}\n          </div>\n          <div className=\"trama2-label-inner-end\" onClick={onBack}>\n            &times;\n          </div>\n        </div>\n      </div>\n\n      <div\n        ref={containerRef}\n        className=\"w-100 h-100\"\n        style={{ overflow: 'hidden' }}\n      >\n        {measures && (\n          <svg\n            style={{\n              height: detailHeight + 70,\n              width: measures.width,\n            }}\n          >\n            <GradientsDefinitions\n              prefix=\"detail__\"\n              byTipologia={tipologieByTipologia}\n              gradientsType={gradientsType}\n            />\n            <g transform={`translate(0, 70)`}>\n              {subPaths.map((subPath, i) => {\n                const isFill = data[i + 1].motivo_type === data[i].motivo_type\n                const stroke = isFill\n                  ? data[i].colori\n                  : `url('#detail__${data[i + 1].motivo_type}-${\n                      data[i].motivo_type\n                    }')`\n                return (\n                  <path\n                    key={i}\n                    d={subPath}\n                    className=\"trama2-line\"\n                    style={{\n                      stroke: stroke,\n                      fill: 'none',\n                    }}\n                  ></path>\n                )\n              })}\n              <g>\n                {fullData.map((d, i) => {\n                  let element\n                  if (i === 0) {\n                    element = (\n                      <rect\n                        x={0}\n                        y={0}\n                        className=\"trama2-start-symbol\"\n                      />\n                    )\n                  } else if (i === data.length - 1) {\n                    element = (\n                      <rect\n                        x={0}\n                        y={1}\n                        className=\"trama2-end-symbol\"\n                      />\n                    )\n                  } else {\n                    element = <circle className=\"trama2-circle\" r={2} />\n                  }\n                  return (\n                    <g key={i} transform={`translate(${d.x}, ${d.y})`}>\n                      {element}\n                      <text\n                        x={5}\n                        y={-5}\n                        style={{ transform: 'rotate(-30deg)' }}\n                      >\n                        {d.motivo_type}\n                      </text>\n                    </g>\n                  )\n                })}\n              </g>\n            </g>\n          </svg>\n        )}\n      </div>\n    </div>\n  )\n}\n","import React, { useMemo } from 'react'\nimport keyBy from 'lodash/keyBy'\n\nexport default function SideBar({\n  tipologie,\n  racconti,\n  height,\n  bounds,\n  addBound,\n  setBounds,\n}) {\n  const boundsByKey = keyBy(bounds)\n\n  const itemHeight = height / tipologie.length\n\n  const lookupMap = useMemo(() => {\n    return racconti.reduce(\n      (looks, racconto) => {\n        const min = racconto.minDatum.motivo_type\n        const max = racconto.maxDatum.motivo_type\n        looks[min] = looks[min] || {}\n        looks[max] = looks[max] || {}\n        looks[min][max] = true\n        looks[max][min] = true\n        return looks\n      },\n      [{}]\n    )\n  }, [racconti])\n  let lookup = null\n  if (bounds.length === 1) {\n    lookup = lookupMap[bounds[0]]\n  }\n\n  return (\n    <div className=\"trama2-sidebar\">\n      <div className=\"trama2-sidebar-header\">\n        Ordine <br />\n        di turbamento\n      </div>\n      {tipologie.map((tipologia) => (\n        <div\n          key={tipologia.tipologia}\n          onClick={addBound(tipologia.tipologia)}\n          className={`trama2-sidebar-item\n          ${\n            lookup !== null &&\n            tipologia.tipologia !== bounds[0] &&\n            (!lookup || !lookup[tipologia.tipologia])\n              ? 'disabled'\n              : ''\n          }\n          ${boundsByKey[tipologia.tipologia] ? 'selected' : ''}`}\n          style={{\n            height: itemHeight,\n            background: boundsByKey[tipologia.tipologia]\n              ? tipologia.colore.colori\n              : undefined,\n          }}\n        >\n          {tipologia.tipologia}\n        </div>\n      ))}\n      <div className='trama2-sidebar-footer'>\n        Clicca per scegliere il <br/>\n        punto più alto e più basso<br />\n        delle curve\n      </div>\n      {/* <div>\n        {bounds.length > 0 && (\n          <span\n            onClick={() => {\n              setBounds([])\n            }}\n          >\n            Clear\n          </span>\n        )}\n      </div> */}\n    </div>\n  )\n}\n","import React, {\n  useLayoutEffect,\n  useState,\n  useCallback,\n  useEffect,\n  useRef,\n  createContext,\n} from 'react'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faAngleDoubleRight } from '@fortawesome/free-solid-svg-icons'\n\n//data management\nimport keyBy from 'lodash/keyBy'\nimport sortBy from 'lodash/sortBy'\n\n//data helpers\nimport { MOTIVO_LINE_HEIGHT } from './utils'\n\n//local components\nimport LineeTrama from './LineeTrama'\nimport BoxPlot from './BoxPlot'\nimport TramaDetail from './TramaDetail'\nimport SideBar from './SideBar'\n\nexport const CurretTramaViewContext = createContext('list')\n\n// main component\nexport default function Trama2Content({\n  scalaMotivoY,\n  tipologie,\n  tipologieByTipologia,\n  colors,\n  racconti,\n  byRacconto,\n  selected,\n  toggleSelect,\n  setSelected,\n}) {\n  const [sidePanelOpen, setSidePanelOpen] = useState(false)\n  const toggleSidePanel = useCallback(() => {\n    setSidePanelOpen(!sidePanelOpen)\n  }, [sidePanelOpen])\n\n  const containerRef = useRef()\n  const [measures, setMeasures] = useState(null)\n  useLayoutEffect(() => {\n    const m = containerRef.current.getBoundingClientRect()\n    setMeasures(m)\n  }, [])\n\n  //bounds selection\n  const [bounds, setBounds] = useState([])\n  const addBound = useCallback(\n    (item) => () => {\n      if (bounds.length === 1 && bounds[0] === item) {\n        setBounds([])\n        return\n      }\n      if (bounds.length < 2) {\n        setBounds(bounds.concat([item]))\n      } else {\n        setBounds([item])\n      }\n    },\n    [bounds]\n  )\n\n  useEffect(() => {\n    if (bounds.length === 2) {\n      const orderedBounds = sortBy(\n        bounds,\n        (bound) => +tipologieByTipologia[bound]['ordine tipologia']\n      )\n      const indexes = racconti.reduce((acc, racconto, indenx) => {\n        if (\n          racconto.minDatum.motivo_type === orderedBounds[0] &&\n          racconto.maxDatum.motivo_type === orderedBounds[1]\n        ) {\n          acc.push(racconto.titolo)\n        }\n        return acc\n      }, [])\n\n      const sel = keyBy(indexes)\n      setSelected(sel, true)\n    }\n  }, [bounds, racconti, setSelected, tipologieByTipologia])\n\n  useEffect(() => {\n    if (\n      Object.keys(selected).some((key) => selected[key].fromBounds === false)\n    ) {\n      setBounds([])\n    }\n  }, [selected])\n\n  const listRef = useRef()\n  const [currentView, setCurrentView] = useState('list')\n  const [currentTramaDetail, setCurrentTramaDetail] = useState(null)\n\n  const handleClickRacconto = useCallback((data) => {\n    setCurrentTramaDetail(data)\n    setCurrentView('detail')\n  }, [])\n\n  const [years, setYears] = useState([\n    racconti[0].anno,\n    racconti[racconti.length - 1].anno,\n  ])\n\n  return (\n    <div className=\"trama2-container\" ref={containerRef}>\n      <div className={`trama2-side-panel ${sidePanelOpen ? 'open' : 'closed'}`}>\n        <div className=\"trama2-side-panel-content\">\n          {measures && (\n            <SideBar\n              racconti={racconti}\n              height={measures.height - 140}\n              tipologie={tipologie}\n              bounds={bounds}\n              addBound={addBound}\n              setBounds={setBounds}\n            ></SideBar>\n          )}\n        </div>\n\n        <div\n          className={`trama2-side-panel-toggle ${\n            sidePanelOpen ? 'open-panel' : ''\n          }`}\n          onClick={toggleSidePanel}\n        >\n          <FontAwesomeIcon icon={faAngleDoubleRight} />\n        </div>\n\n        {currentView !== 'detail' && (\n          <div\n            className=\"trama2-side-panel-rotate\"\n            onClick={() => {\n              if (currentView === 'list') {\n                listRef.current.rotateView(() => {\n                  setCurrentView('boxplot')\n                })\n              } else {\n                setCurrentView('list')\n              }\n            }}\n          >\n            Routa la vista\n          </div>\n        )}\n      </div>\n      <div className=\"trama2-content-wrapper\">\n        {currentView === 'list' && (\n          <>\n            <div\n              style={{\n                position: 'absolute',\n                top: 80 + MOTIVO_LINE_HEIGHT,\n                borderBottom: 'solid #bbb 1px',\n              }}\n            >\n              {years[0]}\n            </div>\n            <div\n              style={{\n                position: 'absolute',\n                bottom: MOTIVO_LINE_HEIGHT + 30,\n                borderBottom: 'solid #bbb 1px',\n              }}\n            >\n              {years[1]}\n            </div>\n          </>\n        )}\n\n        <CurretTramaViewContext.Provider value={currentView}>\n          <div\n            className=\"trama2-content\"\n            style={{ display: currentView !== 'list' ? 'none' : undefined }}\n          >\n            <LineeTrama\n              onRaccontoClick={handleClickRacconto}\n              ref={listRef}\n              selected={selected}\n              toggleSelect={toggleSelect}\n              racconti={racconti}\n              tipologie={tipologie}\n              tipologieByTipologia={tipologieByTipologia}\n              data={byRacconto}\n              height={MOTIVO_LINE_HEIGHT}\n              scalaMotivoY={scalaMotivoY}\n              colors={colors}\n              setYears={setYears}\n            ></LineeTrama>\n          </div>\n\n          {currentView === 'boxplot' && measures && (\n            <BoxPlot\n              onRaccontoClick={handleClickRacconto}\n              ref={listRef}\n              selected={selected}\n              toggleSelect={toggleSelect}\n              racconti={racconti}\n              tipologie={tipologie}\n              tipologieByTipologia={tipologieByTipologia}\n              data={byRacconto}\n              height={measures.height}\n              scalaMotivoY={scalaMotivoY}\n              colors={colors}\n            ></BoxPlot>\n          )}\n          {currentView === 'detail' && measures && (\n            <TramaDetail\n              tipologieByTipologia={tipologieByTipologia}\n              detailHeight={measures.height - 140}\n              data={currentTramaDetail}\n              onBack={() => {\n                setCurrentTramaDetail(null)\n                setCurrentView('list')\n              }}\n            />\n          )}\n        </CurretTramaViewContext.Provider>\n      </div>\n    </div>\n  )\n}\n","import React, { useCallback, useState, useMemo } from 'react'\nimport MainMenu from '../../general/MainMenu'\nimport PageTitle from '../../general/PageTitle'\nimport MoreInfo from '../../general/MoreInfo'\nimport CompassButton from '../../general/CompassButton/CompassButton'\nimport SearchDropDown from '../../general/Search/SearchDropDownControlled'\nimport HelpSidePanel from '../../panels/HelpSidePanel/HelpSidePanel'\n\nimport AltOptions from '../../general/Options/AltOptions'\nimport GlobalData from '../../utilities/GlobalData'\nimport Trama2Content from './Trama2Content'\nimport { makeScalaMotivoY, makeVizData, MOTIVO_LINE_HEIGHT } from './utils'\nimport keyBy from 'lodash/keyBy'\nimport './Trama2.css'\n\n// SCALES\nconst scalaMotivoY = makeScalaMotivoY(MOTIVO_LINE_HEIGHT)\n\n// GLOBAL DATA\nconst {\n  tipologie,\n  tipologieByTipologia,\n  colors,\n  racconti,\n  byRacconto,\n} = makeVizData(scalaMotivoY)\n\n// we leverage react lazy+suspense to load core component at first render (it will load all json by importing it)\n\nconst searchOptions = racconti.map((racconto) => ({\n  label: racconto.titolo,\n  value: racconto.titolo,\n}))\n\nconst cercaOptions = [{ label: 'Volume' }]\n\nfunction Trama2Main({ title }) {\n  const [helpSidePanelOpen, setHelpSidePanelOpen] = useState(false)\n  const [ricerca, setRicerca] = useState([])\n\n  const toggleHelpSidePanel = useCallback(() => {\n    setHelpSidePanelOpen((a) => !a)\n  }, [])\n\n  const helpPage = GlobalData.helpPages.plot.main\n\n  const setSelected = useCallback((selection, fromBounds = false) => {\n    const newRicerca = Object.keys(selection).map((titolo) => ({\n      label: titolo,\n      value: titolo,\n      fromBounds,\n    }))\n    setRicerca(newRicerca)\n  }, [])\n\n  const toggleSelect = useCallback((titolo) => {\n    setRicerca((ricerca) => {\n      let clearedBounds = false\n      const newRicerca = ricerca.filter((item) => {\n        // Remove from bounds items\n        if (item.fromBounds === true) {\n          clearedBounds = true\n          return false\n        }\n        return item.label !== titolo\n      })\n      if (newRicerca.length < ricerca.length && !clearedBounds) {\n        return newRicerca\n      } else {\n        return newRicerca.concat({ label: titolo, value: titolo })\n      }\n    })\n  }, [])\n  const selected = useMemo(() => {\n    return keyBy(\n      ricerca.map((item) => ({\n        value: item.value,\n        fromBounds: item.fromBounds === undefined ? false : item.fromBounds,\n      })),\n      'value'\n    )\n  }, [ricerca])\n\n  return (\n    <div className=\"trasformare main\">\n      <HelpSidePanel\n        open={helpSidePanelOpen}\n        page={helpPage}\n        closeButtonClicked={toggleHelpSidePanel}\n      />\n\n      <div className=\"top-nav navigations\">\n        <MainMenu className=\"main-menu\" style={{ gridColumn: 'span 1' }} />\n        <PageTitle title={title} style={{ gridColumn: 'span 10' }} />\n\n        <AltOptions\n          title=\"Cerca per\"\n          options={cercaOptions}\n          disabled={true}\n          value={'Volume'}\n          onChange={(x) => {}}\n          style={{\n            gridColumn: 'span 3',\n          }}\n        />\n\n        <SearchDropDown\n          style={{\n            gridColumn: 'span 8',\n          }}\n          data={{ options: searchOptions }}\n          changeOptions={(newOptions) => {\n            setRicerca(newOptions.map(o => ({\n              ...o,\n              fromBounds: false\n            })))\n          }}\n          selectedOptions={ricerca}\n        />\n\n        <MoreInfo\n          style={{ gridColumn: 'span 1' }}\n          onClicked={toggleHelpSidePanel}\n        />\n        <CompassButton\n          style={{\n            gridColumn: 'span 1',\n            color: 'white',\n            backgroundColor: 'black',\n          }}\n        />\n      </div>\n\n      <Trama2Content\n        scalaMotivoY={scalaMotivoY}\n        tipologie={tipologie}\n        tipologieByTipologia={tipologieByTipologia}\n        colors={colors}\n        racconti={racconti}\n        byRacconto={byRacconto}\n        selected={selected}\n        setSelected={setSelected}\n        toggleSelect={toggleSelect}\n      ></Trama2Content>\n    </div>\n  )\n}\n\nexport default Trama2Main\n"],"sourceRoot":""}