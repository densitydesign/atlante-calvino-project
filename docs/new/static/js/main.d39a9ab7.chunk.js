(window["webpackJsonpatlante-calvino-project"]=window["webpackJsonpatlante-calvino-project"]||[]).push([[0],{108:function(t,e,n){t.exports=n(284)},113:function(t,e,n){},114:function(t,e,n){},115:function(t,e,n){},122:function(t,e,n){},123:function(t,e,n){},124:function(t,e,n){},125:function(t,e,n){},282:function(t,e,n){},283:function(t,e,n){},284:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),i=n(14),o=n.n(i),s=(n(113),n(114),n(115),n(116),n(39)),c=n(4),l=n(5),u=n(7),d=n(6),f=n(9),p=n(8),h=n(2),m=n(23),b=n.n(m),g={allVolumes:[{id:"V001",label:"Il sentiero dei nidi di ragno"},{id:"V002",label:"Ultimo viene il corvo"},{id:"V003",label:"Il visconte dimezzato"},{id:"V004",label:"L'entrata in guerra"},{id:"V005",label:"Il barone rampante"},{id:"V006",label:"I racconti"},{id:"V007",label:"La formica argentina"},{id:"V008",label:"Il cavaliere inesistente"},{id:"V009",label:"La giornata di uno scrutatore"},{id:"V010",label:"La speculazione edilizia"},{id:"V011",label:"Marcovaldo"},{id:"V012",label:"La nuvola di smog e La formica argentina"},{id:"V013",label:"Le cosmicomiche"},{id:"V014",label:"Ti con Zero"},{id:"V015",label:"La memoria del mondo"},{id:"V016",label:"Il castello dei destini incrociati"},{id:"V017",label:"Gli amori difficili"},{id:"V018",label:"Le citt\xe0 invisibili"},{id:"V019",label:"Il castello dei destini incrociati (riediz)"},{id:"V020",label:"Eremita a Parigi"},{id:"V021",label:"Se una notte d'inverno un viaggiatore"},{id:"V022",label:"Palomar"},{id:"V023",label:"Le cosmicomiche vecchie e nuove"}]},v=n(22),y=n(104),O=(n(122),function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{className:"main-menu",style:this.props.style},r.a.createElement(v.a,{icon:y.a}))}}]),e}(a.Component)),k=O;O.defaultProps={style:{gridColumn:"span 1"}};var E=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{className:"page-title",style:this.props.style},this.props.title)}}]),e}(a.Component),j=E;E.defaultProps={title:"This page needs a title",style:{gridColumn:"span 12"}};n(123);var x=n(40),N=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{style:this.props.style,className:"more-info"},r.a.createElement(v.a,{icon:x.b}))}}]),e}(a.Component),w=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{style:this.props.style,className:"more-info"},r.a.createElement(v.a,{icon:x.a}))}}]),e}(a.Component),S=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{style:this.props.style},"Loading ...")}}]),e}(a.Component),P=(n(124),n(24)),C=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(u.a)(this,Object(d.a)(e).call(this,t))).state={show:void 0,selection:!1===n.props.data.multiple?n.props.data.options.filter((function(t){return t.status}))[0].label:void 0},n.handleChange=n.handleChange.bind(Object(f.a)(n)),n.toggleDropDown=n.toggleDropDown.bind(Object(f.a)(n)),n}return Object(p.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){if(this.props.data.reset){var t=this.props.data.options.slice(0);t.forEach((function(t){return t.status=!1})),this.props.changeOptions?this.props.changeOptions(t):console.log("No function")}}},{key:"handleChange",value:function(t,e){var n=t.target.getAttribute("name"),a=this.props.data.options.slice(0);if(this.props.data.multiple||(a.forEach((function(t){return t.status=!1})),this.setState({selection:n})),"all"===n)a.forEach((function(t){return t.status=!t.status}));else{var r=a.filter((function(t){return t.label===n}));r.length>0&&(r[0].status=!r[0].status)}this.props.changeOptions?this.props.changeOptions(a):console.log("No function")}},{key:"toggleDropDown",value:function(t,e,n){"select"===n.source&&this.props.data.multiple?this.setState({show:!0}):this.setState({show:void 0})}},{key:"render",value:function(){var t=this;return r.a.createElement("div",{className:"options-container",style:this.props.style},r.a.createElement(P.a,{onToggle:this.toggleDropDown,show:this.state.show},r.a.createElement(P.a.Toggle,null,!this.props.data.multiple&&r.a.createElement("div",null,r.a.createElement("span",{className:"micro-title"},this.props.title),r.a.createElement("span",{className:"current-selection"},this.state.selection)),this.props.data.multiple&&this.props.title),r.a.createElement(P.a.Menu,{onToggle:this.toggleDropDown,show:this.state.show},this.props.data.options.map((function(e,n){return r.a.createElement(P.a.Item,{key:n,name:e.label,onClick:t.handleChange,className:{active:e.status}},e.label)})),this.props.data.multiple&&r.a.createElement(P.a.Item,{key:5,name:"all",onClick:this.handleChange,className:{active:!1}},"Inverti Selezione"))))}}]),e}(a.Component),_=C;C.defaultProps={style:{gridColumn:"span 4"},data:{options:[],multiple:!1},title:"Options"};n(125);var z=n(106),D=(n(280),n(281),function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){var t=this;return r.a.createElement("div",{className:"search-component",style:this.props.style},r.a.createElement("span",{style:{fontSize:"1rem",position:"relative",top:"-3px"}},"/"),r.a.createElement(z.Typeahead,{multiple:!0,onChange:function(e){e.length>0?t.props.changeOptions(e):t.props.changeOptions(t.props.data.options)},options:this.props.data.options,id:"main-search"}))}}]),e}(a.Component)),A=D;D.defaultProps={style:{gridColumn:"span 4"}};n(282);var L,V,T,R,F,I,U,B={},M={initialize:function(t,e,n){U=n,L=h.t(t).select("svg");B.top=10,B.right=10,B.bottom=L.node().getBoundingClientRect().height-1.2857142857*parseFloat(getComputedStyle(document.documentElement).fontSize)-B.top,B.bottom=B.top,B.left=10,F=L.node().getBoundingClientRect().width-B.left-B.right,I=L.node().getBoundingClientRect().height-B.top-B.bottom,M.x=h.s().range([0,F]).domain(h.f(e,(function(t){return t}))),M.brush=h.c().extent([[0,0],[F,I]]).handleSize(10).on("brush end",W),T=L.append("g").attr("class","brush").attr("transform","translate("+B.left+","+B.top+")"),(V=L.append("g").attr("class","context").attr("transform","translate("+B.left+","+B.top+")").style("pointer-events","none")).append("rect").classed("context-window",!0).attr("width",F).attr("height",I),R=V.append("g").selectAll(".info"),T.call(M.brush).call(M.brush.move,M.x.range())},update:function(t){(R=R.data(t,(function(t){return t}))).exit().remove(),R=R.enter().append("text").attr("class","info").attr("x",(function(t){return M.x(t)})).attr("y",I-1.9).attr("text-anchor",(function(t,e){return function(t,n,a){return e%2===0?n(t)>=a/4?"end":"start":n(t)<=a/4*3?"start":"end"}(t,M.x,F)})).text((function(t){return t.getFullYear()})).merge(R)},destroy:function(t){}},G=M;function W(){if((!h.e.sourceEvent||"zoom"!==h.e.sourceEvent.type)&&h.e.selection){var t=h.e.selection||M.x.range();t=t.map((function(t){return M.x.invert(t)})),"end"===h.e.type&&(console.log("filtered by time"),U(t)),t=t.map((function(t){return new Date(t)})),M.update(t)}}var Y=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){this._chart=G.initialize(this._rootNode,this.props.data,this.props.changeOptions)}},{key:"componentDidUpdate",value:function(){}},{key:"componentWillUnmount",value:function(){G.destroy(this._rootNode)}},{key:"_setRef",value:function(t){this._rootNode=t}},{key:"render",value:function(){return r.a.createElement("div",{style:this.props.style,ref:this._setRef.bind(this)},r.a.createElement("svg",{className:"range-filter"}))}}]),e}(a.Component),q=(n(283),{parser:function(t){t.forEach((function(t){t.year=new Date(t.year)}));var e=t.map((function(t){return t.year=new Date(t.year),t.id||(t.id=t["data.id"]),{id:t.id,label:t.Occorrenza,part_of:t["Parte di ID"],source:t.Fonte,sourceTitle:t["Titolo Fonte"],year:+t.year,category:t.Categoria,totalSubNodes:0,publicationType:t["Pubblicazione Fonte"].split(";"),pubVenueTitle:t["Pubblicazioni Titoli"],isGuessed:t["Luogo desunto"],themes:t.Tema.split(";")}})),n=q.handleHierarchies(e);return{graph:q.calculateNetwork(n),data:e}},handleHierarchies:function(t){var e=h.m().key((function(t){return t.part_of})).entries(t);return e.filter((function(t){return""===t.key}))[0].values.forEach((function(t){var n=e.find((function(e){return e.key===t.id}));n&&(t.subNodes=n.values,t.totalSubNodes=n.values.length,n.values.forEach((function(n){var a=e.find((function(t){return t.key===n.id}));a&&(n.subNodes=a.values,n.totalSubNodes=a.values.length,t.totalSubNodes+=n.totalSubNodes,a.values.forEach((function(n){var a=e.find((function(t){return t.key===n.id}));a&&(n.subNodes=a.values,n.totalSubNodes=a.values.length,t.totalSubNodes+=n.totalSubNodes,a.values.forEach((function(a){var r=e.find((function(t){return t.key===a.id}));r&&(a.subNodes=r.values,a.totalSubNodes=r.values.length,t.totalSubNodes+=n.totalSubNodes)})))})))})))})),e.filter((function(t){return""===t.key}))[0].values},calculateNetwork:function(t){var e=[];return h.m().key((function(t){return t.source})).entries(t).forEach((function(t){t.values.filter((function(t){return""!==t.part_of})).forEach((function(n,a){var r;r={source:n.id,target:n.part_of,volume:t.key,source_part_of:n.part_of,kind:"part_of"},e.push(r)}))})),{nodes:t,edges:e,root_nodes:t.filter((function(t){return t.subNodes}))}}}),H=q;function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}var X,Z,$,K,Q,tt,et,nt,at,rt,it,ot,st,ct,lt,ut,dt,ft,pt,ht,mt,bt,gt,vt,yt=["generico_non_terrestre","nominato_non_terrestre","nominato_terrestre","generico_terrestre","inventato","no_ambientazione"],Ot=["#3131ff","#bbbbff","#ffce00","#ff6c39","#00c19c","#cecece"],kt=[],Et=[],jt=[],xt=0,Nt=0,wt=50,St=30,Pt=50,Ct={},_t=Ct;Ct.initialize=function(t,e,n){X=n,st=h.t(t).style("touch-action","manipulation"),at=st.node().getBoundingClientRect().width-Pt-wt,rt=st.node().getBoundingClientRect().height-Nt-St,st.append("rect").attr("width",at+Pt+wt).attr("height",rt+Nt+St).classed("reset-rect",!0).on("click",(function(t){h.e.timeStamp-xt<500&&(console.log("reset"),Bt()),xt=h.e.timeStamp})),K=h.s().range([0,at]).domain(h.f(e.nodes,(function(t){return t.year}))),it=h.a(K).ticks(h.w.every(1)),Q=h.q().range([0,rt]).domain(yt).padding(.5),ot=h.b(Q).tickSize(at).tickFormat((function(t){return t.replace(/_/g," ")})),tt=h.r().exponent(.5).range([3,25]).domain([1,h.l(e.nodes,(function(t){return t.totalSubNodes}))]),et=h.p().domain(yt).range(Ot),ct=st.append("g").attr("transform","translate(".concat(Pt,",").concat(Nt,")")),ut=ct.append("g").attr("class","x-axis"),dt=ct.append("g").attr("class","y-axis"),lt=ct.append("g"),ut.attr("transform","translate(".concat(0,", ",rt,")")).call(it),dt.attr("transform","translate(0, 0)").call(ot).call((function(t){return t.selectAll(".tick text").style("text-transform","capitalize")})).call((function(t){return t.select(".domain").remove()})).call((function(t){return t.selectAll(".tick line").attr("stroke-opacity",.5).attr("stroke-dasharray","2,2")})).call((function(t){return t.selectAll(".tick text").attr("x",4).attr("dy",-Q.step()/10)})),dt.selectAll(".tick").on("click",(function(t){if(!1===h.t(this).classed("cat-selected")){h.u(".tick.cat-selected").size()>0&&(kt.filter((function(t){return""===t.part_of})).forEach((function(t){Dt(t,!1)})),h.u(".tick").classed("cat-selected",!1).select("rect").attr("fill","transparent"));var e=[];kt.forEach((function(n){n.totalSubNodes>0&&(n.subNodes.map((function(t){return t.category})).indexOf(t)>-1&&e.push(n),n.subNodes.forEach((function(a){a.totalSubNodes>0&&(a.subNodes.map((function(t){return t.category})).indexOf(t)>-1&&(e.push(n),e.push(a)),a.subNodes.forEach((function(r){r.totalSubNodes>0&&r.subNodes.map((function(t){return t.category})).indexOf(t)>-1&&(e.push(n),e.push(a),e.push(r))})))})))})),e.forEach((function(t){zt(t,!1)})),h.t(this).select("rect").attr("fill",(function(t){return et(t)}))}else{var n=[];kt.forEach((function(e){e.totalSubNodes>0&&(e.subNodes.map((function(t){return t.category})).indexOf(t)>-1&&n.push(e),e.subNodes.forEach((function(a){a.totalSubNodes>0&&(a.subNodes.map((function(t){return t.category})).indexOf(t)>-1&&(n.push(e),n.push(a)),a.subNodes.forEach((function(r){r.totalSubNodes>0&&r.subNodes.map((function(t){return t.category})).indexOf(t)>-1&&(n.push(e),n.push(a),n.push(r))})))})))})),n.forEach((function(t){Dt(t,!1)})),h.t(this).select("rect").attr("fill","transparent")}Ct.update(),!1===h.t(this).classed("cat-selected")?ht.filter((function(e){return e.category===t})).each((function(t){return Rt(t)})):ht.each((function(t){return Ft(t)})),h.t(this).classed("cat-selected",!h.t(this).classed("cat-selected"))})).append("rect").attr("width","14px").attr("height","14px").attr("x",-14).attr("y",-22).attr("rx",2).attr("fill","transparent").attr("stroke",(function(t){return et(t)})),pt=lt.append("g").classed("links",!0).selectAll(".link"),ft=lt.append("g").classed("hulls",!0).selectAll(".hull"),ht=lt.append("g").classed("nodes",!0).selectAll(".node"),mt=lt.append("g").classed("presumed",!0).selectAll(".presumed"),bt=lt.append("g").classed("labels",!0).selectAll(".label"),gt=ct.append("g").classed("informations",!0).selectAll(".information"),vt=h.i(kt).force("collision",h.g((function(t){var e=t.totalSubNodes>0?2.25:.25;return t.opened?tt(1)+e:tt(t.totalSubNodes+1)+e})).strength(.3).iterations(12)).force("link",h.h().strength(.45).distance(tt.range()[0]).id((function(t){return t.id}))).force("x",h.j((function(t){return K(t.year)}))).force("y",h.k((function(t){return Q(t.category)})).strength((function(t){return""===t.part_of?.1:0}))).on("tick",(function(){ht.attr("cx",(function(t,e){return t.x})).attr("cy",(function(t){return t.y})),mt.attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})),bt.attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})),pt.attr("x1",(function(t){return t.source.x})).attr("y1",(function(t){return t.source.y})).attr("x2",(function(t){return t.target.x})).attr("y2",(function(t){return t.target.y})),ft.attr("d",(function(t){var e=t.map((function(t){return[t.x,t.y]})),n=e.length<3?e:h.n(e);return qt(n,t)}))})).on("end",(function(){console.log("simulation ended")})).stop();var a=h.y().translateExtent([[0,0],[at+Pt+wt,rt+Nt+St]]).scaleExtent([1,10]).on("zoom",(function(){lt.attr("transform",h.e.transform),dt.attr("transform",h.e.transform);var t=h.e.transform.rescaleX(K);ut.call(it.scale(t)),nt||(nt=h.t(".label").style("font-size"),nt=parseFloat(nt));var e=nt/h.e.transform.k;h.t("g.labels").style("font-size",e+"px"),h.e.transform.k>3?h.u(".node.selected").each((function(t){bt.filter((function(e){return e.id===t.id})).classed("zoom-selected",!0)})):bt.classed("zoom-selected",!1);gt.attr("x",(function(e){return t(e.year)>=at/2?t(e.year)+4.8:t(e.year)-3.2}))}));st.call(a).on("dblclick.zoom",null),(Z=e).nodes=Z.nodes.map((function(t){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(n,!0).forEach((function(e){Object(s.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t,{x:K(t.year),y:Q(t.category)})}))},Ct.update=function(t){t?$=t:t=$,kt=Z.nodes,Et=Z.edges,kt.forEach((function(t){t.fx?t.correspondingYear=K.invert(t.fx):delete t.correspondingYear})),K.domain(t),ut.call(it),kt.forEach((function(t){t.correspondingYear&&(t.fx=K(t.correspondingYear))})),(ht=ht.data(kt,(function(t){return t.id}))).exit().remove(),ht=ht.enter().append("circle").attr("class",(function(t){return"node"})).classed("sub-node",(function(t){return""!==t.part_of})).attr("key",(function(t){return t.id})).on("mouseenter",(function(t){bt.filter((function(e){return e.id===t.id})).style("display","block"),ht.style("opacity",.25).filter((function(e){return e.source===t.source})).style("opacity",1)})).on("mouseleave",(function(t){bt.filter((function(e){return e.id===t.id})).style("display","none"),ht.style("opacity","")})).on("click",(function(t){h.e.timeStamp-xt<500&&At(t,"restart the force"),xt=h.e.timeStamp,Vt(t),Ut(t),Lt([t])})).merge(ht).style("cursor",(function(t){return t.subNodes&&t.subNodes.length?"pointer":"auto"})).attr("fill",(function(t){return!0===t.opened?"white":et(t.category)})).attr("stroke",(function(t){if(t.totalSubNodes>0)return h.d(et(t.category)).darker(1)})).attr("r",(function(t){return t.opened?tt(1):tt(t.totalSubNodes+1)})),(mt=mt.data(kt.filter((function(t){return t.isGuessed})),(function(t){return t.id}))).exit().remove(),mt=mt.enter().append("circle").classed("presumed",!0).attr("r",1.5).attr("fill",(function(t){return h.d(et(t.category)).darker(1)})).merge(mt),(pt=pt.data(Et,(function(t){return t.source.id+"-"+t.target.id}))).exit().remove(),pt=pt.enter().append("line").classed("link",!0).classed("part-of",(function(t){return"part_of"===t.kind})).attr("stroke-width",.5).attr("stroke","#ccc").merge(pt),(bt=bt.data(kt,(function(t){return t.id}))).exit().remove(),bt=bt.enter().append("text").classed("label",!0).style("display","none").attr("text-anchor","middle").style("pointer-events","none").text((function(t){return t.label})).merge(bt),(ft=ft.data(jt,(function(t){return t[0].id}))).exit().remove(),ft=ft.enter().append("path").classed("hull",!0).attr("fill",(function(t){return et(t[0].category)})).style("opacity",.25).merge(ft),vt.nodes(kt),vt.force("link")&&vt.force("link").links(Et),vt.alpha(1).restart()},Ct.filter=function(t,e){It(t,"do reset"),e&&e.length!==X.length&&e.forEach((function(t){Vt({id:t})}))},Ct.openOnSearch=function(t){var e=[];t.forEach((function(t){!function t(n){var a=X.filter((function(t){return t.id===n}))[0];""!==a.part_of&&(e.push(a.part_of),t(a.part_of))}(t)})),e.length>0&&(e.reverse().forEach((function(t,e){var n=X.filter((function(e){return e.id===t}))[0].id,a=kt.filter((function(t){return t.id===n}))[0];zt(a,"do not restart the force")})),Ct.update())},Ct.openAll=function(){!function t(e){e.forEach((function(e){e.totalSubNodes>0&&(zt(e,"do not restart simulation"),t(e.subNodes))}))}(kt)},Ct.closeAll=function(){kt.filter((function(t){return""===t.part_of})).forEach((function(t){Dt(t,"do not restart simulation")}))},Ct.destroy=function(){};var zt=function(t,e){if(!t.opened){t.opened=!0,""===t.part_of?(t.fx=t.x,t.fy=t.y):(t.x=kt.filter((function(e){return e.id===t.part_of}))[0].x,t.fy=kt.filter((function(e){return e.id===t.part_of}))[0].y+2*tt.range()[0]*3),t.subNodes.forEach((function(e){e.x=t.x,e.y=t.y}));var n=[t].concat(t.subNodes);jt.push(n),jt.forEach((function(t){t.indexOf(n[0])>0&&n.forEach((function(e,n){0!==n&&t.push(e)}))}));var a=kt.concat(t.subNodes);Z=H.calculateNetwork(a),kt=Z.nodes,Et=Z.edges,"restart the force"===e&&Ct.update()}},Dt=function(t,e){if(t.opened&&0!==t.totalSubNodes){t.opened=!1,delete t.fx,delete t.fy;var n=[],a=[t.id];!function t(e){e.subNodes.forEach((function(e){e.opened&&(e.opened=!1,a.push(e.id),t(e))})),n.push(e.subNodes)}(t),n.forEach((function(t){var e=t.map((function(t){return t.id})),n=kt.filter((function(t){return!e.includes(t.id)}));(jt=jt.filter((function(t){return!a.includes(t[0].id)}))).forEach((function(t,n){jt[n]=t.filter((function(t){return!e.includes(t.id)}))})),Z=H.calculateNetwork(n),kt=Z.nodes,Et=Z.edges})),"restart the force"===e&&Ct.update()}},At=function(t,e){t.opened?(Tt(t),Dt(t,e)):t.subNodes&&t.subNodes.length?(Vt(t),zt(t,e)):console.log("No nodes to expand")},Lt=function(t){(gt=gt.data(t,(function(t){return t.id}))).exit().remove(),gt=gt.enter().append("text").classed("information",!0).attr("text-anchor",(function(t){return K(t.year)>=at/2?"end":"start"})).attr("x",(function(t){return K(t.year)>=at/2?K(t.year)+4.8:K(t.year)-3.2})).attr("y",rt-10).text((function(t){return K(t.year)>=at/2?t.sourceTitle+" \u2193":"\u2193 "+t.sourceTitle})).merge(gt)},Vt=function(t){bt.filter((function(e){return e.id===t.id})).classed("selected",!0)},Tt=function(t){bt.filter((function(e){return e.id===t.id})).classed("selected",!1)},Rt=function(t){st.classed("there-is-selection",!0),ht.filter((function(e){return e.id===t.id})).classed("selected",!0)},Ft=function(t){ht.filter((function(e){return e.id===t.id})).classed("selected",!1),0===st.selectAll(".selected").size()&&st.classed("there-is-selection",!1)},It=function(t,e){"do reset"===e&&Bt(),st.classed("there-is-filter",!0),ht.classed("filtered",!1).filter((function(e){return t.indexOf(e.id)<0})).classed("filtered",!0)},Ut=function(t){st.classed("there-is-selection",!0),ht.filter((function(e){return e.source===t.source})).classed("selected",!0)},Bt=function(){st.selectAll("*").classed("selected",!1).classed("zoom-selected",!1),ht.classed("filtered",!1),st.selectAll(".tick").classed("cat-selected",!1).selectAll("rect").attr("fill","transparent"),st.classed("there-is-selection",!1),Lt([])},Mt=.25,Gt=function(t,e){return[t*e[0],t*e[1]]},Wt=function(t,e){return[t[0]+e[0],t[1]+e[1]]},Yt=function(t,e){var n=[t[1]-e[1],e[0]-t[0]],a=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return[n[0]/a,n[1]/a]},qt=function(t,e){if(Mt=h.l(e,(function(t){return t.opened?tt(1)+.25:tt(t.totalSubNodes+1)+.25})),!t||t.length<1)return"";if(1===t.length)return Ht(t,e);if(2===t.length)return Jt(t,e);for(var n=new Array(t.length),a=0;a<n.length;++a){var r=0===a?t[t.length-1]:t[a-1],i=t[a],o=Gt(Mt,Yt(r,i));n[a]=[Wt(r,o),Wt(i,o)]}var s="A "+[Mt,Mt,"0,0,0,"].join(",");return(n=n.map((function(t,e){var a="";return 0===e&&(a="M "+n[n.length-1][1]+" "),a+=s+t[0]+" L "+t[1]}))).join(" ")},Ht=function(t,e){var n=[t[0][0],t[0][1]-Mt],a=[t[0][0],t[0][1]+Mt];return"M "+n+" A "+[Mt,Mt,"0,0,0",a].join(",")+" A "+[Mt,Mt,"0,0,0",n].join(",")},Jt=function(t,e){var n=Gt(Mt,Yt(t[0],t[1])),a=Gt(-1,n),r=Wt(t[0],n),i=Wt(t[1],n),o=Wt(t[1],a),s=Wt(t[0],a);return"M "+r+" L "+i+" A "+[Mt,Mt,"0,0,0",o].join(",")+" L "+s+" A "+[Mt,Mt,"0,0,0",r].join(",")},Xt=function(t){function e(){return Object(c.a)(this,e),Object(u.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(p.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){_t.initialize(this._rootNode,this.props.data,this.props.originalData),_t.update(this.props.timeFilter),_t.filter(this.props.filter)}},{key:"componentDidUpdate",value:function(t,e){if(this.props.filter!==t.filter){this.props.searched.length!==this.props.originalData.length&&_t.openOnSearch(this.props.searched);var n=this.props.searched;_t.filter(this.props.filter,n)}this.props.timeFilter!==t.timeFilter&&_t.update(this.props.timeFilter),this.props.gruppi!==t.gruppi&&(console.log(this.props.gruppi),"aperti"===this.props.gruppi?_t.openAll():"chiusi"===this.props.gruppi&&_t.closeAll(),_t.update())}},{key:"componentWillUnmount",value:function(){console.log("componentWillUnmount"),_t.destroy(this._rootNode)}},{key:"_setRef",value:function(t){this._rootNode=t}},{key:"render",value:function(){return r.a.createElement("svg",{id:this.props.id,style:{width:"100%",height:"100%"},ref:this._setRef.bind(this)})}}]),e}(a.Component);function Zt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function $t(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Zt(n,!0).forEach((function(e){Object(s.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Zt(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Kt=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(u.a)(this,Object(d.a)(e).call(this,t))).changeCercaPer=n.changeCercaPer.bind(Object(f.a)(n)),n.changeRicerca=n.changeRicerca.bind(Object(f.a)(n)),n.changeGruppi=n.changeGruppi.bind(Object(f.a)(n)),n.changePubblicazioni=n.changePubblicazioni.bind(Object(f.a)(n)),n.changeAmbienti=n.changeAmbienti.bind(Object(f.a)(n)),n.changeTimeSpan=n.changeTimeSpan.bind(Object(f.a)(n)),n.downloadData=n.downloadData.bind(Object(f.a)(n)),n.state={data:"data still not loaded",filter:[],isLoading:!0,cerca_per:{multiple:!1,options:[{label:"luogo",status:!0},{label:"titolo pubblicazione",status:!1},{label:"titolo",status:!1}]},gruppi:{multiple:!1,options:[{label:"aperti",status:!1},{label:"chiusi",status:!0}]}},n}return Object(p.a)(e,t),Object(l.a)(e,[{key:"loadData",value:function(){var t=this;h.x("./places-matrix-data.tsv").then((function(t){return H.parser(t)})).then((function(e){var n=e.data.map((function(t){return t.themes})).flat();n=(n=n.filter((function(t,e){return n.indexOf(t)===e}))).filter((function(t){return""!==t&&" "!==t}));var a=e.data.map((function(t){return t.publicationType})).flat();a=(a=(a=a.filter((function(t,e){return a.indexOf(t)===e}))).filter((function(t){return""!==t&&" "!==t}))).map((function(t){return{label:t,status:!0}}));var r=e.data.map((function(t){return t.themes})).flat();r=(r=(r=r.filter((function(t,e){return r.indexOf(t)===e}))).filter((function(t){return""!==t&&" "!==t}))).map((function(t){return{label:t,status:!0}}));var i=e.data.map((function(t){return t.pubVenueTitle.split(";")}));i=i.flat(),i=h.m().key((function(t){return t})).entries(i).map((function(t){return t.key}));var o=[];i.forEach((function(t){var n=e.data.filter((function(e){return e.pubVenueTitle.includes(t)})),a={label:t,id:[n.map((function(t){return t.id}))],status:!0};o.push(a)}));var s=h.m().key((function(t){return t.sourceTitle})).entries(e.data).map((function(t){return{label:t.key,id:t.values.map((function(t){return t.id})),status:!0}})),c={luogo:h.m().key((function(t){return t.label})).entries(e.data).map((function(t){return{label:t.key,id:t.values.map((function(t){return t.id})),status:!0}})).sort((function(t,e){return t.label.localeCompare(e.label)})),"titolo pubblicazione":o,titolo:s},l=h.f(e.data,(function(t){return t.year}));t.setState({data:e.graph,originalData:e.data,filter:e.data.map((function(t){return t.id})),noFilter:e.data.map((function(t){return t.id})),isLoading:!1,data_research:c,ricerca:{options:c.luogo},toPreserveRicerca:e.data.map((function(t){return t.id})),pubblicazioni:{multiple:!0,options:a},toPreservePubblicazioni:e.data.map((function(t){return t.id})),volumi:{multiple:!0,options:g.allVolumes.map((function(t){return $t({},t,{status:!0})}))},toPreserveVolumi:e.data.map((function(t){return t.id})),ambienti:{multiple:!0,options:r},toPreserveAmbienti:e.data.map((function(t){return t.id})),timeExtent:l,timeFilter:l,update:!1})}))}},{key:"changeCercaPer",value:function(t){var e=t.filter((function(t){return t.status}));if(e.length<1)console.error("err");else{e=e[0].label,console.log(e);var n=this.state.data_research[e];this.setState((function(e){return{cerca_per:$t({},e.cerca_per,{options:t}),ricerca:$t({},e.ricerca,{options:n})}}))}}},{key:"changeRicerca",value:function(t){var e=t.map((function(t){return t.id}));e=b.a.flattenDeep(e),this.setState((function(t){return{ricerca:$t({},t.ricerca),toPreserveRicerca:e,filter:b.a.intersection(t.noFilter,e,t.toPreservePubblicazioni,t.toPreserveVolumi,t.toPreserveAmbienti)}}))}},{key:"changeGruppi",value:function(t){this.setState({statoGruppi:t.filter((function(t){return t.status}))[0].label})}},{key:"changePubblicazioni",value:function(t){var e=t.filter((function(t){return t.status})).map((function(t){return t.label})),n=this.state.originalData.filter((function(t){return t.publicationType.filter((function(t){return e.includes(t)})).length>0})).map((function(t){return t.id}));console.log(n.length),this.setState((function(e){return{pubblicazioni:$t({},e.pubblicazioni,{options:t}),toPreservePubblicazioni:n,filter:b.a.intersection(e.noFilter,e.toPreserveRicerca,n,e.toPreserveVolumi,e.toPreserveAmbienti)}}))}},{key:"changeAmbienti",value:function(t){var e=t.filter((function(t){return t.status})).map((function(t){return t.label})),n=this.state.originalData.filter((function(t){return t.themes.filter((function(t){return e.includes(t)})).length>0})).map((function(t){return t.id}));this.setState((function(e){return{ambienti:$t({},e.ambienti,{options:t}),toPreserveAmbienti:n,filter:b.a.intersection(e.noFilter,e.toPreserveRicerca,e.toPreservePubblicazioni,e.toPreserveVolumi,n)}}))}},{key:"changeTimeSpan",value:function(t){t=t.map((function(t){return+new Date(t)})),this.setState({timeFilter:t})}},{key:"downloadData",value:function(t){var e=this;if("d"===t.key){console.log(this.state);var n=h.u(".selected, .filtered").data();n=h.m().key((function(t){return t.source})).entries(n).map((function(t){return{composition_id:t.key,composition_title:t.values[0].sourceTitle}}));var a="Compositions titles surviving filters\n\n";a+="Ambienti attivati: ".concat(this.state.ambienti.options.filter((function(t){return t.status})).map((function(t){return t.label})).join(", "),"\n"),a+="Pubblicazioni attivate: ".concat(this.state.pubblicazioni.options.filter((function(t){return t.status})).map((function(t){return t.label})).join(", "),"\n"),a+="Ricerca effettuata: ".concat(this.state.toPreserveRicerca.map((function(t){return e.state.originalData.find((function(e){return e.id===t})).label})).join(", "),"\n"),a+="\n\n",a+="composition_id\tcomposition_title\n",n.forEach((function(t){a+=t.composition_id+"\t"+t.composition_title+"\n"}));var r=new Date;r=h.v("%Y_%m_%d %X")(r),function(t,e,n){console.log("download");var a=new Blob([t],{type:n});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,e);else{var r=document.createElement("a"),i=URL.createObjectURL(a);r.href=i,r.download=e,document.body.appendChild(r),r.click(),setTimeout((function(){document.body.removeChild(r),window.URL.revokeObjectURL(i)}),0)}}(a,"selection [".concat(r,"].txt"),"text/plain")}}},{key:"componentDidMount",value:function(){this.loadData(),document.addEventListener("keypress",this.downloadData)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keypress",this.downloadData)}},{key:"render",value:function(){return r.a.createElement("div",{className:"trasformare main"},r.a.createElement("div",{className:"top-nav navigations"},r.a.createElement(k,{className:"main-menu",style:{gridColumn:"span 1"}}),r.a.createElement(j,{title:this.props.title,style:{gridColumn:"span 10"}}),this.state.isLoading&&r.a.createElement(S,{style:{gridColumn:"span 3"}}),!this.state.isLoading&&r.a.createElement(_,{title:"Cerca per",data:this.state.cerca_per,style:{gridColumn:"span 3"},changeOptions:this.changeCercaPer})," ",this.state.isLoading&&r.a.createElement(S,{style:{gridColumn:"span 8"}})," ",!this.state.isLoading&&r.a.createElement(A,{style:{gridColumn:"span 8"},data:this.state.ricerca,changeOptions:this.changeRicerca})," ",r.a.createElement(N,{style:{gridColumn:"span 1"}})," ",r.a.createElement(w,{style:{gridColumn:"span 1"}})," "),r.a.createElement("div",{className:"the-body-viz"},this.state.isLoading&&r.a.createElement(S,null),!this.state.isLoading&&r.a.createElement(Xt,{data:this.state.data,originalData:this.state.originalData,filter:this.state.filter,searched:this.state.toPreserveRicerca,timeFilter:this.state.timeFilter,gruppi:this.state.gruppi.options.filter((function(t){return t.status}))[0].label})),r.a.createElement("div",{className:"bottom-nav navigations"},this.state.isLoading&&r.a.createElement(S,{style:{gridColumn:"span 5"}})," ",!this.state.isLoading&&r.a.createElement(_,{title:"Gruppi",data:this.state.gruppi,style:{gridColumn:"span 5",textAlign:"center"},changeOptions:this.changeGruppi})," ",this.state.isLoading&&r.a.createElement(S,{style:{gridColumn:"span 5"}})," ",!this.state.isLoading&&r.a.createElement(_,{title:"Pubblicazioni",data:this.state.pubblicazioni,style:{gridColumn:"span 5",textAlign:"center"},changeOptions:this.changePubblicazioni})," ",this.state.isLoading&&r.a.createElement(S,{style:{gridColumn:"span 5"}})," ",!this.state.isLoading&&r.a.createElement(_,{title:"Ambienti",data:this.state.ambienti,style:{gridColumn:"span 5",textAlign:"center"},changeOptions:this.changeAmbienti})," ",this.state.isLoading&&r.a.createElement(S,{style:{gridColumn:"span 9"}})," ",!this.state.isLoading&&r.a.createElement(Y,{style:{gridColumn:"span 9"},data:this.state.timeExtent,changeOptions:this.changeTimeSpan})," ")," ")}}]),e}(a.Component);var Qt=function(){return r.a.createElement("div",{className:"main"},r.a.createElement(Kt,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(Qt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[108,1,2]]]);
//# sourceMappingURL=main.d39a9ab7.chunk.js.map