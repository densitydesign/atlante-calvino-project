{"version":3,"sources":["general/HeaderViz/HeaderViz.js","general/BodyViz/BodyViz.js","general/MainMenu/MainMenu.js","general/Loading/Loading.js","general/SetOption/SetOption.js","visualizations/TimeFilter/time-filter.d3.js","visualizations/TimeFilter/TimeFilter.js","general/MultipleSelection/MultipleSelection.js","general/SimpleDropDown/SimpleDropDown.js","general/SimpleSearch/SimpleSearch.js","general/FilterSearch/FilterSearch.js","visualizations/PlacesMatrix/matrix.d3.js","general/MoreInfo/MoreInfo.js","PlacesMatrixView/parse-matrix-data.js","visualizations/PlacesMatrix/PlacesMatrix.js","PlacesMatrixView/PlacesMatrixView.js","App.js","serviceWorker.js","index.js"],"names":["HeaderViz","className","style","this","props","children","Component","BodyViz","MainMenu","icon","faBars","Loading","SetOption","handleChange","bind","e","newValue","target","checked","selected","title","type","onChange","defaultProps","Viz","el","data","changeSpan","margin","top","right","bottom","getBoundingClientRect","height","left","svg","d3","width","append","attr","classed","x","range","domain","d","xAxis","brush","extent","handleSize","m","on","brushed","context","info","selectAll","line","dotted","call","move","span","exit","remove","enter","i","scale","getAnchor","text","getFullYear","merge","_groups","getBBox","sourceEvent","selection","map","invert","Date","update","TimeFilter","_chart","initialize","_rootNode","destroy","componentNode","id","ref","_setRef","MultipleSelection","checkboxes","document","getElementById","getElementsByTagName","Array","from","name","filter","status","changeOptions","options","key","defaultChecked","SimpleDropDown","changeOption","value","SimpleSearch","debounceTyping","_","debounce","searching","handleTyping","selectResult","event","length","minLength","getAttribute","liStyle","backgroundColor","placeholder","position","previewSearch","slice","onClick","data-attr","values","FilterSearch","allTitles","originalData","pubVenueTitle","split","flattenDeep","entries","nodesByPublicationTitle","forEach","publishedHere","includes","obj","push","state","option","publicationsTitles","handleSearch","resetSearch","searchResults","searchRecord","newOption","label","setState","nestedData","toLowerCase","dimension","display","search","faTimesCircle","theOriginalData","graph","storedFilters","y","r","color","xAxisCall","yAxisCall","g","gigi","yAxis","hull","link","node","presumed","information","simulation","MoreInfo","faQuestionCircle","ParseMatrixData","rawData","year","hierarchies","handleHierarchies","calculateNetwork","nodes","part_of","part_of_d","find","subNodes","totalSubNodes","part_of_e","f","part_of_f","part_of_g","h","edges","source","n","V","categories","categoriesColors","links","hullsData","rootNodes","last","openAllState","resetByClick","openSubnodes","noRestart","fx","fy","subNode","opened","thisHullNodes","concat","thisHull","indexOf","augmentedNodes","console","log","closeSubnodes","subNodes2Remove","hulls2Remove","collectSubNodes","parentNode","childNode","toRemove","filtered","highlightNodes","arr","doReset","reset","displayTitle","sourceTitle","filters","zoom","translateExtent","scaleExtent","transform","new_x","rescaleX","parseInt","k","cssRemSize","ticks","every","padding","tickSize","tickFormat","replace","exponent","timeStamp","select","step","size","toOpen","n0","category","n1","n2","nn","toClose","force","strength","distance","thisCollisionPadding","collisionPadding","iterations","positionedYear","points","convexHull","roundedHull","alpha","stop","parents2open","s","search4Parent","nodeId","thisNode","od","reverse","parentId","isTimeFiltered","timeFilter","date","toggleSubnodes","darker","isGuessed","kind","restart","undefined","openAll","closeAll","surviveFilters","pubTypes","selectedPublications","publicationType","pubThemes","selectedThemes","themes","union","mergeSurvived","intersection","runAll","nodesList","hullPadding","vecScale","v","vecSum","pv1","pv2","unitNormal","p0","p1","nLength","Math","sqrt","polyPoints","roundedHull1","roundedHull2","segments","segmentIndex","offset","arcData","join","segment","index","pathFragment","p2","offsetVector","invOffsetVector","p3","addEventListener","PlacesMatrix","PlacesMatrixView","loadData","isLoading","changePublications","changeThemes","then","parser","dataTimeFilter","publicationsTypes","searchOptions","newSpan","prevState","newPublications","newThemes","gridColumn","App","Boolean","window","location","hostname","match","ReactDOM","render","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.f2ff4180.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport './HeaderViz.css';\n\nclass HeaderViz extends Component {\n  render() {\n    return (\n      <div className=\"the-header\" style={this.props.style}>{this.props.children}</div>\n    );\n  }\n}\n\nexport default HeaderViz;\n","import React, { Component } from 'react';\nimport './BodyViz.css';\n\nclass BodyViz extends Component {\n  render() {\n    return <div className={this.props.className}>{this.props.children}</div>;\n  }\n}\n\nexport default BodyViz;\n","import React, { Component } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faBars } from '@fortawesome/free-solid-svg-icons';\nimport './MainMenu.css';\n\nclass MainMenu extends Component {\n  render() {\n    return <div className=\"main-menu\" style={this.props.style}><FontAwesomeIcon icon={faBars} /></div>;\n  }\n}\n\nexport default MainMenu;\n","import React, { Component } from 'react';\n\nclass Loading extends Component {\n  render() {\n    return <div style={this.props.style}>Loading ...</div>;\n  }\n}\n\nexport default Loading;\n","import React, { Component } from 'react';\nimport './SetOption.css'\n\nclass SetOption extends Component {\n\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n  }\n\n  handleChange(e) {\n    const newValue = e.target.checked;\n    this.props.selected(newValue);\n  }\n\n  render() {\n    return (\n      <div className=\"set-option\" style={this.props.style}>\n        <h5>{this.props.title}</h5>\n        <label className=\"switch\">\n          <input type=\"checkbox\" onChange={this.handleChange}/>\n          <span className=\"slider round\"></span>\n        </label>\n      </div>\n    );\n  }\n}\n\nexport default SetOption;\n\nSetOption.defaultProps = { title: 'Option' };\n","import * as d3 from 'd3';\n\nconst Viz = {};\n\nViz.initialize = (el, data, changeSpan) => {\n  // console.log('initialized')\n\n  // data must be an array with 2+ elements. Element is a Date object\n\n  // Important to declare at beginning\n  Viz.changeSpan = changeSpan;\n\n  const m = 15;\n  Viz.margin = { top: 0, right: m, bottom: el.getBoundingClientRect().height - 20, left: m }\n  Viz.svg = d3.select(el);\n  Viz.width = el.getBoundingClientRect().width - Viz.margin.left - Viz.margin.right;\n  Viz.height = el.getBoundingClientRect().height - Viz.margin.top - Viz.margin.bottom;\n\n  Viz.svg.append(\"defs\").append(\"clipPath\")\n      .attr(\"id\", \"timeclip\")\n    .append('rect')\n      .classed('clip', true)\n      .attr('x', 0)\n      .attr('y', Viz.margin.top)\n      .attr('width', Viz.width + Viz.margin.left + Viz.margin.right)\n      .attr('height', Viz.height)\n      // the following to compensate the translation on VIz.context (even if not totally clear)\n      .attr(\"transform\", \"translate(\" + -Viz.margin.left + \",\" + -Viz.margin.top + \")\")\n\n  Viz.x = d3.scaleTime()\n    .range([0, Viz.width])\n    .domain(d3.extent(data, d => d));\n\n  Viz.xAxis = d3.axisBottom(Viz.x)\n\n  Viz.brush = d3.brushX()\n    .extent([[0, 0], [Viz.width, Viz.height]])\n    .handleSize(m*2)\n    .on(\"brush end\", brushed)\n    // .on(\"end\", brushed);\n\n  Viz.context = Viz.svg.append(\"g\")\n    .attr(\"class\", \"context\")\n    .attr(\"transform\", \"translate(\" + Viz.margin.left + \",\" + Viz.margin.top + \")\")\n\n  // important is before brushed is called or assigned\n  Viz.info = Viz.context.append('g').selectAll('.info')\n  Viz.line = Viz.context.append('g').selectAll('.info-line')\n  Viz.dotted = Viz.context.append('g').selectAll('.dotted')\n\n  Viz.context.append(\"line\")\n    .attr('x1', 0)\n    .attr('y1', Viz.height/2)\n    .attr('x2', Viz.width)\n    .attr('y2', Viz.height/2)\n    .attr('stroke', 'var(--dark-green)')\n\n  Viz.context.append(\"g\")\n    .attr(\"class\", \"brush\")\n    .call(Viz.brush)\n    .call(Viz.brush.move, Viz.x.range())\n}\n\nViz.update = (span) => {\n  // console.log('updated')\n\n  Viz.info = Viz.info.data(span, d=>d);\n  Viz.info.exit().remove()\n  Viz.info = Viz.info.enter().append('text')\n    .attr('class','info')\n    .attr('x', d => { return Viz.x(d) })\n    .attr('y', Viz.height + Viz.margin.top + 12) // this value depends on the font-size\n    .attr('text-anchor', (d,i) => {\n      function getAnchor(d,scale, width) {\n        let anchor;\n        if (i%2===0) {\n          if (scale(d) >= width/4) {\n            anchor = 'end';\n          } else {\n            anchor = 'start';\n          }\n        } else {\n          if (scale(d) <= width/4*3) {\n            anchor = 'start';\n          } else {\n            anchor = 'end';\n          }\n        }\n        return anchor;\n      }\n      return getAnchor(d, Viz.x, Viz.width);\n    })\n    .text(d=>{\n      return d.getFullYear()\n    })\n    .merge(Viz.info)\n\n  Viz.line = Viz.line.data(span, d=>d);\n  Viz.line.exit().remove()\n  Viz.line = Viz.line.enter().append('line')\n    .attr('class','info-line')\n    .attr('stroke', 'var(--calvino-red)')\n    .attr('stroke-width', '2px')\n    .attr('x1', d => { return Viz.x(d) })\n    .attr('y1', 0)\n    .attr('x2', d => { return Viz.x(d) })\n    .attr('y2', Viz.height)\n    .merge(Viz.line)\n\n  Viz.dotted = Viz.dotted.data([span], (d,i)=>{return d})\n  Viz.dotted.exit().remove()\n  Viz.dotted = Viz.dotted.enter().append('line')\n    .attr('class','dotted')\n    .attr('x1', Viz.info._groups[0][0].getBBox().x + Viz.info._groups[0][0].getBBox().width + 5 )\n    .attr('x2', Viz.info._groups[0][1].getBBox().x - 5)\n    .attr('y1', Viz.height + Viz.margin.top + 6)\n    .attr('y2', Viz.height + Viz.margin.top + 6)\n    .attr('stroke-width', '1.5px')\n    .attr('stroke', 'var(--dark-green)')\n    .attr('stroke-linecap', 'round')\n    .attr('stroke-dasharray', '0,15')\n    .merge(Viz.dotted)\n}\n\nViz.destroy = (el) => {}\n\nexport default Viz\n\nfunction brushed() {\n  if (d3.event.sourceEvent && d3.event.sourceEvent.type === \"zoom\") return; // ignore brush-by-zoom\n  if (d3.event.selection) {\n    var span = d3.event.selection || Viz.x.range();\n    span = span.map(d=>{return Viz.x.invert(d)})\n    if (d3.event.type === \"end\" || true) {\n      Viz.changeSpan(span);\n    }\n    span = span.map(d=> new Date(d));\n    Viz.update(span);\n  }\n}\n","import React, { Component } from 'react';\nimport './TimeFilter.css';\nimport Viz from './time-filter.d3'\n\nclass TimeFilter extends Component {\n  constructor(props) {\n    super(props);\n    this.changeSpan = this.changeSpan.bind(this);\n  }\n\n  changeSpan(span) {\n    this.props.changeSpan(span);\n  }\n\n  componentDidMount() {\n    this._chart = Viz.initialize(this._rootNode, this.props.data, this.changeSpan);\n  }\n\n  componentDidUpdate() {\n    // Viz.update(this.props.data);\n  }\n\n  componentWillUnmount() {\n    Viz.destroy(this._rootNode);\n  }\n\n  _setRef(componentNode) {\n      this._rootNode = componentNode;\n  }\n\n  render() {\n    return (\n      <div style={this.props.style}>\n        <h5>{this.props.title}</h5>\n        <svg id=\"time-filter\" ref={this._setRef.bind(this)}></svg>\n      </div>\n    );\n  }\n}\n\nexport default TimeFilter;\n\nTimeFilter.defaultProps = { title: 'Time Filter' };\n","import React, { Component } from 'react';\nimport './MultipleSelection.css';\n\nclass MultipleSelection extends Component {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n  }\n\n  handleChange() {\n    // get all checkboxes\n    let checkboxes = document.getElementById(this.props.id).getElementsByTagName('input');\n    // convert from HTMLcollection into a JS array\n    checkboxes = Array.from(checkboxes);\n    // remap and filter\n    checkboxes = checkboxes.map(d=>{return {'name':d.name, 'status':d.checked} });\n    checkboxes = checkboxes.filter(d=>d.status)\n    checkboxes = checkboxes.map(d=>d.name)\n    this.props.changeOptions(checkboxes);\n  }\n\n  render() {\n    return (\n      <div style={this.props.style}>\n        <h5>{this.props.title}</h5>\n\n        <ul id={this.props.id} className=\"multiple-selection-menu\">\n          {\n            this.props.options.map( (d,i) => {\n              return <li key={i}><input type=\"checkbox\" name={d} onChange={this.handleChange} defaultChecked={true} />{d}</li>\n            })\n          }\n        </ul>\n      </div>\n    );\n  }\n}\n\nexport default MultipleSelection;\n\nMultipleSelection.defaultProps = { title: 'Select an option' };\n","import React, { Component } from 'react';\n\nclass SimpleDropDown extends Component {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n  }\n\n  handleChange(e) {\n    this.props.changeOption(e.target.value);\n  }\n\n  render() {\n    return (\n      <select style={this.props.style} onChange={this.handleChange}>\n        { this.props.options.map( (d,i) => {\n          return <option key={i}>{d}</option>\n        })}\n      </select>\n    );\n  }\n}\n\nexport default SimpleDropDown;\n","import React, { Component } from 'react';\nimport _ from 'lodash'\n\nclass SimpleSearch extends Component {\n  constructor(props) {\n    super(props);\n    this.handleTyping = this.handleTyping.bind(this);\n    this.selectResult = this.selectResult.bind(this);\n  }\n\n  handleTyping(event){\n    if (event.target.value.length >= this.props.minLength) {\n      this.debounceTyping(event.target.value)\n    }\n  }\n\n  debounceTyping = _.debounce( (value) => {\n    this.props.searching(value);\n  }, 250);\n\n  selectResult(event){\n    this.props.selectResult(event.target.getAttribute('data-attr'))\n  }\n\n  render() {\n    const ulStyle = {\n      position: 'absolute'\n    }\n    const liStyle = {\n      backgroundColor: 'peachpuff'\n    }\n    return (\n      <div style={this.props.style}>\n        <input type=\"text\" name=\"fname\" placeholder=\"Inserisci un nome\" onChange={this.handleTyping} />\n        <ul style={ulStyle}>\n          {this.props.previewSearch.slice(0,8).map( (d,i)=>{\n            return <li style={liStyle} key={i} onClick={this.selectResult} data-attr={d.values} >{d.key}</li>\n          } )}\n        </ul>\n\n      </div>\n    );\n  }\n}\n\nexport default SimpleSearch;\n","import React, { Component } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimesCircle } from '@fortawesome/free-solid-svg-icons';\n\nimport * as d3 from 'd3';\nimport _ from 'lodash';\nimport SimpleDropDown from '../SimpleDropDown'\nimport SimpleSearch from '../SimpleSearch'\n\nclass FilterSearch extends Component {\n  constructor(props) {\n    super(props);\n\n    let allTitles = this.props.originalData.map(d=>d.pubVenueTitle.split(';'));\n    allTitles = _.flattenDeep(allTitles);\n    allTitles = d3.nest()\n      .key(d=>d)\n      .entries(allTitles)\n      .map(d=>d.key);\n\n    let nodesByPublicationTitle = []\n    allTitles.forEach( d => {\n      let publishedHere = this.props.originalData.filter( e => { return e.pubVenueTitle.includes(d) })\n      let obj = {\n        key: d,\n        values: publishedHere.map(d=>d.id)\n      }\n      nodesByPublicationTitle.push(obj)\n    })\n\n    this.state = {\n      option: this.props.options[0],\n      previewSearch: [],\n      publicationsTitles: allTitles,\n      nodesByPublicationTitle: nodesByPublicationTitle\n    }\n    this.handleSearch = this.handleSearch.bind(this);\n    this.changeOption = this.changeOption.bind(this);\n    this.searching = this.searching.bind(this);\n    this.selectResult = this.selectResult.bind(this);\n    this.resetSearch = this.resetSearch.bind(this);\n  }\n\n  handleSearch(searchResults) {\n    this.props.searchRecord(searchResults);\n  }\n\n  changeOption(option) {\n    const newOption = this.props.options.filter(d=>{return d.label === option})[0]\n    this.setState({\n      option: newOption\n    });\n  }\n\n  searching(value) {\n    let nestedData = [];\n    if (this.state.option.label === 'raccolta') {\n      nestedData = this.state.nodesByPublicationTitle.filter( d => {\n        return d.key.toLowerCase().includes(value.toLowerCase())\n      })\n    } else {\n      nestedData = d3.nest()\n        .key( d => d[this.state.option.dimension])\n        .entries(this.props.originalData)\n        .map( d => {\n          return {\n            key: d.key,\n            values: d.values.map(d=>d.id)\n          }\n        })\n        .filter( d => {\n          return d.key.toLowerCase().includes(value.toLowerCase())\n        })\n    }\n    // console.log(nestedData)\n    if (nestedData.length) {\n      this.setState({\n        previewSearch: nestedData\n      });\n    }\n  }\n\n  selectResult(value) {\n    this.setState({\n      previewSearch:[]\n    })\n    this.props.searchRecord(value.split(','))\n  }\n\n  resetSearch() {\n    this.props.resetSearch();\n  }\n\n  render() {\n    return (\n      <div className=\"filter-search\" style={this.props.style}>\n        <h5>{this.props.title}</h5>\n        <SimpleDropDown style={{display: 'inline-block'}} options={this.props.options.map(d=>d.label)} changeOption={this.changeOption}/>\n        <SimpleSearch style={{display: 'inline-block'}} searching={this.searching} previewSearch={this.state.previewSearch} selectResult={this.selectResult} minLength={this.props.minLength} />\n        { (this.props.search && this.props.search.length>0) && <span onClick={this.resetSearch}><FontAwesomeIcon icon={faTimesCircle} /></span>}\n      </div>\n    );\n  }\n}\n\nexport default FilterSearch;\n\nFilterSearch.defaultProps = { title: 'Search for a Record' };\n","import * as d3 from 'd3';\nimport ParseMatrixData from '../../PlacesMatrixView/parse-matrix-data';\nimport _ from 'lodash';\n\nconst V = {}\n\nconst categories = [\n\t'generico_non_terrestre',\n\t'nominato_non_terrestre',\n\t'nominato_terrestre',\n\t'generico_terrestre',\n\t'inventato',\n\t'no_ambientazione'\n]\n\nconst categoriesColors = [\n\t'#3131ff',\n\t'#bbbbff',\n\t'#ffce00',\n\t'#ff6c39',\n\t'#00c19c',\n\t'#cecece'\n]\n\nconst collisionPadding = 0.25;\n\n// data\nlet theOriginalData, graph, nodes = [], links = [], hullsData = [],\n\t\trootNodes = [], storedFilters,\n\t\tlast=0, openAllState=false, resetByClick = false\n\n// Dimensions and scales\nlet x, y, r, color, margin, width, height;\nlet xAxisCall, yAxisCall;\nmargin = { 'top': 0, 'right': 50, 'bottom': 30, 'left': 50 }\n\n// elements\nlet svg, g, gigi, xAxis, yAxis, hull, link, node, presumed, label, information\n\n// force-layout\nlet simulation\n\nfunction openSubnodes(d,noRestart) {\n\tif (d.subNodes && d.subNodes.length){\n\t\t// nodes.forEach(d=>{d.fx=null;d.fy=null;})\n\t\tif (d.part_of === '') {\n\t\t\td.fx = d.x*1;\n\t\t\td.fy = d.y*1;\n\t\t}\n\n    d.subNodes.forEach(function(subNode, i){\n\t\t\tsubNode.x = d.x;\n\t\t\tsubNode.y = d.y;\n    })\n\n    d.opened = true;\n\n    // Make convex hull\n    var thisHullNodes = [d].concat(d.subNodes); // first element in array is always the one opened, so we can use its ID as identifier for the convex hull\n    hullsData.push(thisHullNodes);\n\n    // check if the first point of the hull is inside another hulls\n    // if so it means this hull should be part of that opened\n    // add these points to that hullsData\n    hullsData.forEach(function(thisHull){\n      // if the element is in the array, but is not the first\n      if (thisHull.indexOf(thisHullNodes[0]) > 0) {\n        thisHullNodes.forEach(function(n,i){\n          if (i !== 0) {\n            thisHull.push(n);\n          }\n        })\n      }\n    })\n\n    // calculate Graph\n    var augmentedNodes = nodes.concat(d.subNodes);\n    graph = ParseMatrixData.calculateNetwork(augmentedNodes);\n    nodes = graph.nodes;\n    links = graph.edges;\n    if (noRestart !== false) {\n      V.update(graph, storedFilters);\n    }\n  } else {\n    console.log('No nodes to expand')\n  }\n}\n\nfunction closeSubnodes(d,noRestart) {\n\tif (d.opened) {\n\n    d.opened = false;\n    d.fx = null;\n    d.fy = null;\n\n    var subNodes2Remove = [];\n    var hulls2Remove = [d.id]\n\n    // recursive functions, it makes possible to close contained cluster of nodes\n    function collectSubNodes(parentNode) {\n      // console.log(`There are ${parentNode.subNodes.length} sub-nodes of ${parentNode.label}`)\n      parentNode.subNodes.forEach( childNode => {\n        if (childNode.opened) {\n          childNode.opened = false;\n          hulls2Remove.push(childNode.id);\n          collectSubNodes(childNode);\n        }\n      });\n      subNodes2Remove.push(parentNode.subNodes);\n      // console.log(`${parentNode.label} has ${parentNode.subNodes} nodes to be removed`);\n    }\n\n    collectSubNodes(d);\n\n    // cycle in the subNodes2Remove array and for each list of sub-nodes to be removed remove and re-calculate the network.\n    // Probably not the best way, but the simplest at the moment of the coding.\n    subNodes2Remove.forEach( subNodes => {\n\n      let toRemove = subNodes.map( d => d.id)\n      let filtered = nodes.filter( el => {\n        return !toRemove.includes( el.id );\n      })\n\n      // remove this hull\n      hullsData = hullsData.filter(function(h){\n        return !hulls2Remove.includes( h[0].id );\n      })\n\n      // remove extra points from the outer hull\n      hullsData.forEach(function(thisHull,i){\n        hullsData[i] = thisHull.filter(function(n){\n          return !toRemove.includes( n.id );\n        })\n      })\n\n      // calculate graph\n      graph = ParseMatrixData.calculateNetwork(filtered)\n\t\t\tnodes = graph.nodes;\n\t    links = graph.edges;\n    } )\n\n    if (noRestart !== false) {\n      V.update(graph, storedFilters);\n    }\n    // important to return here so to not do the following instructions\n    return;\n  }\n}\n\nfunction toggleSubnodes(d, noRestart) {\n  if(d.opened) {\n    closeSubnodes(d, noRestart);\n  }\n  if (d.subNodes && d.subNodes.length){\n\t\topenSubnodes(d,noRestart);\n  } else {\n    console.log('No nodes to expand')\n  }\n}\n\nfunction toggleSubnodesOLD(d, noRestart) {\n  if(d.opened) {\n    d.opened = false;\n    d.fx = null;\n    d.fy = null;\n\n    var subNodes2Remove = [];\n    var hulls2Remove = [d.id]\n\n    // recursive functions, it makes possible to close contained cluster of nodes\n    function collectSubNodes(parentNode) {\n      // console.log(`There are ${parentNode.subNodes.length} sub-nodes of ${parentNode.label}`)\n      parentNode.subNodes.forEach( childNode => {\n        if (childNode.opened) {\n          childNode.opened = false;\n          hulls2Remove.push(childNode.id);\n          collectSubNodes(childNode);\n        }\n      });\n      subNodes2Remove.push(parentNode.subNodes);\n      // console.log(`${parentNode.label} has ${parentNode.subNodes} nodes to be removed`);\n    }\n\n    collectSubNodes(d);\n\n    // cycle in the subNodes2Remove array and for each list of sub-nodes to be removed remove and re-calculate the network.\n    // Probably not the best way, but the simplest at the moment of the coding.\n    subNodes2Remove.forEach( subNodes => {\n\n      let toRemove = subNodes.map( d => d.id)\n      let filtered = nodes.filter( el => {\n        return !toRemove.includes( el.id );\n      })\n\n      // remove this hull\n      hullsData = hullsData.filter(function(h){\n        return !hulls2Remove.includes( h[0].id );\n      })\n\n      // remove extra points from the outer hull\n      hullsData.forEach(function(thisHull,i){\n        hullsData[i] = thisHull.filter(function(n){\n          return !toRemove.includes( n.id );\n        })\n      })\n\n      // calculate graph\n      graph = ParseMatrixData.calculateNetwork(filtered)\n\t\t\tnodes = graph.nodes;\n\t    links = graph.edges;\n    } )\n\n    if (noRestart !== false) {\n      V.update(graph, storedFilters);\n    }\n    // important to return here so to not do the following instructions\n    return;\n  }\n  if (d.subNodes && d.subNodes.length){\n\t\t// nodes.forEach(d=>{d.fx=null;d.fy=null;})\n\t\tif (d.part_of === '') {\n\t\t\td.fx = d.x*1;\n\t\t\td.fy = d.y*1;\n\t\t}\n\n    d.subNodes.forEach(function(subNode, i){\n\t\t\tsubNode.x = d.x;\n\t\t\tsubNode.y = d.y;\n    })\n    d.opened = true;\n\n    // Make convex hull\n    var thisHullNodes = [d].concat(d.subNodes); // first element in array is always the one opened, so we can use its ID as identifier for the convex hull\n    hullsData.push(thisHullNodes);\n\n    // check if the first point of the hull is inside another hulls\n    // if so it means this hull should be part of that opened\n    // add these points to that hullsData\n    hullsData.forEach(function(thisHull){\n      // if the element is in the array, but is not the first\n      if (thisHull.indexOf(thisHullNodes[0]) > 0) {\n        thisHullNodes.forEach(function(n,i){\n          if (i !== 0) {\n            thisHull.push(n);\n          }\n        })\n      }\n    })\n\n    // calculate Graph\n    var augmentedNodes = nodes.concat(d.subNodes);\n    graph = ParseMatrixData.calculateNetwork(augmentedNodes);\n    nodes = graph.nodes;\n    links = graph.edges;\n    if (noRestart !== false) {\n\t\t\tstoredFilters.update = true;\n      V.update(graph, storedFilters);\n    }\n  } else {\n    console.log('No nodes to expand')\n  }\n}\n\nfunction highlightNodes(arr, doReset){\n\tif (doReset) reset();\n  arr.forEach( d => {\n    node.filter(function(e){ return e.source !== d.source; }).style('opacity', 0.1);\n\t\tpresumed.filter(function(e){ return e.source !== d.source; }).style('opacity', 0.1);\n    label.filter(function(e){ return d.id === e.id }).classed('selected', true).style('display','block');\n\n\t\tdisplayTitle([d]);\n  })\n}\n\nconst displayTitle = (arr) => {\n\n\t// show work title\n\tinformation = information.data(arr, function(d) { return d.id; });\n\tinformation.exit().remove();\n\tinformation = information.enter().append(\"text\")\n\t\t.classed('information', true)\n\t\t.classed('label', true)\n\t\t.attr('text-anchor', d => (x(d.year) >= width/2) ? 'end' : 'start')\n\t\t.attr('x', d => (x(d.year) >= width/2) ? x(d.year)+4.8 : x(d.year)-3.2)\n\t\t.attr('y', height - 10)\n\t\t.text( d => (x(d.year) >= width/2) ? d.sourceTitle + ' ↓' : '↓ ' + d.sourceTitle)\n\t\t.merge(information);\n}\n\nfunction highlightCategories(arr, doReset) {\n\tif (doReset) reset();\n\t// console.log(arr)\n\tlet arrId = arr.map( d => d.id)\n\tnode.filter(function(n){ return arrId.indexOf(n.id) < 0 }).style('opacity', 0.1);\n\tpresumed.filter(function(n){ return arrId.indexOf(n.id) < 0 }).style('opacity', 0.1);\n\t// label.filter(function(n){ return arrId.indexOf(n.id) > -1 }).classed('selected', true).style('display','block');\n}\n\nfunction reset() {\n\tif (resetByClick) return;\n  node.style('opacity', 1);\n\tpresumed.style('opacity', 1);\n  label.classed('selected', false).style('display', 'none');\n  // remove work title\n  displayTitle([]);\n}\n\nV.initialize = (el, data, filters, originalData) => {\n  // console.log('init',data, filters)\n\n  // Since React calls the update without data, at the beginning store data\n  // so that when time-filter is used (and React calls update) there is data to use\n  graph = data\n  rootNodes = data.nodes.filter( d => d.totalSubNodes>0);\n\ttheOriginalData = originalData;\n\n  // //get themes\n  // let themes = []\n  // d3.nest()\n  //   .key(d=>d.theme)\n  //   .entries(graph.nodes)\n  //   .map(d=>d.key)\n  //   .forEach(d=>{ themes = themes.concat(d.split(';')) });\n  // themes = d3.nest()\n  //   .key(d=>d)\n  //   .entries(themes)\n  //   .map(d=>d.key)\n  //   .sort();\n  // console.log(JSON.stringify(themes))\n\n  // Root and dimensions\n  svg = d3.select(el).style('touch-action', 'manipulation');\n  width = svg.node().getBoundingClientRect().width - margin.left - margin.right;\n  height = svg.node().getBoundingClientRect().height - margin.top - margin.bottom;\n\n\tlet zoom = d3.zoom()\n\t\t\t.translateExtent([[0, 0], [width + margin.left + margin.right, height + margin.top + margin.bottom]])\n\t    .scaleExtent([1, 10])\n\t    .on(\"zoom\", zoomed);\n\n\tsvg.call(zoom).on(\"dblclick.zoom\", null);\n\n\tfunction zoomed() {\n\t  gigi.attr(\"transform\", d3.event.transform);\n\t\tyAxis.attr(\"transform\", d3.event.transform);\n\n\t\t// x axis resize taken from: https://bl.ocks.org/rutgerhofste/5bd5b06f7817f0ff3ba1daa64dee629d\n\t\tlet new_x = d3.event.transform.rescaleX(x);\n\t\txAxis.call(xAxisCall.scale(new_x))\n\n\t\tlet one_rem = parseInt(d3.select('html').style('font-size'));\n\n\t\td3.select('.labels')\n\t\t\t.style('font-size', d=>{\n\t\t\t\tlet cssRemSize = 0.75;\n\t\t\t\tlet k = cssRemSize * 1/d3.event.transform.k;\n\t\t\t\tk+='rem';\n\t\t\t\treturn k;\n\t\t\t})\n\n\t\tinformation\n\t\t\t.attr('x', d => (new_x(d.year) >= width/2) ? new_x(d.year)+4.8 : new_x(d.year)-3.2);\n\t}\n\n  // Scales\n  x = d3.scaleTime()\n    .range([0, width])\n    .domain(d3.extent(data.nodes, d=>d.year));\n  xAxisCall = d3.axisBottom(x).ticks(d3.timeYear.every(1))\n\n  y = d3.scalePoint()\n    .range([0, height])\n    .padding(0.5);\n  yAxisCall = d3.axisRight(y).tickSize(width)\n\t\t.tickFormat(function(d){\n\t\t\td = d.replace(/_/g, ' ')\n\t\t\treturn d;\n\t\t})\n  y.domain(categories)\n\n  r = d3.scalePow()\n    .exponent(0.5)\n    // .range([15,75])\n    .range([3,25])\n    .domain([1,d3.max(data.nodes, function(d){ return d.totalSubNodes })])\n  color = d3.scaleOrdinal().domain(categories).range(categoriesColors)\n\n\n  // elements\n  svg.append('rect')\n  \t.classed('reset', true)\n  \t.attr('x', margin.left)\n  \t.attr('width', width)\n  \t.attr('height', height)\n  \t.attr('fill', 'transparent')\n  \t.on('click', function(d){\n\t\t\tresetByClick = false;\n\t\t\tif ((d3.event.timeStamp - last) < 500) reset();\n\t\t\tlast = d3.event.timeStamp;\n\t\t});\n  g = svg.append('g').attr(\"transform\", `translate(${margin.left},${margin.top})`).append('g')\n  xAxis = g.append(\"g\").attr(\"class\", \"x-axis\")\n  yAxis = g.append('g').attr(\"class\", \"y-axis\")\n\n  yAxis.attr(\"transform\", `translate(0, 0)`)\n    .call(yAxisCall)\n    .call(g => g.selectAll(\".tick text\")\n          .style(\"text-transform\", \"capitalize\"))\n    .call(g => g.select(\".domain\")\n          .remove())\n      .call(g => g.selectAll(\".tick line\")\n          .attr(\"stroke-opacity\", 0.5)\n          .attr(\"stroke-dasharray\", \"2,2\"))\n      .call(g => g.selectAll(\".tick text\")\n          .attr(\"x\", 4)\n          .attr(\"dy\", -y.step()/10));\n\n\tyAxis.selectAll('.tick').on('click', function(d){\n\n\t\tif (d3.select(this).classed('selected') === false ) {\n\n\t\t\tif (d3.selectAll('.tick.selected').size() > 0) {\n\t\t\t\trootNodes.forEach(n=>{closeSubnodes(n,false)});\n\t\t\t\td3.selectAll('.tick.selected').classed('selected', false);\n\t\t\t}\n\n\t\t\tlet toOpen = []\n\t\t\tnodes.forEach(n0=>{\n\t\t\t\t// console.log('n0',n0);\n\t\t\t\tif (n0.totalSubNodes>0){\n\t\t\t\t\tif (n0.subNodes.map(n=>n.category).indexOf(d) > -1) {\n\t\t\t\t\t\ttoOpen.push(n0);\n\t\t\t\t\t}\n\t\t\t\t\tn0.subNodes.forEach(n1=>{\n\t\t\t\t\t\t// console.log('n1',n1);\n\t\t\t\t\t\tif(n1.totalSubNodes>0) {\n\t\t\t\t\t\t\tif (n1.subNodes.map(n=>n.category).indexOf(d) > -1) {\n\t\t\t\t\t\t\t\ttoOpen.push(n0);\n\t\t\t\t\t\t\t\ttoOpen.push(n1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tn1.subNodes.forEach(n2=>{\n\t\t\t\t\t\t\t\t// console.log('n2',n2);\n\t\t\t\t\t\t\t\tif(n2.totalSubNodes>0) {\n\t\t\t\t\t\t\t\t\tif (n2.subNodes.map(n=>n.category).indexOf(d) > -1) {\n\t\t\t\t\t\t\t\t\t\ttoOpen.push(n0);\n\t\t\t\t\t\t\t\t\t\ttoOpen.push(n1);\n\t\t\t\t\t\t\t\t\t\ttoOpen.push(n2);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\ttoOpen.forEach(n=>{openSubnodes(n,false)});\n\t\t\tnode.filter(nn=>{return nn.category!==d}).style('opacity',0.1)\n\t\t} else {\n\t\t\tlet toClose = []\n\t\t\tnodes.forEach(n0=>{\n\t\t\t\t// console.log('n0',n0);\n\t\t\t\tif (n0.totalSubNodes>0){\n\t\t\t\t\tif (n0.subNodes.map(n=>n.category).indexOf(d) > -1) {\n\t\t\t\t\t\ttoClose.push(n0);\n\t\t\t\t\t}\n\t\t\t\t\tn0.subNodes.forEach(n1=>{\n\t\t\t\t\t\t// console.log('n1',n1);\n\t\t\t\t\t\tif(n1.totalSubNodes>0) {\n\t\t\t\t\t\t\tif (n1.subNodes.map(n=>n.category).indexOf(d) > -1) {\n\t\t\t\t\t\t\t\ttoClose.push(n0);\n\t\t\t\t\t\t\t\ttoClose.push(n1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tn1.subNodes.forEach(n2=>{\n\t\t\t\t\t\t\t\t// console.log('n2',n2);\n\t\t\t\t\t\t\t\tif(n2.totalSubNodes>0) {\n\t\t\t\t\t\t\t\t\tif (n2.subNodes.map(n=>n.category).indexOf(d) > -1) {\n\t\t\t\t\t\t\t\t\t\ttoClose.push(n0);\n\t\t\t\t\t\t\t\t\t\ttoClose.push(n1);\n\t\t\t\t\t\t\t\t\t\ttoClose.push(n2);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\ttoClose.forEach(n=>{closeSubnodes(n,false)});\n\t\t\tnode.style('opacity',1)\n\t\t}\n\n\t\tV.update(graph, storedFilters);\n\n\t\td3.select(this).classed('selected', !d3.select(this).classed('selected'))\n\n\t\t// highlightCategories(toHighlight, 'do reset')\n\t})\n\n\tgigi = g.append('g')\n\n  link = gigi.append('g').classed('links', true).selectAll('.link');\n  hull = gigi.append('g').classed('hulls', true).selectAll('.hull');\n  node = gigi.append('g').classed('nodes', true).selectAll('.node');\n\tpresumed = gigi.append('g').classed('presumed', true).selectAll('.presumed');\n  label = gigi.append('g').classed('labels', true).selectAll('.label');\n  information = g.append('g').classed('informations', true).selectAll('.information');\n\n  simulation = d3.forceSimulation(nodes)\n  \t.force(\"link\", d3.forceLink()\n  \t\t.strength( 0.1 )\n  \t\t.distance( r.range()[0] )\n  \t\t.id(function(d) { return d.id; })\n  \t)\n  \t.force(\"x\", d3.forceX(d=>d.x)\n  \t\t.strength(1)\n  \t)\n  \t.force(\"y\", d3.forceY(d=>d.y)\n\t\t.strength(1)\n  \t)\n  \t.force(\"collision\", d3.forceCollide(function(d){\n\t\t\t\tlet thisCollisionPadding = d.totalSubNodes>0 ? collisionPadding+2 : collisionPadding;\n  \t\t\treturn d.opened ? r(1)+thisCollisionPadding : r(d.totalSubNodes + 1)+thisCollisionPadding\n  \t\t})\n  \t\t.iterations(12)\n  \t\t.strength(0.35)\n  \t)\n  \t.on(\"tick\", ticked)\n    .on(\"end\", () => {\n\t\t\tconsole.log('simulation ended')\n\t\t})\n    .stop()\n\n  function ticked() {\n  \tnode.attr(\"cx\", function(d) { d.positionedYear = x.invert(d.x); return d.x; })\n  \t\t.attr(\"cy\", function(d) { return d.y; });\n\t\tpresumed.attr(\"cx\", function(d) { return d.x; })\n  \t\t.attr(\"cy\", function(d) { return d.y; });\n  \tlabel.attr(\"x\", function(d) { return d.x; })\n  \t\t.attr(\"y\", function(d) { return d.y; });\n  \tlink.attr(\"x1\", function(d) { return d.source.x; })\n  \t\t.attr(\"y1\", function(d) { return d.source.y; })\n  \t\t.attr(\"x2\", function(d) { return d.target.x; })\n  \t\t.attr(\"y2\", function(d) { return d.target.y; });\n  \thull.attr(\"d\", function(d){\n  \t\tlet thisHullPoints = d.map( d => { return [d.x, d.y] });\n  \t\tvar points = thisHullPoints;\n  \t\tvar convexHull = (points.length < 3) ? points : d3.polygonHull(points);\n  \t\treturn roundedHull(convexHull, d);\n  \t})\n\n\t\tif (simulation.alpha() < 0.15) {\n\t\t\tsimulation.force(\"x\").strength(0.5)\n\t\t\tsimulation.force(\"y\").strength(0.1)\n\t\t}\n  }\n\n  V.update(data, filters)\n}\n\nV.update = (data, filters) => {\n  // console.log('update viz')\n\n  // This is because react must call the update without data\n  if (!data) data = graph\n  nodes = data.nodes;\n  links = data.edges;\n\n\tstoredFilters = filters\n\n\tif (filters.search.length) {\n\n\t\tlet parents2open = [];\n\t\tfilters.search.forEach(s=>{\n\t\t\tsearch4Parent(s);\n\t\t});\n\t\tfunction search4Parent(nodeId){\n\t\t\tconst thisNode = theOriginalData.filter(od=>od.id===nodeId)[0];\n\t\t\tif (thisNode.part_of !== \"\") {\n\t\t\t\tparents2open.push(thisNode.part_of);\n\t\t\t\tsearch4Parent(thisNode.part_of);\n\t\t\t}\n\t\t}\n\n\t\t// I technically should open interesting parents, but it is kind of ahard.\n\t\t// Provisionally solve the issue by highliting parents\n\t\t// surviveFilters[2] = _.union(surviveFilters[2], parents2open)\n\n\t\t// To fix it I probably need to write a new method just for the filters (V.filter).\n\t\tif (parents2open.length > 0) {\n\t\t\tparents2open.reverse().forEach((parentId,i)=>{\n\t\t\t\tconst parent = theOriginalData.filter(od=>od.id===parentId)[0]\n\t\t\t\topenSubnodes(parent, false);\n\t\t\t})\n\t\t\tfilters.update = true\n\t\t}\n\t}\n\n  if (filters.update) {\n\n\t\tlet isTimeFiltered = false;\n\n\t\tif (filters.timeFilter) {\n\n\t\t\tif (filters.timeFilter[0].getFullYear() != x.domain()[0].getFullYear() || filters.timeFilter[1].getFullYear() != x.domain()[1].getFullYear()) {\n\t\t\t\tisTimeFiltered = true;\n\t\t\t\tsimulation.force(\"x\").strength(1);\n\t\t\t\tsimulation.force(\"y\").strength(0.7);\n\t\t\t\t// console.log(\"isTimeFiltered\")\n\t\t\t}\n\n\t\t\tx.domain(d3.extent(nodes.filter( d => {\n\t\t\t\tconst date = new Date(d.year)\n\t\t\t\treturn date >= filters.timeFilter[0] && date <= filters.timeFilter[1]\n\t\t\t}), d=>d.year))\n\t    xAxis.attr(\"transform\", `translate(${0}, ${height})`).call(xAxisCall)\n\t\t}\n\n\t\t// Set x and y of subNodes\n\t\tdata.nodes.forEach(d => {\n\t\t\td.x = (d.x&&!isTimeFiltered) ? d.x : x(d.year);\n\t\t\td.y = d.y ? d.y : y(d.category);\n\n\t\t\tif(d.fx&&isTimeFiltered) {\n\t\t\t\td.fx = null\n\t\t\t}\n\n\t\t})\n\n    // Update the force layout\n    simulation.force(\"x\").x(function(d) { return d.x })\n\n    node = node.data(nodes, d => { return d.id })\n    node.exit().remove();\n    node = node.enter().append('circle')\n      .attr('class', d => `node`)\n\t\t\t.classed('sub-node', d => d.part_of !== '' )\n      .on('click', function(d){\n\n\t\t\t\tresetByClick = d;\n\n\t\t\t\thighlightNodes([d], 'do reset opacity');\n\n  \t\t\t// get the double tap\n  \t\t\tif ((d3.event.timeStamp - last) < 500) {\n\t\t\t\t\tconsole.log('toggle subnodes of', d)\n          toggleSubnodes(d);\n\t\t\t\t\treturn;\n        }\n\t\t\t\tlast = d3.event.timeStamp;\n  \t\t})\n\t\t\t.on('mouseenter', d=>{\n\t\t\t\tif (!resetByClick || d.source === resetByClick.source) {\n\t\t\t\t\thighlightNodes([d], 'do reset opacity');\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on('mouseleave', d=>{\n\t\t\t\tif (!resetByClick || d.source === resetByClick.source) {\n\t\t\t\t\treset();\n\t\t\t\t}\n\t\t\t\tlabel.filter( e=>e.id===d.id).classed('selected', false).style('display','none');\n\t\t\t})\n      .attr('key', d=> d.id)\n      .attr('cx', d => {\n        return d.x\n      })\n      .attr('cy', d => {\n        return d.y\n      })\n      .merge(node)\n      .style('cursor', function(d){ return d.subNodes && d.subNodes.length ? 'pointer' : 'auto'; })\n  \t\t.attr(\"fill\", function(d) { return d.opened===true ? 'white' : color(d.category); })\n  \t\t.attr('stroke', function(d) { if(d.totalSubNodes > 0) return d3.color(color(d.category)).darker(1) })\n      // .style('opacity', 1)\n      .attr(\"r\", function(d){ return d.opened ? r(1) : r(d.totalSubNodes + 1) }) // +1 means plus itself\n\n\t\tpresumed = presumed.data(nodes.filter(d => { return d.isGuessed }), d => { return d.id })\n    presumed.exit().remove();\n    presumed = presumed.enter().append('circle')\n\t\t\t.classed('presumed', true)\n\t\t\t.attr('r', 1.5)\n\t\t\t.attr('fill', function(d) { return d3.color(color(d.category)).darker(1) })\n\t\t\t.attr('cx', d => {\n        return d.x\n      })\n      .attr('cy', d => {\n        return d.y\n      })\n\t\t\t.merge(presumed)\n\n    // Apply the general update pattern to the links.\n  \tlink = link.data(links, function(d) {\n  \t\treturn d.source.id + \"-\" + d.target.id;\n  \t});\n  \tlink.exit().remove();\n  \tlink = link.enter().append(\"line\")\n  \t\t.classed('link', true)\n  \t\t.classed('part-of', function(d) { return d.kind === 'part_of' })\n      .attr('stroke-width', 0.5)\n      .attr('stroke', '#ccc')\n  \t\t.on('click', d => console.log(d))\n  \t\t.merge(link);\n\n  \t// Apply the general update pattern to the labels.\n  \tlabel = label.data(nodes, function(d) { return d.id; });\n  \tlabel.exit().remove();\n  \tlabel = label.enter().append(\"text\")\n  \t\t.classed('label', true)\n  \t\t.style('display', 'none')\n  \t\t.attr('text-anchor', 'middle')\n      .style('pointer-events', 'none')\n  \t\t.text(function(d){return d.label})\n  \t\t.merge(label);\n\n  \t// Apply the general update pattern to the convex hulls.\n  \thull = hull.data(hullsData, function(d) {\n  \t\treturn d[0].id;\n  \t});\n  \thull.exit().remove();\n  \thull = hull.enter().append(\"path\")\n  \t\t.classed('hull', true)\n  \t\t.attr('fill', function(d){\n  \t\t\treturn color(d[0].category)\n  \t\t})\n  \t\t.style('opacity', .25)\n  \t\t.merge(hull);\n\n    simulation.nodes(nodes);\n\t\tif (simulation.force(\"link\")) {\n\t\t\tsimulation.force(\"link\").links(links);\n\t\t}\n  \tsimulation.alpha(1).restart();\n  }\n\n\tV.filter(filters);\n\n}\n\nV.filter = filters => {\n\tif (filters) {\n\t\t// store filters\n\t\t// do filters here\n\t\tif (filters.openAll !== undefined && filters.openAll !== openAllState) {\n\t\t\tconsole.log('open or close all', filters.openAll)\n\t\t\topenAllState = filters.openAll\n\t\t\tif (openAllState === true) {\n\t\t\t\tV.openAll();\n\t\t\t} else {\n\t\t\t\tV.closeAll();\n\t\t\t}\n\t\t}\n\n\t\tlet surviveFilters = []\n\n\t\tlet pubTypes = filters.selectedPublications;\n\t\tsurviveFilters[0] = nodes.filter( d=>{\n\t\t\tlet check = pubTypes.map(e => d.publicationType.indexOf(e) > -1 )\n\t\t\treturn check.indexOf(true) > -1;\n\t\t}).map(d=>d.id);\n\n\t\tlet pubThemes = filters.selectedThemes;\n\t\tsurviveFilters[1] = nodes.filter( d=>{\n\t\t\tlet check = pubThemes.map(e => d.themes.indexOf(e) > -1 )\n\t\t\treturn check.indexOf(true) > -1;\n\t\t}).map(d=>d.id);\n\n\t\tif (filters.search.length) {\n\t\t\tsurviveFilters[2] = filters.search;\n\n\t\t\tlet parents2open=[];\n\t\t\tfilters.search.forEach(s=>{\n\t\t\t\tsearch4Parent(s);\n\t\t\t});\n\t\t\tfunction search4Parent(nodeId){\n\t\t\t\tconst thisNode = theOriginalData.filter(od=>od.id===nodeId)[0];\n\t\t\t\tif (thisNode.part_of !== \"\") {\n\t\t\t\t\tparents2open.push(thisNode.part_of);\n\t\t\t\t\tsearch4Parent(thisNode.part_of);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// I technically should open interesting parents, but it is kind of ahard.\n\t\t\t// Provisionally solve the issue by highliting parents\n\t\t\tsurviveFilters[2] = _.union(surviveFilters[2], parents2open)\n\n\t\t}\n\n\t\t// console.log('surviveFilters', surviveFilters)\n\t\tlet mergeSurvived = [];\n\t\tsurviveFilters.forEach((d,i) => {\n\t\t\tif (i===0) {\n\t\t\t\tmergeSurvived = d;\n\t\t\t} else {\n\t\t\t\tif (surviveFilters[i].length) {\n\t\t\t\t\tmergeSurvived = _.intersection(mergeSurvived, surviveFilters[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t// console.log(\"survived\", mergeSurvived.length)\n\t\tnode.classed('faded', d=>mergeSurvived.indexOf(d.id) < 0);\n\t}\n}\n\nV.openAll = () => {\n\trunAll(nodes);\n\tfunction runAll(nodesList) {\n\t\tnodesList.forEach( n => {\n\t\t\tif (n.totalSubNodes > 0) {\n\t\t\t\topenSubnodes(n, false);\n\t\t\t\trunAll(n.subNodes);\n\t\t\t}\n\t\t});\n\t}\n\t// simulation.force(\"x\").strength(1)\n\t// simulation.force(\"y\").strength(1)\n\tV.update(graph, storedFilters);\n}\n\nV.closeAll = () => {\n\n\trootNodes.forEach(function(d){\n\t\tcloseSubnodes(d, false);\n\t})\n\t// simulation.force(\"x\").strength(1)\n\t// simulation.force(\"y\").strength(1)\n\tV.update(graph, storedFilters);\n}\n\n\n\nV.destroy = () => {}\n\nexport default V\n\n//\n//\n//\n//\n// convex hull from http://bl.ocks.org/hollasch/f70f1fe7700f092b5a505e3efd1d9232\n//\n//\n//\n//\n\nvar hullPadding = collisionPadding;\n// var pointRadius = 5;\n// var margin = hullPadding + pointRadius;\n\nvar vecScale = function (scale, v) {\n    // Returns the vector 'v' scaled by 'scale'.\n    return [ scale * v[0], scale * v[1] ];\n}\n\nvar vecSum = function (pv1, pv2) {\n    // Returns the sum of two vectors, or a combination of a point and a vector.\n    return [ pv1[0] + pv2[0], pv1[1] + pv2[1] ];\n}\n\nvar unitNormal = function (p0, p1) {\n    // Returns the unit normal to the line segment from p0 to p1.\n    var n = [ p0[1] - p1[1], p1[0] - p0[0] ];\n    var nLength = Math.sqrt (n[0]*n[0] + n[1]*n[1]);\n    return [ n[0] / nLength, n[1] / nLength ];\n};\n\nvar strictHull = function(polyPoints) {\n    // This method returns a polygon given the specified points. The points are assumed to be in polygon order.\n    return (\n        'M ' + polyPoints[0]\n        + ' L '\n        + d3.range(1,polyPoints.length)\n            .map(function(i) {return polyPoints[i];})\n            .join(' L')\n        + ' Z'\n    );\n};\n\nvar roundedHull = function (polyPoints, data) {\n    // Returns the SVG path data string representing the polygon, expanded and rounded.\n\n\t// console.log(polyPoints, data);\n\n\thullPadding = d3.max(data, function(d){\n\t\treturn d.opened ? r(1) + collisionPadding : r(d.totalSubNodes + 1) + collisionPadding;\n\t})\n\n    // Handle special cases\n    if (!polyPoints || polyPoints.length < 1) return \"\";\n    if (polyPoints.length === 1) return roundedHull1 (polyPoints, data);\n    if (polyPoints.length === 2) return roundedHull2 (polyPoints, data);\n\n    var segments = new Array (polyPoints.length);\n\n    // Calculate each offset (outwards) segment of the convex hull.\n    for (var segmentIndex = 0;  segmentIndex < segments.length;  ++segmentIndex) {\n        var p0 = (segmentIndex === 0) ? polyPoints[polyPoints.length-1] : polyPoints[segmentIndex-1];\n        var p1 = polyPoints[segmentIndex];\n\n        // Compute the offset vector for the line segment, with length = hullPadding.\n        var offset = vecScale (hullPadding, unitNormal (p0, p1));\n\n        segments[segmentIndex] = [ vecSum (p0, offset), vecSum (p1, offset) ];\n    }\n\n    var arcData = 'A ' + [hullPadding, hullPadding, '0,0,0,'].join(',');\n\n    segments = segments.map (function (segment, index) {\n        var pathFragment = \"\";\n        if (index === 0) {\n            var pathFragment = 'M ' + segments[segments.length-1][1] + ' ';\n        }\n        pathFragment += arcData + segment[0] + ' L ' + segment[1];\n\n        return pathFragment;\n    });\n\n    return segments.join(' ');\n}\n\nvar roundedHull1 = function (polyPoints, data) {\n    // Returns the path for a rounded hull around a single point (a circle).\n\n    var p1 = [polyPoints[0][0], polyPoints[0][1] - hullPadding];\n    var p2 = [polyPoints[0][0], polyPoints[0][1] + hullPadding];\n\n    return 'M ' + p1\n        + ' A ' + [hullPadding, hullPadding, '0,0,0', p2].join(',')\n        + ' A ' + [hullPadding, hullPadding, '0,0,0', p1].join(',');\n};\n\n\nvar roundedHull2 = function (polyPoints, data) {\n    // Returns the path for a rounded hull around two points (a \"capsule\" shape).\n\n    var offsetVector = vecScale (hullPadding, unitNormal (polyPoints[0], polyPoints[1]));\n    var invOffsetVector = vecScale (-1, offsetVector);\n\n    var p0 = vecSum (polyPoints[0], offsetVector);\n    var p1 = vecSum (polyPoints[1], offsetVector);\n    var p2 = vecSum (polyPoints[1], invOffsetVector);\n    var p3 = vecSum (polyPoints[0], invOffsetVector);\n\n    return 'M ' + p0\n        + ' L ' + p1 + ' A ' + [hullPadding, hullPadding, '0,0,0', p2].join(',')\n        + ' L ' + p3 + ' A ' + [hullPadding, hullPadding, '0,0,0', p0].join(',');\n};\n\n\n/////// Interactions\n\ndocument.addEventListener('keydown', keyIsPressedHereYeah);\nfunction keyIsPressedHereYeah(e) {\n  if (e.key === 'l') label.classed('make-visible', true)\n\tif (e.key === 'L') label.classed('make-visible', false)\n}\n","import React, { Component } from 'react';\nimport './MoreInfo.css';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faQuestionCircle } from '@fortawesome/free-regular-svg-icons';\n\nclass MoreInfo extends Component {\n  render() {\n    return <div className=\"more-info\"><FontAwesomeIcon icon={faQuestionCircle} /></div>;\n  }\n}\n\nexport default MoreInfo;\n","import * as d3 from 'd3'\n\nconst ParseMatrixData = {}\n\nParseMatrixData.parser = (rawData) => {\n\n  rawData.forEach(function(d){ d.year = new Date(d.year); })\n\n  let data = rawData.map(function(d) {\n    d.year = new Date(d.year);\n    if(!d.id) { d.id = d['data.id'] }\n    var obj = {\n\t\t\t'id': d.id,\n\t\t\t'label': d['Occorrenza'],\n\t\t\t'part_of': d['Parte di ID'],\n\t\t\t'source': d['Fonte'],\n\t\t\t'sourceTitle': d['Titolo Fonte'],\n\t\t\t'year': +d.year,\n\t\t\t'category': d['Categoria'],\n\t\t\t'totalSubNodes':0,\n      'publicationType': d['Pubblicazione Fonte'].split(';'),\n      'pubVenueTitle': d['Pubblicazioni Titoli'],\n      'isGuessed': d['Luogo desunto'],\n      'themes': d['Tema'].split(';')\n\t\t}\n\t\treturn obj\n\t})\n\n  const hierarchies = ParseMatrixData.handleHierarchies(data)\n\n  const graph = ParseMatrixData.calculateNetwork(hierarchies);\n  return {graph,data};\n}\n\nParseMatrixData.handleHierarchies = (nodes) => {\n  let hierarchies = d3.nest()\n\t\t.key(function(d){ return d.part_of })\n\t\t.entries(nodes);\n\n\thierarchies\n\t\t.filter(function(d){ return d.key === '' })[0]\n\t\t.values.forEach(function(d){\n\t\t\tvar part_of_d = hierarchies.find(function(e){ return e.key === d.id })\n\t\t\tif (part_of_d) {\n\t\t\t\t// console.log('LVL 0',d.id, d.label, 'is parent of', part_of_d.values.length);\n\t\t\t\td.subNodes = part_of_d.values;\n\t\t\t\td.totalSubNodes = part_of_d.values.length\n\n\t\t\t\tpart_of_d.values.forEach(function(e){\n\t\t\t\t\tvar part_of_e = hierarchies.find(function(f){ return f.key === e.id })\n\t\t\t\t\tif (part_of_e) {\n\t\t\t\t\t\t// console.log('LVL 1',e.id, e.label, 'is parent of', part_of_e.values.length);\n\t\t\t\t\t\te.subNodes = part_of_e.values\n\t\t\t\t\t\te.totalSubNodes = part_of_e.values.length\n\t\t\t\t\t\td.totalSubNodes += e.totalSubNodes\n\n\t\t\t\t\t\tpart_of_e.values.forEach(function(f){\n\t\t\t\t\t\t\tvar part_of_f = hierarchies.find(function(g){ return g.key === f.id})\n\t\t\t\t\t\t\tif (part_of_f) {\n\t\t\t\t\t\t\t\t// console.log('LVL 2', f.id, f.label, 'is parent of', part_of_f.values.length)\n\t\t\t\t\t\t\t\tf.subNodes = part_of_f.values\n\t\t\t\t\t\t\t\tf.totalSubNodes = part_of_f.values.length\n\t\t\t\t\t\t\t\td.totalSubNodes += f.totalSubNodes\n\n\t\t\t\t\t\t\t\tpart_of_f.values.forEach(function(g){\n\t\t\t\t\t\t\t\t\tvar part_of_g = hierarchies.find(function(h){ return h.key === g.id })\n\t\t\t\t\t\t\t\t\tif (part_of_g) {\n\t\t\t\t\t\t\t\t\t\t// console.log('LVL 3', g.id, g.label, 'is parent of', part_of_g.values.length)\n\t\t\t\t\t\t\t\t\t\tg.subNodes = part_of_g.values\n\t\t\t\t\t\t\t\t\t\tg.totalSubNodes = part_of_g.values.length\n\t\t\t\t\t\t\t\t\t\td.totalSubNodes += f.totalSubNodes\n\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t// return array of hierarchical nodes\n\treturn hierarchies.filter(function(d){ return d.key === '' })[0].values;\n}\n\nParseMatrixData.calculateNetwork = (nodes) => {\n\t// create the array of edges\n\tvar edges = []\n\t// base edges on works co-occurrences of places\n\td3.nest()\n\t\t.key(function(d) { return d.source })\n\t\t.entries(nodes)\n\t\t.forEach((d) => {\n\t\t\td.values.filter(function(e) {\n\t\t\t\treturn e.part_of !== '';\n\t\t\t}).forEach((n, i) => {\n\t\t\t\tvar obj = {}\n\t\t\t\tobj = {\n\t\t\t\t\t'source': n.id,\n\t\t\t\t\t'target': n.part_of,\n\t\t\t\t\t'volume': d.key,\n\t\t\t\t\t// 'year': n.year,\n\t\t\t\t\t'source_part_of': n.part_of,\n\t\t\t\t\t'kind': 'part_of'\n\t\t\t\t}\n\t\t\t\tedges.push(obj);\n\t\t\t})\n\t\t})\n\treturn { 'nodes': nodes, 'edges': edges, 'root_nodes': nodes.filter(d => d.subNodes)}\n}\n\nexport default ParseMatrixData\n","import React, { Component } from 'react';\nimport './PlacesMatrix.css'\nimport V from './matrix.d3'\n\nclass PlacesMatrix extends Component {\n  componentDidMount() {\n    this._chart = V.initialize(\n        this._rootNode,\n        this.props.data,\n        this.props.filters,\n        this.props.originalData\n    );\n  }\n\n  componentDidUpdate() {\n    V.update(\n       null,\n       this.props.filters\n    );\n  }\n\n  componentWillUnmount() {\n    V.destroy(this._rootNode);\n  }\n\n  _setRef(componentNode) {\n      this._rootNode = componentNode;\n  }\n\n\n  render() {\n    const style={\n      width: '100%',\n      height: '100%'\n    }\n    return <svg id={this.props.id} style={style} ref={this._setRef.bind(this)}></svg>\n  }\n}\n\nexport default PlacesMatrix;\n","import React, { Component } from 'react';\nimport HeaderViz from '../general/HeaderViz'\nimport BodyViz from '../general/BodyViz';\nimport MainMenu from '../general/MainMenu';\nimport * as d3 from 'd3';\n\nimport Loading from '../general/Loading';\n\nimport SetOption from '../general/SetOption'\nimport TimeFilter from '../visualizations/TimeFilter'\nimport MultipleSelection from '../general/MultipleSelection'\nimport FilterSearch from '../general/FilterSearch'\n\nimport MoreInfo from '../general/MoreInfo';\n\nimport PlacesMatrix from '../visualizations/PlacesMatrix';\nimport ParseMatrixData from './parse-matrix-data'\nclass PlacesMatrixView extends Component {\n\n  constructor(props){\n    super(props);\n    this.loadData = this.loadData.bind(this);\n    this.state = {\n      data:'data still not loaded',\n      isLoading: true,\n      openAll: false,\n      filters: {\n        search: []\n      }\n    };\n    this.openAll = this.openAll.bind(this);\n    this.changeSpan = this.changeSpan.bind(this);\n    this.changePublications = this.changePublications.bind(this);\n    this.changeThemes = this.changeThemes.bind(this);\n    this.searchRecord = this.searchRecord.bind(this);\n    this.resetSearch = this.resetSearch.bind(this);\n  }\n\n  loadData() {\n    d3.tsv('./places-matrix-data.tsv')\n      .then( data => {\n        const graph = ParseMatrixData.parser(data);\n        return graph;\n      })\n      .then(data=>{\n        this.setState({\n          data: data.graph,\n          originalData: data.data,\n          dataTimeFilter: d3.extent(data.graph.nodes, d => d.year),\n          themes: [\"fabbrica\",\"guerra\",\"mare\",\"metropoli\",\"natura ligure\",\"paesaggio urbano\",\"protagonista bambino\",\"viaggio\",\"paesaggio cosmico\",\"mito\", 'nessuno'],\n          publicationsTypes: ['raccolta','volume','altro'],\n          searchOptions: [\n            { label: 'luogo', dimension: 'label'},\n            { label: 'raccolta', dimension: 'pubVenueTitle'},\n            { label: 'titolo', dimension:'sourceTitle'}\n          ],\n          isLoading: false,\n          filters: {\n            update: true,\n            openAll: false,\n            selectedThemes: [\"fabbrica\",\"guerra\",\"mare\",\"metropoli\",\"natura ligure\",\"paesaggio urbano\",\"protagonista bambino\",\"viaggio\",\"paesaggio cosmico\",\"mito\", 'nessuno'],\n            selectedPublications: ['raccolta','volume','altro'],\n            search: []\n          }\n        })\n      })\n  }\n\n  componentDidMount() {\n    this.loadData();\n  }\n\n  changeSpan(newSpan) {\n    this.setState(prevState => ({\n      span: newSpan,\n      filters: {                    // object that we want to update\n        ...prevState.filters,       // keep all other key-value pairs\n        timeFilter:newSpan,         // update the value of specific key\n        update: true                // update the value of specific key\n      }\n    }))\n  }\n\n  changePublications(newPublications) {\n    this.setState(prevState => ({\n      filters: {                    // object that we want to update\n        ...prevState.filters,       // keep all other key-value pairs\n        selectedPublications: newPublications,  // update the value of specific key\n        update: false\n      }\n    }))\n  }\n\n  changeThemes(newThemes) {\n    this.setState(prevState => ({\n      filters: {                    // object that we want to update\n        ...prevState.filters,       // keep all other key-value pairs\n        selectedThemes: newThemes,  // update the value of specific key\n        update: false\n      }\n    }))\n  }\n\n  searchRecord(searchResults) {\n    this.setState(prevState => ({\n      filters: {                    // object that we want to update\n        ...prevState.filters,       // keep all other key-value pairs\n        search: searchResults,  // update the value of specific key\n        update: false\n      }\n    }))\n  }\n\n  resetSearch() {\n    this.setState(prevState => ({\n      filters: {                    // object that we want to update\n        ...prevState.filters,       // keep all other key-value pairs\n        search: [],\n        update: false\n      }\n    }))\n  }\n\n  openAll(value) {\n    this.setState(prevState => ({\n      filters: {                    // object that we want to update\n        ...prevState.filters,       // keep all other key-value pairs\n        openAll: value,\n        update: true\n      }\n    }))\n  }\n\n  render() {\n    // console.log('filters',this.state.filters)\n    return (\n      <div>\n        <HeaderViz>\n          <MainMenu style={{gridColumn: 'span 1'}}/>\n\n          { this.state.isLoading && <Loading style={{gridColumn: 'span 2'}} /> }\n          { !this.state.isLoading && <SetOption style={{gridColumn: 'span 2'}} selected={this.openAll} title=\"Apri tutto\"/> }\n\n          { this.state.isLoading && <Loading style={{gridColumn: 'span 6'}} /> }\n          { !this.state.isLoading && <TimeFilter style={{gridColumn: 'span 6'}} data={this.state.dataTimeFilter} changeSpan={this.changeSpan} title=\"Imposta un filtro temporale\"/> }\n\n          { this.state.isLoading && <Loading style={{gridColumn: 'span 4'}} /> }\n          { !this.state.isLoading && <MultipleSelection style={{gridColumn: 'span 4'}} options={this.state.publicationsTypes} changeOptions={this.changePublications} title=\"Tipo di pubblicazione\" id=\"multiple-selection-publications\"/> }\n\n          { this.state.isLoading && <Loading style={{gridColumn: 'span 4'}} /> }\n          { !this.state.isLoading && <MultipleSelection style={{gridColumn: 'span 4'}} options={this.state.themes} changeOptions={this.changeThemes} title=\"Evidenzia un tema\" id=\"multiple-selection-themes\"/> }\n\n          { this.state.isLoading && <Loading style={{gridColumn: 'span 6'}} /> }\n          { !this.state.isLoading && <FilterSearch style={{gridColumn: 'span 6'}} data={this.state.data} originalData={this.state.originalData} options={this.state.searchOptions} searchRecord={this.searchRecord} search={this.state.filters.search} resetSearch={this.resetSearch} minLength={1} title=\"Cerca\"/> }\n\n          { this.state.isLoading && <Loading style={{gridColumn: 'span 1'}} /> }\n          { !this.state.isLoading && <MoreInfo style={{gridColumn: 'span 1'}}></MoreInfo>}\n\n        </HeaderViz>\n\n        <BodyViz className=\"the-body-viz\">\n          { this.state.isLoading && <Loading /> }\n          { !this.state.isLoading && <PlacesMatrix data={this.state.data} originalData={this.state.originalData} filters={this.state.filters} /> }\n        </BodyViz>\n      </div>\n    );\n  }\n}\n\nexport default PlacesMatrixView;\n","import React from 'react';\nimport './App.css';\nimport PlacesMatrixView from './PlacesMatrixView/PlacesMatrixView';\n// import ContainerComp from './ContainerComp/ContainerComp';\n\nfunction App() {\n  return (\n      <PlacesMatrixView />\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}