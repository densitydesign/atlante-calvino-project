(window["webpackJsonpatlante-calvino-project"]=window["webpackJsonpatlante-calvino-project"]||[]).push([[0],{19:function(e,t,n){e.exports=n(39)},24:function(e,t,n){},25:function(e,t,n){},26:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},37:function(e,t,n){},38:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(16),o=n.n(i),s=(n(24),n(25),n(12)),c=n(4),l=n(5),u=n(7),d=n(6),f=n(2),p=n(8),h=(n(26),function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:this.props.className},this.props.children)}}]),t}(r.Component)),m=n(10),g=n(13),b=(n(32),function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"main-menu",style:this.props.style},a.a.createElement(m.a,{icon:g.a}))}}]),t}(r.Component)),y=n(1),v=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{style:this.props.style},"Loading ...")}}]),t}(r.Component),O=(n(33),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleChange=n.handleChange.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){var t=e.target.checked;this.props.selected(t)}},{key:"render",value:function(){return a.a.createElement("div",{className:"set-option",style:this.props.style},a.a.createElement("h5",null,this.props.title),a.a.createElement("label",{className:"switch"},a.a.createElement("input",{type:"checkbox",onChange:this.handleChange}),a.a.createElement("span",{className:"slider round"})))}}]),t}(r.Component)),k=O;O.defaultProps={title:"Option"};n(34);var x={initialize:function(e,t,n){x.changeSpan=n;x.margin={top:0,right:15,bottom:e.getBoundingClientRect().height-20,left:15},x.svg=y.t(e),x.width=e.getBoundingClientRect().width-x.margin.left-x.margin.right,x.height=e.getBoundingClientRect().height-x.margin.top-x.margin.bottom,x.svg.append("defs").append("clipPath").attr("id","timeclip").append("rect").classed("clip",!0).attr("x",0).attr("y",x.margin.top).attr("width",x.width+x.margin.left+x.margin.right).attr("height",x.height).attr("transform","translate("+-x.margin.left+","+-x.margin.top+")"),x.x=y.s().range([0,x.width]).domain(y.f(t,(function(e){return e}))),x.xAxis=y.a(x.x),x.brush=y.c().extent([[0,0],[x.width,x.height]]).handleSize(30).on("brush end",E),x.context=x.svg.append("g").attr("class","context").attr("transform","translate("+x.margin.left+","+x.margin.top+")"),x.info=x.context.append("g").selectAll(".info"),x.line=x.context.append("g").selectAll(".info-line"),x.dotted=x.context.append("g").selectAll(".dotted"),x.context.append("line").attr("x1",0).attr("y1",x.height/2).attr("x2",x.width).attr("y2",x.height/2).attr("stroke","var(--dark-green)"),x.context.append("g").attr("class","brush").call(x.brush).call(x.brush.move,x.x.range())},update:function(e){x.info=x.info.data(e,(function(e){return e})),x.info.exit().remove(),x.info=x.info.enter().append("text").attr("class","info").attr("x",(function(e){return x.x(e)})).attr("y",x.height+x.margin.top+12).attr("text-anchor",(function(e,t){return function(e,n,r){return t%2===0?n(e)>=r/4?"end":"start":n(e)<=r/4*3?"start":"end"}(e,x.x,x.width)})).text((function(e){return e.getFullYear()})).merge(x.info),x.line=x.line.data(e,(function(e){return e})),x.line.exit().remove(),x.line=x.line.enter().append("line").attr("class","info-line").attr("stroke","var(--calvino-red)").attr("stroke-width","2px").attr("x1",(function(e){return x.x(e)})).attr("y1",0).attr("x2",(function(e){return x.x(e)})).attr("y2",x.height).merge(x.line),x.dotted=x.dotted.data([e],(function(e,t){return e})),x.dotted.exit().remove(),x.dotted=x.dotted.enter().append("line").attr("class","dotted").attr("x1",x.info._groups[0][0].getBBox().x+x.info._groups[0][0].getBBox().width+5).attr("x2",x.info._groups[0][1].getBBox().x-5).attr("y1",x.height+x.margin.top+6).attr("y2",x.height+x.margin.top+6).attr("stroke-width","1.5px").attr("stroke","var(--dark-green)").attr("stroke-linecap","round").attr("stroke-dasharray","0,15").merge(x.dotted)},destroy:function(e){}},j=x;function E(){if((!y.e.sourceEvent||"zoom"!==y.e.sourceEvent.type)&&y.e.selection){var e=y.e.selection||x.x.range();e=e.map((function(e){return x.x.invert(e)})),"end"===y.e.type&&(console.log("filtered by time"),x.changeSpan(e)),e=e.map((function(e){return new Date(e)})),x.update(e)}}var S=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).changeSpan=n.changeSpan.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"changeSpan",value:function(e){this.props.changeSpan(e)}},{key:"componentDidMount",value:function(){this._chart=j.initialize(this._rootNode,this.props.data,this.changeSpan)}},{key:"componentDidUpdate",value:function(){}},{key:"componentWillUnmount",value:function(){j.destroy(this._rootNode)}},{key:"_setRef",value:function(e){this._rootNode=e}},{key:"render",value:function(){return a.a.createElement("div",{style:this.props.style},a.a.createElement("h5",null,this.props.title),a.a.createElement("svg",{id:"time-filter",ref:this._setRef.bind(this)}))}}]),t}(r.Component),N=S;S.defaultProps={title:"Time Filter"};n(35);var w=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleChange=n.handleChange.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(){var e=document.getElementById(this.props.id).getElementsByTagName("input");e=(e=(e=(e=Array.from(e)).map((function(e){return{name:e.name,status:e.checked}}))).filter((function(e){return e.status}))).map((function(e){return e.name})),this.props.changeOptions(e)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{style:this.props.style},a.a.createElement("h5",null,this.props.title),a.a.createElement("ul",{id:this.props.id,className:"multiple-selection-menu"},this.props.options.map((function(t,n){return a.a.createElement("li",{key:n},a.a.createElement("input",{type:"checkbox",name:t,onChange:e.handleChange,defaultChecked:!0}),t)}))))}}]),t}(r.Component),C=w;w.defaultProps={title:"Select an option"};var _=n(9),A=n.n(_),T=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleChange=n.handleChange.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"handleChange",value:function(e){this.props.changeOption(e.target.value)}},{key:"render",value:function(){return a.a.createElement("select",{style:this.props.style,onChange:this.handleChange},this.props.options.map((function(e,t){return a.a.createElement("option",{key:t},e)})))}}]),t}(r.Component),L=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).debounceTyping=A.a.debounce((function(e){n.props.searching(e)}),250),n.handleTyping=n.handleTyping.bind(Object(f.a)(n)),n.selectResult=n.selectResult.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"handleTyping",value:function(e){e.target.value.length>=this.props.minLength&&this.debounceTyping(e.target.value)}},{key:"selectResult",value:function(e){document.getElementsByClassName("filter-search")[0].getElementsByTagName("input")[0].value=e.target.innerHTML;this.props.selectResult(e.target.getAttribute("data-attr"))}},{key:"render",value:function(){var e=this,t={backgroundColor:"peachpuff"};return a.a.createElement("div",{style:this.props.style},a.a.createElement("input",{type:"text",name:"fname",placeholder:"Inserisci un nome",onChange:this.handleTyping}),a.a.createElement("ul",{style:{position:"absolute"}},this.props.previewSearch.slice(0,8).map((function(n,r){return a.a.createElement("li",{style:t,key:r,onClick:e.selectResult,"data-attr":n.values},n.key)}))))}}]),t}(r.Component),D=function(e){function t(e){var n;Object(c.a)(this,t);var r=(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).props.originalData.map((function(e){return e.pubVenueTitle.split(";")}));r=A.a.flattenDeep(r),r=y.m().key((function(e){return e})).entries(r).map((function(e){return e.key}));var a=[];return r.forEach((function(e){var t=n.props.originalData.filter((function(t){return t.pubVenueTitle.includes(e)})),r={key:e,values:t.map((function(e){return e.id}))};a.push(r)})),n.state={option:n.props.options[0],previewSearch:[],publicationsTitles:r,nodesByPublicationTitle:a},n.handleSearch=n.handleSearch.bind(Object(f.a)(n)),n.changeOption=n.changeOption.bind(Object(f.a)(n)),n.searching=n.searching.bind(Object(f.a)(n)),n.selectResult=n.selectResult.bind(Object(f.a)(n)),n.resetSearch=n.resetSearch.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"handleSearch",value:function(e){this.props.searchRecord(e)}},{key:"changeOption",value:function(e){var t=this.props.options.filter((function(t){return t.label===e}))[0];this.setState({option:t})}},{key:"searching",value:function(e){var t=this,n=[];(n="raccolta"===this.state.option.label?this.state.nodesByPublicationTitle.filter((function(t){return t.key.toLowerCase().includes(e.toLowerCase())})):y.m().key((function(e){return e[t.state.option.dimension]})).entries(this.props.originalData).map((function(e){return{key:e.key,values:e.values.map((function(e){return e.id}))}})).filter((function(t){return t.key.toLowerCase().includes(e.toLowerCase())}))).length&&this.setState({previewSearch:n})}},{key:"selectResult",value:function(e){this.setState({previewSearch:[]}),this.props.searchRecord(e.split(","))}},{key:"resetSearch",value:function(){this.props.resetSearch()}},{key:"render",value:function(){return a.a.createElement("div",{className:"filter-search",style:this.props.style},a.a.createElement("h5",null,this.props.title),a.a.createElement(T,{style:{display:"inline-block"},options:this.props.options.map((function(e){return e.label})),changeOption:this.changeOption}),a.a.createElement(L,{style:{display:"inline-block"},searching:this.searching,previewSearch:this.state.previewSearch,selectResult:this.selectResult,minLength:this.props.minLength}),this.props.search&&this.props.search.length>0&&a.a.createElement("span",{onClick:this.resetSearch},a.a.createElement(m.a,{icon:g.b})))}}]),t}(r.Component),P=D;D.defaultProps={title:"Search for a Record"};n(37);var R=n(17),z=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"more-info"},a.a.createElement(m.a,{icon:R.a}))}}]),t}(r.Component),B=(n(38),{parser:function(e){e.forEach((function(e){e.year=new Date(e.year)}));var t=e.map((function(e){return e.year=new Date(e.year),e.id||(e.id=e["data.id"]),{id:e.id,label:e.Occorrenza,part_of:e["Parte di ID"],source:e.Fonte,sourceTitle:e["Titolo Fonte"],year:+e.year,category:e.Categoria,totalSubNodes:0,publicationType:e["Pubblicazione Fonte"].split(";"),pubVenueTitle:e["Pubblicazioni Titoli"],isGuessed:e["Luogo desunto"],themes:e.Tema.split(";")}})),n=B.handleHierarchies(t);return{graph:B.calculateNetwork(n),data:t}},handleHierarchies:function(e){var t=y.m().key((function(e){return e.part_of})).entries(e);return t.filter((function(e){return""===e.key}))[0].values.forEach((function(e){var n=t.find((function(t){return t.key===e.id}));n&&(e.subNodes=n.values,e.totalSubNodes=n.values.length,n.values.forEach((function(n){var r=t.find((function(e){return e.key===n.id}));r&&(n.subNodes=r.values,n.totalSubNodes=r.values.length,e.totalSubNodes+=n.totalSubNodes,r.values.forEach((function(n){var r=t.find((function(e){return e.key===n.id}));r&&(n.subNodes=r.values,n.totalSubNodes=r.values.length,e.totalSubNodes+=n.totalSubNodes,r.values.forEach((function(r){var a=t.find((function(e){return e.key===r.id}));a&&(r.subNodes=a.values,r.totalSubNodes=a.values.length,e.totalSubNodes+=n.totalSubNodes)})))})))})))})),t.filter((function(e){return""===e.key}))[0].values},calculateNetwork:function(e){var t=[];return y.m().key((function(e){return e.source})).entries(e).forEach((function(e){e.values.filter((function(e){return""!==e.part_of})).forEach((function(n,r){var a;a={source:n.id,target:n.part_of,volume:e.key,source_part_of:n.part_of,kind:"part_of"},t.push(a)}))})),{nodes:e,edges:t,root_nodes:e.filter((function(e){return e.subNodes}))}}}),U=B;function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var M,Y,I,W,V,H,q,G,J,X,$,K,Q,Z,ee,te,ne,re,ae,ie,oe,se,ce,le=["generico_non_terrestre","nominato_non_terrestre","nominato_terrestre","generico_terrestre","inventato","no_ambientazione"],ue=["#3131ff","#bbbbff","#ffce00","#ff6c39","#00c19c","#cecece"],de=[],fe=[],pe=[],he=0,me=0,ge=50,be=30,ye=50,ve={},Oe=ve;ve.initialize=function(e,t,n){K=y.t(e).style("touch-action","manipulation"),G=K.node().getBoundingClientRect().width-ye-ge,J=K.node().getBoundingClientRect().height-me-be,K.append("rect").attr("width",G+ye+ge).attr("height",J+me+be).classed("reset-rect",!0).on("click",(function(e){y.e.timeStamp-he<500&&(console.log("reset"),Ae()),he=y.e.timeStamp})),I=y.s().range([0,G]).domain(n.span),X=y.a(I).ticks(y.w.every(1)),W=y.q().range([0,J]).domain(le).padding(.5),$=y.b(W).tickSize(G).tickFormat((function(e){return e.replace(/_/g," ")})),V=y.r().exponent(.5).range([3,25]).domain([1,y.l(t.nodes,(function(e){return e.totalSubNodes}))]),H=y.p().domain(le).range(ue),Q=K.append("g").attr("transform","translate(".concat(ye,",").concat(me,")")),ee=Q.append("g").attr("class","x-axis"),te=Q.append("g").attr("class","y-axis"),Z=Q.append("g"),ee.attr("transform","translate(".concat(0,", ",J,")")).call(X),te.attr("transform","translate(0, 0)").call($).call((function(e){return e.selectAll(".tick text").style("text-transform","capitalize")})).call((function(e){return e.select(".domain").remove()})).call((function(e){return e.selectAll(".tick line").attr("stroke-opacity",.5).attr("stroke-dasharray","2,2")})).call((function(e){return e.selectAll(".tick text").attr("x",4).attr("dy",-W.step()/10)})),te.selectAll(".tick").on("click",(function(e){if(!1===y.t(this).classed("cat-selected")){y.u(".tick.cat-selected").size()>0&&(de.filter((function(e){return""===e.part_of})).forEach((function(e){xe(e,!1)})),y.u(".tick").classed("cat-selected",!1).select("rect").attr("fill","transparent"));var t=[];de.forEach((function(n){n.totalSubNodes>0&&(n.subNodes.map((function(e){return e.category})).indexOf(e)>-1&&t.push(n),n.subNodes.forEach((function(r){r.totalSubNodes>0&&(r.subNodes.map((function(e){return e.category})).indexOf(e)>-1&&(t.push(n),t.push(r)),r.subNodes.forEach((function(a){a.totalSubNodes>0&&a.subNodes.map((function(e){return e.category})).indexOf(e)>-1&&(t.push(n),t.push(r),t.push(a))})))})))})),t.forEach((function(e){ke(e,!1)})),y.t(this).select("rect").attr("fill",(function(e){return H(e)}))}else{var n=[];de.forEach((function(t){t.totalSubNodes>0&&(t.subNodes.map((function(e){return e.category})).indexOf(e)>-1&&n.push(t),t.subNodes.forEach((function(r){r.totalSubNodes>0&&(r.subNodes.map((function(e){return e.category})).indexOf(e)>-1&&(n.push(t),n.push(r)),r.subNodes.forEach((function(a){a.totalSubNodes>0&&a.subNodes.map((function(e){return e.category})).indexOf(e)>-1&&(n.push(t),n.push(r),n.push(a))})))})))})),n.forEach((function(e){xe(e,!1)})),y.t(this).select("rect").attr("fill","transparent")}ve.update(Y),!1===y.t(this).classed("cat-selected")?ae.filter((function(t){return t.category===e})).each((function(e){return we(e)})):ae.each((function(e){return Ce(e)})),y.t(this).classed("cat-selected",!y.t(this).classed("cat-selected"))})).append("rect").attr("width","14px").attr("height","14px").attr("x",-14).attr("y",-22).attr("rx",2).attr("fill","transparent").attr("stroke",(function(e){return H(e)})),re=Z.append("g").classed("links",!0).selectAll(".link"),ne=Z.append("g").classed("hulls",!0).selectAll(".hull"),ae=Z.append("g").classed("nodes",!0).selectAll(".node"),ie=Z.append("g").classed("presumed",!0).selectAll(".presumed"),oe=Z.append("g").classed("labels",!0).selectAll(".label"),se=Q.append("g").classed("informations",!0).selectAll(".information"),ce=y.i(de).force("collision",y.g((function(e){var t=e.totalSubNodes>0?2.25:.25;return e.opened?V(1)+t:V(e.totalSubNodes+1)+t})).strength(.3).iterations(12)).force("link",y.h().strength(.45).distance(V.range()[0]).id((function(e){return e.id}))).force("x",y.j((function(e){return I(e.year)}))).force("y",y.k((function(e){return W(e.category)})).strength((function(e){return""===e.part_of?.1:0}))).on("tick",(function(){ae.attr("cx",(function(e,t){return e.x})).attr("cy",(function(e){return e.y})),ie.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y})),oe.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})),re.attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return e.target.y})),ne.attr("d",(function(e){var t=e.map((function(e){return[e.x,e.y]})),n=t.length<3?t:y.n(t);return ze(n,e)}))})).on("end",(function(){console.log("simulation ended")})).stop();var r=y.y().translateExtent([[0,0],[G+ye+ge,J+me+be]]).scaleExtent([1,10]).on("zoom",(function(){Z.attr("transform",y.e.transform),te.attr("transform",y.e.transform);var e=y.e.transform.rescaleX(I);ee.call(X.scale(e)),q||(q=y.t(".label").style("font-size"),q=parseFloat(q));var t=q/y.e.transform.k;y.t("g.labels").style("font-size",t+"px"),y.e.transform.k>3?y.u(".node.selected").each((function(e){oe.filter((function(t){return t.id===e.id})).classed("zoom-selected",!0)})):oe.classed("zoom-selected",!1);se.attr("x",(function(t){return e(t.year)>=G/2?e(t.year)+4.8:e(t.year)-3.2}))}));K.call(r).on("dblclick.zoom",null),Y=n,(M=t).nodes=M.nodes.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(n,!0).forEach((function(t){Object(s.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{x:I(e.year),y:W(e.category)})}))},ve.update=function(e){e&&(Y=e),de=M.nodes,fe=M.edges,de.forEach((function(e){e.fx?e.correspondingYear=I.invert(e.fx):delete e.correspondingYear})),I.domain(Y.span),ee.call(X),de.forEach((function(e){e.correspondingYear&&(e.fx=I(e.correspondingYear))})),(ae=ae.data(de,(function(e){return e.id}))).exit().remove(),ae=ae.enter().append("circle").attr("class",(function(e){return"node"})).classed("sub-node",(function(e){return""!==e.part_of})).attr("key",(function(e){return e.id})).on("mouseenter",(function(e){oe.filter((function(t){return t.id===e.id})).style("display","block"),ae.style("opacity",.25).filter((function(t){return t.source===e.source})).style("opacity",1)})).on("mouseleave",(function(e){oe.filter((function(t){return t.id===e.id})).style("display","none"),ae.style("opacity","")})).on("click",(function(e){y.e.timeStamp-he<500&&je(e,"restart the force"),he=y.e.timeStamp,Se(e),_e(e),Ee([e])})).merge(ae).style("cursor",(function(e){return e.subNodes&&e.subNodes.length?"pointer":"auto"})).attr("fill",(function(e){return!0===e.opened?"white":H(e.category)})).attr("stroke",(function(e){if(e.totalSubNodes>0)return y.d(H(e.category)).darker(1)})).attr("r",(function(e){return e.opened?V(1):V(e.totalSubNodes+1)})),(ie=ie.data(de.filter((function(e){return e.isGuessed})),(function(e){return e.id}))).exit().remove(),ie=ie.enter().append("circle").classed("presumed",!0).attr("r",1.5).attr("fill",(function(e){return y.d(H(e.category)).darker(1)})).merge(ie),(re=re.data(fe,(function(e){return e.source.id+"-"+e.target.id}))).exit().remove(),re=re.enter().append("line").classed("link",!0).classed("part-of",(function(e){return"part_of"===e.kind})).attr("stroke-width",.5).attr("stroke","#ccc").merge(re),(oe=oe.data(de,(function(e){return e.id}))).exit().remove(),oe=oe.enter().append("text").classed("label",!0).style("display","none").attr("text-anchor","middle").style("pointer-events","none").text((function(e){return e.label})).merge(oe),(ne=ne.data(pe,(function(e){return e[0].id}))).exit().remove(),ne=ne.enter().append("path").classed("hull",!0).attr("fill",(function(e){return H(e[0].category)})).style("opacity",.25).merge(ne),ce.nodes(de),ce.force("link")&&ce.force("link").links(fe),ce.alpha(1).restart()},ve.filter=function(e,t){Y=e;var n=[];if(e.search.length){n[2]=A.a.clone(e.search,!0);var r=[];e.search.forEach((function(e){!function e(n){var a=t.filter((function(e){return e.id===n}))[0];""!==a.part_of&&(r.push(a.part_of),e(a.part_of))}(e)})),r.length>0&&(r.reverse().forEach((function(e,r){var a=t.filter((function(t){return t.id===e}))[0].id;n[2].push(a);var i=de.filter((function(e){return e.id===a}))[0];ke(i,"do not restart the force")})),ve.update(e),e.search.forEach((function(e){Se({id:e})})))}var a=e.kinds;n[0]=de.filter((function(e){return a.map((function(t){return e.publicationType.indexOf(t)>-1})).indexOf(!0)>-1})).map((function(e){return e.id}));var i=e.themes;n[1]=de.filter((function(e){return i.map((function(t){return e.themes.indexOf(t)>-1})).indexOf(!0)>-1})).map((function(e){return e.id}));var o=[];n.forEach((function(e,t){o=0===t?e:A.a.intersection(o,n[t])})),Ae(),o.forEach((function(e){var t=de.filter((function(t){return t.id===e}));t.length>0&&we(t[0])}))},ve.openAll=function(){!function e(t){t.forEach((function(t){t.totalSubNodes>0&&(ke(t,"do not restart simulation"),e(t.subNodes))}))}(de)},ve.closeAll=function(){de.filter((function(e){return""===e.part_of})).forEach((function(e){xe(e,"do not restart simulation")}))},ve.destroy=function(){};var ke=function(e,t){if(!e.opened){e.opened=!0,""===e.part_of?(e.fx=e.x,e.fy=e.y):(e.x=de.filter((function(t){return t.id===e.part_of}))[0].x,e.fy=de.filter((function(t){return t.id===e.part_of}))[0].y+2*V.range()[0]*3),e.subNodes.forEach((function(t){t.x=e.x,t.y=e.y}));var n=[e].concat(e.subNodes);pe.push(n),pe.forEach((function(e){e.indexOf(n[0])>0&&n.forEach((function(t,n){0!==n&&e.push(t)}))}));var r=de.concat(e.subNodes);M=U.calculateNetwork(r),de=M.nodes,fe=M.edges,"restart the force"===t&&ve.update()}},xe=function(e,t){if(e.opened&&0!==e.totalSubNodes){e.opened=!1,delete e.fx,delete e.fy;var n=[],r=[e.id];!function e(t){t.subNodes.forEach((function(t){t.opened&&(t.opened=!1,r.push(t.id),e(t))})),n.push(t.subNodes)}(e),n.forEach((function(e){var t=e.map((function(e){return e.id})),n=de.filter((function(e){return!t.includes(e.id)}));(pe=pe.filter((function(e){return!r.includes(e[0].id)}))).forEach((function(e,n){pe[n]=e.filter((function(e){return!t.includes(e.id)}))})),M=U.calculateNetwork(n),de=M.nodes,fe=M.edges})),"restart the force"===t&&ve.update()}},je=function(e,t){e.opened?(Ne(e),xe(e,t)):e.subNodes&&e.subNodes.length?(Se(e),ke(e,t)):console.log("No nodes to expand")},Ee=function(e){(se=se.data(e,(function(e){return e.id}))).exit().remove(),se=se.enter().append("text").classed("information",!0).attr("text-anchor",(function(e){return I(e.year)>=G/2?"end":"start"})).attr("x",(function(e){return I(e.year)>=G/2?I(e.year)+4.8:I(e.year)-3.2})).attr("y",J-10).text((function(e){return I(e.year)>=G/2?e.sourceTitle+" \u2193":"\u2193 "+e.sourceTitle})).merge(se)},Se=function(e){oe.filter((function(t){return t.id===e.id})).classed("selected",!0)},Ne=function(e){oe.filter((function(t){return t.id===e.id})).classed("selected",!1)},we=function(e){K.classed("there-is-selection",!0),ae.filter((function(t){return t.id===e.id})).classed("selected",!0)},Ce=function(e){ae.filter((function(t){return t.id===e.id})).classed("selected",!1),0===K.selectAll(".selected").size()&&K.classed("there-is-selection",!1)},_e=function(e){K.classed("there-is-selection",!0),ae.filter((function(t){return t.source===e.source})).classed("selected",!0)},Ae=function(){K.selectAll("*").classed("selected",!1).classed("zoom-selected",!1),K.selectAll(".tick").classed("cat-selected",!1).selectAll("rect").attr("fill","transparent"),K.classed("there-is-selection",!1),Ee([])},Te=function(){var e=K.selectAll(".selected").data();e=y.m().key((function(e){return e.source})).entries(e).map((function(e){return{composition_id:e.key,composition_title:e.values[0].sourceTitle}}));var t="";0===Y.themes.length?t="\ud83d\udc40 No environments selected\n":(7===Y.themes.length?t+="(\ud83d\udc16 All environments)\n":t+="\n",Y.themes.forEach((function(e){t+='- "'.concat(e,'"\n')})));var n="";0==Y.kinds.length?n="\ud83d\udc40 No venues selected\n":(3===Y.kinds.length?n+="(\ud83d\udc16 All venues)\n":t+="\n",Y.kinds.forEach((function(e){n+='- "'.concat(e,'"\n')})));var r="- No search";""!==y.t(".filter-search input").property("value")&&(r=y.t(".filter-search input").property("value"));var a="Exporting composition titles highlighted through the following filters:\n\n\ud83d\udcda Publication venues ".concat(n,"\n\n\ud83c\udfde Environments ").concat(t,"\n\n\ud83d\udd75\ufe0f\u200d\u2640\ufe0f Searched term:\n").concat(r,"\n\ncomposition_id\tcomposition_title\n").concat(e.map((function(e){return e.composition_id+"\t"+e.composition_title})).join("\n"),"\n"),i=new Date;i=y.v("%Y_%m_%d %X")(i),function(e,t,n){console.log("download");var r=new Blob([e],{type:n});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(r,t);else{var a=document.createElement("a"),i=URL.createObjectURL(r);a.href=i,a.download=t,document.body.appendChild(a),a.click(),setTimeout((function(){document.body.removeChild(a),window.URL.revokeObjectURL(i)}),0)}}(a,"selection [".concat(i,"].txt"),"text/plain")};document.addEventListener("keydown",(function(e){"d"===e.key&&Te()}));var Le=.25,De=function(e,t){return[e*t[0],e*t[1]]},Pe=function(e,t){return[e[0]+t[0],e[1]+t[1]]},Re=function(e,t){var n=[e[1]-t[1],t[0]-e[0]],r=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return[n[0]/r,n[1]/r]},ze=function(e,t){if(Le=y.l(t,(function(e){return e.opened?V(1)+.25:V(e.totalSubNodes+1)+.25})),!e||e.length<1)return"";if(1===e.length)return Be(e,t);if(2===e.length)return Ue(e,t);for(var n=new Array(e.length),r=0;r<n.length;++r){var a=0===r?e[e.length-1]:e[r-1],i=e[r],o=De(Le,Re(a,i));n[r]=[Pe(a,o),Pe(i,o)]}var s="A "+[Le,Le,"0,0,0,"].join(",");return(n=n.map((function(e,t){var r="";if(0===t)r="M "+n[n.length-1][1]+" ";return r+=s+e[0]+" L "+e[1]}))).join(" ")},Be=function(e,t){var n=[e[0][0],e[0][1]-Le],r=[e[0][0],e[0][1]+Le];return"M "+n+" A "+[Le,Le,"0,0,0",r].join(",")+" A "+[Le,Le,"0,0,0",n].join(",")},Ue=function(e,t){var n=De(Le,Re(e[0],e[1])),r=De(-1,n),a=Pe(e[0],n),i=Pe(e[1],n),o=Pe(e[1],r),s=Pe(e[0],r);return"M "+a+" L "+i+" A "+[Le,Le,"0,0,0",o].join(",")+" L "+s+" A "+[Le,Le,"0,0,0",a].join(",")},Fe=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){console.log("componentDidMount"),this._chart=Oe.initialize(this._rootNode,this.props.data,this.props.filters)}},{key:"componentDidUpdate",value:function(e,t){console.log("componentDidUpdate"),this.props.filters.openAll!==e.filters.openAll&&(this.props.filters.openAll?Oe.openAll():Oe.closeAll()),this.props.filters.update&&Oe.update(this.props.filters),Oe.filter(this.props.filters,this.props.originalData)}},{key:"componentWillUnmount",value:function(){console.log("componentWillUnmount"),Oe.destroy(this._rootNode)}},{key:"_setRef",value:function(e){this._rootNode=e}},{key:"render",value:function(){return a.a.createElement("svg",{id:this.props.id,style:{width:"100%",height:"100%"},ref:this._setRef.bind(this)})}}]),t}(r.Component);function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(n,!0).forEach((function(t){Object(s.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ie=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,e))).loadData=n.loadData.bind(Object(f.a)(n)),n.state={data:"data still not loaded",isLoading:!0},n.openAll=n.openAll.bind(Object(f.a)(n)),n.changeSpan=n.changeSpan.bind(Object(f.a)(n)),n.changePublications=n.changePublications.bind(Object(f.a)(n)),n.changeThemes=n.changeThemes.bind(Object(f.a)(n)),n.searchRecord=n.searchRecord.bind(Object(f.a)(n)),n.resetSearch=n.resetSearch.bind(Object(f.a)(n)),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"loadData",value:function(){var e=this;y.x("./places-matrix-data.tsv").then((function(e){return U.parser(e)})).then((function(t){var n=["fabbrica","guerra","mare","metropoli","natura ligure","paesaggio urbano","nessuno"],r=["raccolta","volume","altro"];e.setState({data:t.graph,originalData:t.data,dataTimeFilter:y.f(t.graph.nodes,(function(e){return e.year})),themes:n,publicationsTypes:r,searchOptions:[{label:"luogo",dimension:"label"},{label:"raccolta",dimension:"pubVenueTitle"},{label:"titolo",dimension:"sourceTitle"}],isLoading:!1,filters:{update:!0,openAll:!1,themes:n,kinds:r,search:[],span:y.f(t.graph.nodes,(function(e){return e.year}))}})}))}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"changeSpan",value:function(e){this.setState((function(t){return{filters:Ye({},t.filters,{span:e,update:!0})}}))}},{key:"changePublications",value:function(e){this.setState((function(t){return{filters:Ye({},t.filters,{kinds:e,update:!1})}}))}},{key:"changeThemes",value:function(e){this.setState((function(t){return{filters:Ye({},t.filters,{themes:e,update:!1})}}))}},{key:"searchRecord",value:function(e){this.setState((function(t){return{filters:Ye({},t.filters,{search:e,update:!1})}}))}},{key:"resetSearch",value:function(){this.setState((function(e){return{filters:Ye({},e.filters,{search:[],update:!0})}}))}},{key:"openAll",value:function(e){this.setState((function(t){return{filters:Ye({},t.filters,{openAll:e,update:!0})}}))}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("div",{className:"the-header"},a.a.createElement(b,{className:"main-menu",style:{gridColumn:"span 1"}}),this.state.isLoading&&a.a.createElement(v,{style:{gridColumn:"span 2"}}),!this.state.isLoading&&a.a.createElement(k,{style:{gridColumn:"span 2"},selected:this.openAll,title:"Apri tutto"}),this.state.isLoading&&a.a.createElement(v,{style:{gridColumn:"span 6"}}),!this.state.isLoading&&a.a.createElement(N,{style:{gridColumn:"span 6"},data:this.state.dataTimeFilter,changeSpan:this.changeSpan,title:"Imposta un filtro temporale"}),this.state.isLoading&&a.a.createElement(v,{style:{gridColumn:"span 4"}}),!this.state.isLoading&&a.a.createElement(C,{style:{gridColumn:"span 4"},options:this.state.publicationsTypes,changeOptions:this.changePublications,title:"Tipo di pubblicazione",id:"multiple-selection-publications"}),this.state.isLoading&&a.a.createElement(v,{style:{gridColumn:"span 4"}}),!this.state.isLoading&&a.a.createElement(C,{style:{gridColumn:"span 4"},options:this.state.themes,changeOptions:this.changeThemes,title:"Evidenzia un ambiente",id:"multiple-selection-themes"}),this.state.isLoading&&a.a.createElement(v,{style:{gridColumn:"span 6"}}),!this.state.isLoading&&a.a.createElement(P,{style:{gridColumn:"span 6"},data:this.state.data,originalData:this.state.originalData,options:this.state.searchOptions,searchRecord:this.searchRecord,search:this.state.filters.search,resetSearch:this.resetSearch,minLength:1,title:"Cerca"}),this.state.isLoading&&a.a.createElement(v,{style:{gridColumn:"span 1"}}),!this.state.isLoading&&a.a.createElement(z,{style:{gridColumn:"span 1"}})),a.a.createElement(h,{className:"the-body-viz"},this.state.isLoading&&a.a.createElement(v,null),!this.state.isLoading&&a.a.createElement(Fe,{data:this.state.data,originalData:this.state.originalData,filters:this.state.filters})))}}]),t}(r.Component);var We=function(){return a.a.createElement(Ie,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(We,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[19,1,2]]]);
//# sourceMappingURL=main.1bc4b686.chunk.js.map