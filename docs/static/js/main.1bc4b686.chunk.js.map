{"version":3,"sources":["general/BodyViz/BodyViz.js","general/MainMenu/MainMenu.js","general/Loading/Loading.js","general/SetOption/SetOption.js","visualizations/TimeFilter/time-filter.d3.js","visualizations/TimeFilter/TimeFilter.js","general/MultipleSelection/MultipleSelection.js","general/SimpleDropDown/SimpleDropDown.js","general/SimpleSearch/SimpleSearch.js","general/FilterSearch/FilterSearch.js","general/MoreInfo/MoreInfo.js","PlacesMatrixView/parse-matrix-data.js","visualizations/PlacesMatrix/matrix.d3.js","visualizations/PlacesMatrix/PlacesMatrix.js","PlacesMatrixView/PlacesMatrixView.js","App.js","serviceWorker.js","index.js"],"names":["BodyViz","className","this","props","children","Component","MainMenu","style","icon","faBars","Loading","SetOption","handleChange","bind","e","newValue","target","checked","selected","title","type","onChange","defaultProps","Viz","el","data","changeSpan","margin","top","right","bottom","getBoundingClientRect","height","left","svg","d3","width","append","attr","classed","x","range","domain","d","xAxis","brush","extent","handleSize","m","on","brushed","context","info","selectAll","line","dotted","call","move","span","exit","remove","enter","i","scale","getAnchor","text","getFullYear","merge","_groups","getBBox","sourceEvent","selection","map","invert","console","log","Date","update","TimeFilter","_chart","initialize","_rootNode","destroy","componentNode","id","ref","_setRef","MultipleSelection","checkboxes","document","getElementById","getElementsByTagName","Array","from","name","filter","status","changeOptions","options","key","defaultChecked","SimpleDropDown","changeOption","value","SimpleSearch","debounceTyping","_","debounce","searching","handleTyping","selectResult","event","length","minLength","getElementsByClassName","innerHTML","getAttribute","liStyle","backgroundColor","placeholder","position","previewSearch","slice","onClick","data-attr","values","FilterSearch","allTitles","originalData","pubVenueTitle","split","flattenDeep","entries","nodesByPublicationTitle","forEach","publishedHere","includes","obj","push","state","option","publicationsTitles","handleSearch","resetSearch","searchResults","searchRecord","newOption","label","setState","nestedData","toLowerCase","dimension","display","search","faTimesCircle","MoreInfo","faQuestionCircle","ParseMatrixData","rawData","year","hierarchies","handleHierarchies","graph","calculateNetwork","nodes","part_of","part_of_d","find","subNodes","totalSubNodes","part_of_e","f","part_of_f","g","part_of_g","h","edges","source","n","globalFilters","y","r","color","originalLabelsSize","xAxisCall","yAxisCall","g_forceLayout","yAxis","hull","link","node","presumed","information","simulation","categories","categoriesColors","links","hullsData","last","V","filters","timeStamp","reset","ticks","every","padding","tickSize","tickFormat","replace","exponent","select","step","size","nnn","closeSubnodes","toOpen","n0","category","indexOf","n1","n2","openSubnodes","toClose","nn","each","selectNode","unselectNode","force","thisCollisionPadding","collisionPadding","opened","strength","iterations","distance","points","convexHull","roundedHull","stop","zoom","translateExtent","scaleExtent","transform","new_x","rescaleX","parseFloat","newSize","k","l","fx","correspondingYear","toggleSubnodes","selectLabel","selectSameComposition","displayTitle","darker","isGuessed","kind","alpha","restart","theOriginalData","surviveFilters","clone","parents2open","s","search4Parent","nodeId","thisNode","od","reverse","parentId","parent_id","parent","an_id","pubTypes","kinds","publicationType","pubThemes","themes","mergeSurvived","intersection","this_node","openAll","runAll","nodesList","closeAll","doRestart","fy","subNode","thisHullNodes","concat","thisHull","augmentedNodes","subNodes2Remove","hulls2Remove","collectSubNodes","parentNode","childNode","toRemove","filtered","unselectLabel","arr","sourceTitle","exportSelected","selectedData","envs","searchedTerm","property","export_data","composition_id","composition_title","join","the_date","filename","file","Blob","window","navigator","msSaveOrOpenBlob","a","createElement","url","URL","createObjectURL","href","download","body","appendChild","click","setTimeout","removeChild","revokeObjectURL","addEventListener","hullPadding","vecScale","v","vecSum","pv1","pv2","unitNormal","p0","p1","nLength","Math","sqrt","polyPoints","roundedHull1","roundedHull2","segments","segmentIndex","offset","arcData","segment","index","pathFragment","p2","offsetVector","invOffsetVector","p3","PlacesMatrix","prevProps","prevState","PlacesMatrixView","loadData","isLoading","changePublications","changeThemes","then","parser","dataTimeFilter","publicationsTypes","searchOptions","newSpan","newPublications","newThemes","gridColumn","App","Boolean","location","hostname","match","ReactDOM","render","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.1bc4b686.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport './BodyViz.css';\n\nclass BodyViz extends Component {\n  render() {\n    return <div className={this.props.className}>{this.props.children}</div>;\n  }\n}\n\nexport default BodyViz;\n","import React, { Component } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faBars } from '@fortawesome/free-solid-svg-icons';\nimport './MainMenu.css';\n\nclass MainMenu extends Component {\n  render() {\n    return <div className=\"main-menu\" style={this.props.style}><FontAwesomeIcon icon={faBars} /></div>;\n  }\n}\n\nexport default MainMenu;\n","import React, { Component } from 'react';\n\nclass Loading extends Component {\n  render() {\n    return <div style={this.props.style}>Loading ...</div>;\n  }\n}\n\nexport default Loading;\n","import React, { Component } from 'react';\nimport './SetOption.css'\n\nclass SetOption extends Component {\n\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n  }\n\n  handleChange(e) {\n    const newValue = e.target.checked;\n    this.props.selected(newValue);\n  }\n\n  render() {\n    return (\n      <div className=\"set-option\" style={this.props.style}>\n        <h5>{this.props.title}</h5>\n        <label className=\"switch\">\n          <input type=\"checkbox\" onChange={this.handleChange}/>\n          <span className=\"slider round\"></span>\n        </label>\n      </div>\n    );\n  }\n}\n\nexport default SetOption;\n\nSetOption.defaultProps = { title: 'Option' };\n","import * as d3 from 'd3';\n\nconst Viz = {};\n\nViz.initialize = (el, data, changeSpan) => {\n  // console.log('initialized')\n\n  // data must be an array with 2+ elements. Element is a Date object\n\n  // Important to declare at beginning\n  Viz.changeSpan = changeSpan;\n\n  const m = 15;\n  Viz.margin = { top: 0, right: m, bottom: el.getBoundingClientRect().height - 20, left: m }\n  Viz.svg = d3.select(el);\n  Viz.width = el.getBoundingClientRect().width - Viz.margin.left - Viz.margin.right;\n  Viz.height = el.getBoundingClientRect().height - Viz.margin.top - Viz.margin.bottom;\n\n  Viz.svg.append(\"defs\").append(\"clipPath\")\n      .attr(\"id\", \"timeclip\")\n    .append('rect')\n      .classed('clip', true)\n      .attr('x', 0)\n      .attr('y', Viz.margin.top)\n      .attr('width', Viz.width + Viz.margin.left + Viz.margin.right)\n      .attr('height', Viz.height)\n      // the following to compensate the translation on VIz.context (even if not totally clear)\n      .attr(\"transform\", \"translate(\" + -Viz.margin.left + \",\" + -Viz.margin.top + \")\")\n\n  Viz.x = d3.scaleTime()\n    .range([0, Viz.width])\n    .domain(d3.extent(data, d => d));\n\n  Viz.xAxis = d3.axisBottom(Viz.x)\n\n  Viz.brush = d3.brushX()\n    .extent([[0, 0], [Viz.width, Viz.height]])\n    .handleSize(m*2)\n    .on(\"brush end\", brushed)\n    // .on(\"end\", brushed);\n\n  Viz.context = Viz.svg.append(\"g\")\n    .attr(\"class\", \"context\")\n    .attr(\"transform\", \"translate(\" + Viz.margin.left + \",\" + Viz.margin.top + \")\")\n\n  // important is before brushed is called or assigned\n  Viz.info = Viz.context.append('g').selectAll('.info')\n  Viz.line = Viz.context.append('g').selectAll('.info-line')\n  Viz.dotted = Viz.context.append('g').selectAll('.dotted')\n\n  Viz.context.append(\"line\")\n    .attr('x1', 0)\n    .attr('y1', Viz.height/2)\n    .attr('x2', Viz.width)\n    .attr('y2', Viz.height/2)\n    .attr('stroke', 'var(--dark-green)')\n\n  Viz.context.append(\"g\")\n    .attr(\"class\", \"brush\")\n    .call(Viz.brush)\n    .call(Viz.brush.move, Viz.x.range())\n}\n\nViz.update = (span) => {\n  // console.log('updated')\n\n  Viz.info = Viz.info.data(span, d=>d);\n  Viz.info.exit().remove()\n  Viz.info = Viz.info.enter().append('text')\n    .attr('class','info')\n    .attr('x', d => { return Viz.x(d) })\n    .attr('y', Viz.height + Viz.margin.top + 12) // this value depends on the font-size\n    .attr('text-anchor', (d,i) => {\n      function getAnchor(d,scale, width) {\n        let anchor;\n        if (i%2===0) {\n          if (scale(d) >= width/4) {\n            anchor = 'end';\n          } else {\n            anchor = 'start';\n          }\n        } else {\n          if (scale(d) <= width/4*3) {\n            anchor = 'start';\n          } else {\n            anchor = 'end';\n          }\n        }\n        return anchor;\n      }\n      return getAnchor(d, Viz.x, Viz.width);\n    })\n    .text(d=>{\n      return d.getFullYear()\n    })\n    .merge(Viz.info)\n\n  Viz.line = Viz.line.data(span, d=>d);\n  Viz.line.exit().remove()\n  Viz.line = Viz.line.enter().append('line')\n    .attr('class','info-line')\n    .attr('stroke', 'var(--calvino-red)')\n    .attr('stroke-width', '2px')\n    .attr('x1', d => { return Viz.x(d) })\n    .attr('y1', 0)\n    .attr('x2', d => { return Viz.x(d) })\n    .attr('y2', Viz.height)\n    .merge(Viz.line)\n\n  Viz.dotted = Viz.dotted.data([span], (d,i)=>{return d})\n  Viz.dotted.exit().remove()\n  Viz.dotted = Viz.dotted.enter().append('line')\n    .attr('class','dotted')\n    .attr('x1', Viz.info._groups[0][0].getBBox().x + Viz.info._groups[0][0].getBBox().width + 5 )\n    .attr('x2', Viz.info._groups[0][1].getBBox().x - 5)\n    .attr('y1', Viz.height + Viz.margin.top + 6)\n    .attr('y2', Viz.height + Viz.margin.top + 6)\n    .attr('stroke-width', '1.5px')\n    .attr('stroke', 'var(--dark-green)')\n    .attr('stroke-linecap', 'round')\n    .attr('stroke-dasharray', '0,15')\n    .merge(Viz.dotted)\n}\n\nViz.destroy = (el) => {}\n\nexport default Viz\n\nfunction brushed() {\n  if (d3.event.sourceEvent && d3.event.sourceEvent.type === \"zoom\") return; // ignore brush-by-zoom\n  if (d3.event.selection) {\n    var span = d3.event.selection || Viz.x.range();\n    span = span.map(d=>{return Viz.x.invert(d)})\n    if (d3.event.type === \"end\") {\n      console.log('filtered by time')\n      Viz.changeSpan(span);\n    }\n    span = span.map(d=> new Date(d));\n    Viz.update(span);\n  }\n}\n","import React, { Component } from 'react';\nimport './TimeFilter.css';\nimport Viz from './time-filter.d3'\n\nclass TimeFilter extends Component {\n  constructor(props) {\n    super(props);\n    this.changeSpan = this.changeSpan.bind(this);\n  }\n\n  changeSpan(span) {\n    this.props.changeSpan(span);\n  }\n\n  componentDidMount() {\n    this._chart = Viz.initialize(this._rootNode, this.props.data, this.changeSpan);\n  }\n\n  componentDidUpdate() {\n    // Viz.update(this.props.data);\n  }\n\n  componentWillUnmount() {\n    Viz.destroy(this._rootNode);\n  }\n\n  _setRef(componentNode) {\n      this._rootNode = componentNode;\n  }\n\n  render() {\n    return (\n      <div style={this.props.style}>\n        <h5>{this.props.title}</h5>\n        <svg id=\"time-filter\" ref={this._setRef.bind(this)}></svg>\n      </div>\n    );\n  }\n}\n\nexport default TimeFilter;\n\nTimeFilter.defaultProps = { title: 'Time Filter' };\n","import React, { Component } from 'react';\nimport './MultipleSelection.css';\n\nclass MultipleSelection extends Component {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n  }\n\n  handleChange() {\n    // get all checkboxes\n    let checkboxes = document.getElementById(this.props.id).getElementsByTagName('input');\n    // convert from HTMLcollection into a JS array\n    checkboxes = Array.from(checkboxes);\n    // remap and filter\n    checkboxes = checkboxes.map(d=>{return {'name':d.name, 'status':d.checked} });\n    checkboxes = checkboxes.filter(d=>d.status)\n    checkboxes = checkboxes.map(d=>d.name)\n    this.props.changeOptions(checkboxes);\n  }\n\n  render() {\n    return (\n      <div style={this.props.style}>\n        <h5>{this.props.title}</h5>\n\n        <ul id={this.props.id} className=\"multiple-selection-menu\">\n          {\n            this.props.options.map( (d,i) => {\n              return <li key={i}><input type=\"checkbox\" name={d} onChange={this.handleChange} defaultChecked={true} />{d}</li>\n            })\n          }\n        </ul>\n      </div>\n    );\n  }\n}\n\nexport default MultipleSelection;\n\nMultipleSelection.defaultProps = { title: 'Select an option' };\n","import React, { Component } from 'react';\n\nclass SimpleDropDown extends Component {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n  }\n\n  handleChange(e) {\n    this.props.changeOption(e.target.value);\n  }\n\n  render() {\n    return (\n      <select style={this.props.style} onChange={this.handleChange}>\n        { this.props.options.map( (d,i) => {\n          return <option key={i}>{d}</option>\n        })}\n      </select>\n    );\n  }\n}\n\nexport default SimpleDropDown;\n","import React, { Component } from 'react';\nimport _ from 'lodash'\n\nclass SimpleSearch extends Component {\n  constructor(props) {\n    super(props);\n    this.handleTyping = this.handleTyping.bind(this);\n    this.selectResult = this.selectResult.bind(this);\n  }\n\n  handleTyping(event){\n    if (event.target.value.length >= this.props.minLength) {\n      this.debounceTyping(event.target.value)\n    }\n  }\n\n  debounceTyping = _.debounce( (value) => {\n    this.props.searching(value);\n  }, 250);\n\n  selectResult(event){\n    // fill the input with the selected result\n    const the_input = document.getElementsByClassName('filter-search')[0].getElementsByTagName('input')[0].value = event.target.innerHTML\n    this.props.selectResult(event.target.getAttribute('data-attr'))\n  }\n\n  render() {\n    const ulStyle = {\n      position: 'absolute'\n    }\n    const liStyle = {\n      backgroundColor: 'peachpuff'\n    }\n    return (\n      <div style={this.props.style}>\n        <input type=\"text\" name=\"fname\" placeholder=\"Inserisci un nome\" onChange={this.handleTyping} />\n        <ul style={ulStyle}>\n          {this.props.previewSearch.slice(0,8).map( (d,i)=>{\n            return <li style={liStyle} key={i} onClick={this.selectResult} data-attr={d.values} >{d.key}</li>\n          } )}\n        </ul>\n\n      </div>\n    );\n  }\n}\n\nexport default SimpleSearch;\n","import React, { Component } from 'react';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faTimesCircle } from '@fortawesome/free-solid-svg-icons';\n\nimport * as d3 from 'd3';\nimport _ from 'lodash';\nimport SimpleDropDown from '../SimpleDropDown'\nimport SimpleSearch from '../SimpleSearch'\n\nclass FilterSearch extends Component {\n  constructor(props) {\n    super(props);\n\n    let allTitles = this.props.originalData.map(d=>d.pubVenueTitle.split(';'));\n    allTitles = _.flattenDeep(allTitles);\n    allTitles = d3.nest()\n      .key(d=>d)\n      .entries(allTitles)\n      .map(d=>d.key);\n\n    let nodesByPublicationTitle = []\n    allTitles.forEach( d => {\n      let publishedHere = this.props.originalData.filter( e => { return e.pubVenueTitle.includes(d) })\n      let obj = {\n        key: d,\n        values: publishedHere.map(d=>d.id)\n      }\n      nodesByPublicationTitle.push(obj)\n    })\n\n    this.state = {\n      option: this.props.options[0],\n      previewSearch: [],\n      publicationsTitles: allTitles,\n      nodesByPublicationTitle: nodesByPublicationTitle\n    }\n    this.handleSearch = this.handleSearch.bind(this);\n    this.changeOption = this.changeOption.bind(this);\n    this.searching = this.searching.bind(this);\n    this.selectResult = this.selectResult.bind(this);\n    this.resetSearch = this.resetSearch.bind(this);\n  }\n\n  handleSearch(searchResults) {\n    this.props.searchRecord(searchResults);\n  }\n\n  changeOption(option) {\n    const newOption = this.props.options.filter(d=>{return d.label === option})[0]\n    this.setState({\n      option: newOption\n    });\n  }\n\n  searching(value) {\n    let nestedData = [];\n    if (this.state.option.label === 'raccolta') {\n      nestedData = this.state.nodesByPublicationTitle.filter( d => {\n        return d.key.toLowerCase().includes(value.toLowerCase())\n      })\n    } else {\n      nestedData = d3.nest()\n        .key( d => d[this.state.option.dimension])\n        .entries(this.props.originalData)\n        .map( d => {\n          return {\n            key: d.key,\n            values: d.values.map(d=>d.id)\n          }\n        })\n        .filter( d => {\n          return d.key.toLowerCase().includes(value.toLowerCase())\n        })\n    }\n    if (nestedData.length) {\n      this.setState({\n        previewSearch: nestedData\n      });\n    }\n  }\n\n  selectResult(value) {\n    this.setState({\n      previewSearch:[]\n    })\n    this.props.searchRecord(value.split(','))\n  }\n\n  resetSearch() {\n    this.props.resetSearch();\n  }\n\n  render() {\n    return (\n      <div className=\"filter-search\" style={this.props.style}>\n        <h5>{this.props.title}</h5>\n        <SimpleDropDown style={{display: 'inline-block'}} options={this.props.options.map(d=>d.label)} changeOption={this.changeOption}/>\n        <SimpleSearch style={{display: 'inline-block'}} searching={this.searching} previewSearch={this.state.previewSearch} selectResult={this.selectResult} minLength={this.props.minLength} />\n        { (this.props.search && this.props.search.length>0) && <span onClick={this.resetSearch}><FontAwesomeIcon icon={faTimesCircle} /></span>}\n      </div>\n    );\n  }\n}\n\nexport default FilterSearch;\n\nFilterSearch.defaultProps = { title: 'Search for a Record' };\n","import React, { Component } from 'react';\nimport './MoreInfo.css';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faQuestionCircle } from '@fortawesome/free-regular-svg-icons';\n\nclass MoreInfo extends Component {\n  render() {\n    return <div className=\"more-info\"><FontAwesomeIcon icon={faQuestionCircle} /></div>;\n  }\n}\n\nexport default MoreInfo;\n","import * as d3 from 'd3'\n\nconst ParseMatrixData = {}\n\nParseMatrixData.parser = (rawData) => {\n\n  rawData.forEach(function(d){ d.year = new Date(d.year); })\n\n  let data = rawData.map(function(d) {\n    d.year = new Date(d.year);\n    if(!d.id) { d.id = d['data.id'] }\n    var obj = {\n\t\t\t'id': d.id,\n\t\t\t'label': d['Occorrenza'],\n\t\t\t'part_of': d['Parte di ID'],\n\t\t\t'source': d['Fonte'],\n\t\t\t'sourceTitle': d['Titolo Fonte'],\n\t\t\t'year': +d.year,\n\t\t\t'category': d['Categoria'],\n\t\t\t'totalSubNodes':0,\n      'publicationType': d['Pubblicazione Fonte'].split(';'),\n      'pubVenueTitle': d['Pubblicazioni Titoli'],\n      'isGuessed': d['Luogo desunto'],\n      'themes': d['Tema'].split(';')\n\t\t}\n\t\treturn obj\n\t})\n\n  const hierarchies = ParseMatrixData.handleHierarchies(data)\n\n  const graph = ParseMatrixData.calculateNetwork(hierarchies);\n  return {graph,data};\n}\n\nParseMatrixData.handleHierarchies = (nodes) => {\n  let hierarchies = d3.nest()\n\t\t.key(function(d){ return d.part_of })\n\t\t.entries(nodes);\n\n\thierarchies\n\t\t.filter(function(d){ return d.key === '' })[0]\n\t\t.values.forEach(function(d){\n\t\t\tvar part_of_d = hierarchies.find(function(e){ return e.key === d.id })\n\t\t\tif (part_of_d) {\n\t\t\t\t// console.log('LVL 0',d.id, d.label, 'is parent of', part_of_d.values.length);\n\t\t\t\td.subNodes = part_of_d.values;\n\t\t\t\td.totalSubNodes = part_of_d.values.length\n\n\t\t\t\tpart_of_d.values.forEach(function(e){\n\t\t\t\t\tvar part_of_e = hierarchies.find(function(f){ return f.key === e.id })\n\t\t\t\t\tif (part_of_e) {\n\t\t\t\t\t\t// console.log('LVL 1',e.id, e.label, 'is parent of', part_of_e.values.length);\n\t\t\t\t\t\te.subNodes = part_of_e.values\n\t\t\t\t\t\te.totalSubNodes = part_of_e.values.length\n\t\t\t\t\t\td.totalSubNodes += e.totalSubNodes\n\n\t\t\t\t\t\tpart_of_e.values.forEach(function(f){\n\t\t\t\t\t\t\tvar part_of_f = hierarchies.find(function(g){ return g.key === f.id})\n\t\t\t\t\t\t\tif (part_of_f) {\n\t\t\t\t\t\t\t\t// console.log('LVL 2', f.id, f.label, 'is parent of', part_of_f.values.length)\n\t\t\t\t\t\t\t\tf.subNodes = part_of_f.values\n\t\t\t\t\t\t\t\tf.totalSubNodes = part_of_f.values.length\n\t\t\t\t\t\t\t\td.totalSubNodes += f.totalSubNodes\n\n\t\t\t\t\t\t\t\tpart_of_f.values.forEach(function(g){\n\t\t\t\t\t\t\t\t\tvar part_of_g = hierarchies.find(function(h){ return h.key === g.id })\n\t\t\t\t\t\t\t\t\tif (part_of_g) {\n\t\t\t\t\t\t\t\t\t\t// console.log('LVL 3', g.id, g.label, 'is parent of', part_of_g.values.length)\n\t\t\t\t\t\t\t\t\t\tg.subNodes = part_of_g.values\n\t\t\t\t\t\t\t\t\t\tg.totalSubNodes = part_of_g.values.length\n\t\t\t\t\t\t\t\t\t\td.totalSubNodes += f.totalSubNodes\n\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t// return array of hierarchical nodes\n\treturn hierarchies.filter(function(d){ return d.key === '' })[0].values;\n}\n\nParseMatrixData.calculateNetwork = (nodes) => {\n\t// create the array of edges\n\tvar edges = []\n\t// base edges on works co-occurrences of places\n\td3.nest()\n\t\t.key(function(d) { return d.source })\n\t\t.entries(nodes)\n\t\t.forEach((d) => {\n\t\t\td.values.filter(function(e) {\n\t\t\t\treturn e.part_of !== '';\n\t\t\t}).forEach((n, i) => {\n\t\t\t\tvar obj = {}\n\t\t\t\tobj = {\n\t\t\t\t\t'source': n.id,\n\t\t\t\t\t'target': n.part_of,\n\t\t\t\t\t'volume': d.key,\n\t\t\t\t\t// 'year': n.year,\n\t\t\t\t\t'source_part_of': n.part_of,\n\t\t\t\t\t'kind': 'part_of'\n\t\t\t\t}\n\t\t\t\tedges.push(obj);\n\t\t\t})\n\t\t})\n\treturn { 'nodes': nodes, 'edges': edges, 'root_nodes': nodes.filter(d => d.subNodes)}\n}\n\nexport default ParseMatrixData\n","import * as d3 from 'd3';\nimport ParseMatrixData from '../../PlacesMatrixView/parse-matrix-data';\nimport _ from 'lodash';\n\nconst categories = ['generico_non_terrestre', 'nominato_non_terrestre', 'nominato_terrestre', 'generico_terrestre', 'inventato', 'no_ambientazione'];\nconst categoriesColors = ['#3131ff', '#bbbbff', '#ffce00', '#ff6c39', '#00c19c', '#cecece']\n\nconst collisionPadding = 0.25;\n\n// data\nlet graph, nodes = [],\n\tlinks = [],\n\thullsData = [],\n\tlast = 0,\n\tglobalFilters,\n\topenAllState = false;\n\n// Dimensions and scales\nlet x, y, r, color, margin = { 'top': 0, 'right': 50, 'bottom': 30, 'left': 50 },\n\toriginalLabelsSize,\n\twidth, height;\nlet xAxisCall, yAxisCall;\n\n// elements\nlet svg, g, g_forceLayout, xAxis, yAxis, hull, link, node, presumed, label, information\n\n// force-layout\nlet simulation\n\nconst V = {}\n\nexport default V\n\nV.initialize = (el, data, filters) => {\n\t// console.log('init');\n\t// console.log('data:', data);\n\t// console.log('filters:', filters);\n\n\t// Root element and dimensions\n\tsvg = d3.select(el).style('touch-action', 'manipulation');\n\twidth = svg.node().getBoundingClientRect().width - margin.left - margin.right;\n\theight = svg.node().getBoundingClientRect().height - margin.top - margin.bottom;\n\n\tsvg.append('rect')\n\t\t.attr('width', width + margin.left + margin.right)\n\t\t.attr('height', height + margin.top + margin.bottom)\n\t\t.classed('reset-rect', true)\n\t\t.on('click', d => {\n\t\t\tif((d3.event.timeStamp - last) < 500) {\n\t\t\t\tconsole.log('reset')\n\t\t\t\treset();\n\t\t\t}\n\t\t\tlast = d3.event.timeStamp;\n\t\t})\n\n\t// Scales\n\tx = d3.scaleTime()\n\t\t.range([0, width])\n\t\t.domain(filters.span);\n\n\txAxisCall = d3.axisBottom(x).ticks(d3.timeYear.every(1));\n\n\ty = d3.scalePoint()\n\t\t.range([0, height])\n\t\t.domain(categories)\n\t\t.padding(0.5);\n\n\tyAxisCall = d3.axisRight(y)\n\t\t.tickSize(width)\n\t\t.tickFormat(d => {\n\t\t\treturn d.replace(/_/g, ' ')\n\t\t});\n\n\tr = d3.scalePow().exponent(0.5)\n\t\t.range([3, 25])\n\t\t.domain([1, d3.max(data.nodes, function(d) { return d.totalSubNodes })]);\n\n\tcolor = d3.scaleOrdinal().domain(categories).range(categoriesColors);\n\n\t// Groups and scales\n\tg = svg.append('g').attr(\"transform\", `translate(${margin.left},${margin.top})`);\n\txAxis = g.append(\"g\").attr(\"class\", \"x-axis\");\n\tyAxis = g.append('g').attr(\"class\", \"y-axis\");\n\tg_forceLayout = g.append('g');\n\n\txAxis.attr(\"transform\", `translate(${0}, ${height})`).call(xAxisCall);\n\n\tyAxis.attr(\"transform\", `translate(0, 0)`)\n\t\t.call(yAxisCall)\n\t\t.call(g => g.selectAll(\".tick text\")\n\t\t\t.style(\"text-transform\", \"capitalize\"))\n\t\t.call(g => g.select(\".domain\")\n\t\t\t.remove())\n\t\t.call(g => g.selectAll(\".tick line\")\n\t\t\t.attr(\"stroke-opacity\", 0.5)\n\t\t\t.attr(\"stroke-dasharray\", \"2,2\"))\n\t\t.call(g => g.selectAll(\".tick text\")\n\t\t\t.attr(\"x\", 4)\n\t\t\t.attr(\"dy\", -y.step() / 10));\n\n\tyAxis.selectAll('.tick')\n\t\t.on('click', function(d) {\n\n\t\t\tif(d3.select(this).classed('cat-selected') === false) {\n\n\t\t\t\tif(d3.selectAll('.tick.cat-selected').size() > 0) {\n\t\t\t\t\tnodes.filter(nnn => nnn.part_of === '').forEach(n => { closeSubnodes(n, false) });\n\t\t\t\t\td3.selectAll('.tick')\n\t\t\t\t\t\t.classed('cat-selected', false)\n\t\t\t\t\t\t.select('rect')\n\t\t\t\t\t\t.attr('fill', 'transparent')\n\t\t\t\t}\n\n\t\t\t\tlet toOpen = []\n\t\t\t\tnodes.forEach(n0 => {\n\t\t\t\t\t// console.log('n0',n0);\n\t\t\t\t\tif(n0.totalSubNodes > 0) {\n\t\t\t\t\t\tif(n0.subNodes.map(n => n.category).indexOf(d) > -1) {\n\t\t\t\t\t\t\ttoOpen.push(n0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tn0.subNodes.forEach(n1 => {\n\t\t\t\t\t\t\t// console.log('n1',n1);\n\t\t\t\t\t\t\tif(n1.totalSubNodes > 0) {\n\t\t\t\t\t\t\t\tif(n1.subNodes.map(n => n.category).indexOf(d) > -1) {\n\t\t\t\t\t\t\t\t\ttoOpen.push(n0);\n\t\t\t\t\t\t\t\t\ttoOpen.push(n1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tn1.subNodes.forEach(n2 => {\n\t\t\t\t\t\t\t\t\t// console.log('n2',n2);\n\t\t\t\t\t\t\t\t\tif(n2.totalSubNodes > 0) {\n\t\t\t\t\t\t\t\t\t\tif(n2.subNodes.map(n => n.category).indexOf(d) > -1) {\n\t\t\t\t\t\t\t\t\t\t\ttoOpen.push(n0);\n\t\t\t\t\t\t\t\t\t\t\ttoOpen.push(n1);\n\t\t\t\t\t\t\t\t\t\t\ttoOpen.push(n2);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\ttoOpen.forEach(n => { openSubnodes(n, false) });\n\n\t\t\t\td3.select(this).select('rect')\n\t\t\t\t\t.attr('fill', d => color(d))\n\t\t\t} else {\n\t\t\t\tlet toClose = []\n\t\t\t\tnodes.forEach(n0 => {\n\t\t\t\t\t// console.log('n0',n0);\n\t\t\t\t\tif(n0.totalSubNodes > 0) {\n\t\t\t\t\t\tif(n0.subNodes.map(n => n.category).indexOf(d) > -1) {\n\t\t\t\t\t\t\ttoClose.push(n0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tn0.subNodes.forEach(n1 => {\n\t\t\t\t\t\t\t// console.log('n1',n1);\n\t\t\t\t\t\t\tif(n1.totalSubNodes > 0) {\n\t\t\t\t\t\t\t\tif(n1.subNodes.map(n => n.category).indexOf(d) > -1) {\n\t\t\t\t\t\t\t\t\ttoClose.push(n0);\n\t\t\t\t\t\t\t\t\ttoClose.push(n1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tn1.subNodes.forEach(n2 => {\n\t\t\t\t\t\t\t\t\t// console.log('n2',n2);\n\t\t\t\t\t\t\t\t\tif(n2.totalSubNodes > 0) {\n\t\t\t\t\t\t\t\t\t\tif(n2.subNodes.map(n => n.category).indexOf(d) > -1) {\n\t\t\t\t\t\t\t\t\t\t\ttoClose.push(n0);\n\t\t\t\t\t\t\t\t\t\t\ttoClose.push(n1);\n\t\t\t\t\t\t\t\t\t\t\ttoClose.push(n2);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\ttoClose.forEach(n => { closeSubnodes(n, false) });\n\n\t\t\t\td3.select(this).select('rect')\n\t\t\t\t\t.attr('fill', 'transparent')\n\t\t\t}\n\n\t\t\tV.update(globalFilters);\n\n\t\t\tif(d3.select(this).classed('cat-selected') === false) {\n\t\t\t\tnode.filter(nn => { return nn.category === d }).each(nn => selectNode(nn))\n\t\t\t} else {\n\t\t\t\tnode.each(nn => unselectNode(nn))\n\t\t\t}\n\n\t\t\t// Now that everything is done, assign the class\n\t\t\td3.select(this).classed('cat-selected', !d3.select(this).classed('cat-selected'))\n\t\t})\n\t\t.append('rect')\n\t\t.attr('width', '14px')\n\t\t.attr('height', '14px')\n\t\t.attr('x', -14)\n\t\t.attr('y', -22)\n\t\t.attr('rx', 2)\n\t\t.attr('fill', 'transparent')\n\t\t.attr('stroke', d => color(d))\n\n\tlink = g_forceLayout.append('g').classed('links', true).selectAll('.link');\n\thull = g_forceLayout.append('g').classed('hulls', true).selectAll('.hull');\n\tnode = g_forceLayout.append('g').classed('nodes', true).selectAll('.node');\n\tpresumed = g_forceLayout.append('g').classed('presumed', true).selectAll('.presumed');\n\tlabel = g_forceLayout.append('g').classed('labels', true).selectAll('.label');\n\tinformation = g.append('g').classed('informations', true).selectAll('.information');\n\n\tsimulation = d3.forceSimulation(nodes)\n\t\t.force(\"collision\", d3.forceCollide(function(d) {\n\t\t\tlet thisCollisionPadding = d.totalSubNodes > 0 ? collisionPadding + 2 : collisionPadding;\n\t\t\treturn d.opened ? r(1) + thisCollisionPadding : r(d.totalSubNodes + 1) + thisCollisionPadding\n\t\t}).strength(.3).iterations(12))\n\t\t.force(\"link\", d3.forceLink()\n\t\t\t.strength(.45)\n\t\t\t.distance(r.range()[0])\n\t\t\t.id(function(d) { return d.id; })\n\t\t)\n\t\t.force(\"x\", d3.forceX(d => x(d.year)))\n\t\t.force(\"y\", d3.forceY(d => y(d.category)).strength(d => d.part_of === '' ? 0.1 : 0))\n\t\t.on(\"tick\", ticked)\n\t\t.on(\"end\", () => { console.log('simulation ended') })\n\t\t.stop()\n\n\tfunction ticked() {\n\t\tnode.attr(\"cx\", (d, i) => d.x)\n\t\t\t.attr(\"cy\", d => d.y);\n\n\t\tpresumed.attr(\"cx\", function(d) { return d.x; })\n\t\t\t.attr(\"cy\", function(d) { return d.y; });\n\n\t\tlabel.attr(\"x\", function(d) { return d.x; })\n\t\t\t.attr(\"y\", function(d) { return d.y; });\n\n\t\tlink.attr(\"x1\", function(d) { return d.source.x; })\n\t\t\t.attr(\"y1\", function(d) { return d.source.y; })\n\t\t\t.attr(\"x2\", function(d) { return d.target.x; })\n\t\t\t.attr(\"y2\", function(d) { return d.target.y; });\n\n\t\thull.attr(\"d\", function(d) {\n\t\t\tlet thisHullPoints = d.map(d => { return [d.x, d.y] });\n\t\t\tvar points = thisHullPoints;\n\t\t\tvar convexHull = (points.length < 3) ? points : d3.polygonHull(points);\n\t\t\treturn roundedHull(convexHull, d);\n\t\t})\n\t}\n\n\t// handle the zoom function\n\n\tlet zoom = d3.zoom()\n\t\t.translateExtent([\n\t\t\t[0, 0],\n\t\t\t[width + margin.left + margin.right, height + margin.top + margin.bottom]\n\t\t])\n\t\t.scaleExtent([1, 10])\n\t\t.on(\"zoom\", zoomed);\n\n\tfunction zoomed() {\n\t\t// so a simple resize+translate for the main group and the y axis\n\t\tg_forceLayout.attr(\"transform\", d3.event.transform);\n\t\tyAxis.attr(\"transform\", d3.event.transform);\n\n\t\t// the x axis has to be resscaled according to the zoom\n\t\t// taken from: https://bl.ocks.org/rutgerhofste/5bd5b06f7817f0ff3ba1daa64dee629d\n\t\tlet new_x = d3.event.transform.rescaleX(x);\n\t\txAxis.call(xAxisCall.scale(new_x))\n\n\t\t// rescale labels\n\t\tif(!originalLabelsSize) {\n\t\t\toriginalLabelsSize = d3.select('.label').style('font-size');\n\t\t\toriginalLabelsSize = parseFloat(originalLabelsSize);\n\t\t}\n\t\tconst newSize = originalLabelsSize / d3.event.transform.k\n\t\t// change style on the parent\n\t\t// this will propagate the new size to all children (label)\n\t\td3.select('g.labels').style('font-size', newSize + 'px')\n\n\t\t// display all labels of selected compositions\n\t\tif(d3.event.transform.k > 3) {\n\t\t\td3.selectAll('.node.selected').each(d => {\n\t\t\t\tlabel.filter(l => l.id === d.id).classed('zoom-selected', true)\n\t\t\t})\n\t\t} else {\n\t\t\tlabel.classed('zoom-selected', false)\n\t\t}\n\n\t\tinformation.attr('x', d => (new_x(d.year) >= width / 2) ? new_x(d.year) + 4.8 : new_x(d.year) - 3.2);\n\t}\n\n\tsvg.call(zoom).on(\"dblclick.zoom\", null);\n\n\t//Store data in global variable\n\tgraph = data;\n\tglobalFilters = filters;\n\n\t// Precalculating the position of nodes allows to make them appear in place\n\tgraph.nodes = graph.nodes.map(d => {\n\t\treturn {\n\t\t\t...d,\n\t\t\tx: x(d.year),\n\t\t\ty: y(d.category)\n\t\t}\n\t})\n\n}\n\nV.update = (filters) => {\n\t// console.log('update');\n\t// console.log('graph:', graph);\n\n\tif(filters) globalFilters = filters\n\n\t// update data\n\tnodes = graph.nodes;\n\tlinks = graph.edges;\n\n\t// update fx before updating the x scale\n\tnodes.forEach(d => {\n\t\tif(d.fx) {\n\t\t\td.correspondingYear = x.invert(d.fx)\n\t\t} else {\n\t\t\tdelete d.correspondingYear;\n\t\t}\n\t})\n\n\t// Update x domain\n\tx.domain(globalFilters.span)\n\txAxis.call(xAxisCall);\n\n\t// calculate new fx\n\tnodes.forEach(d => {\n\t\tif(d.correspondingYear) {\n\t\t\td.fx = x(d.correspondingYear)\n\t\t}\n\t})\n\n\tnode = node.data(nodes, d => { return d.id })\n\tnode.exit().remove();\n\tnode = node.enter().append('circle')\n\t\t.attr('class', d => `node`)\n\t\t.classed('sub-node', d => d.part_of !== '')\n\t\t// .classed('selected', d => d.isSelected )\n\t\t.attr('key', d => d.id)\n\t\t.on('mouseenter', d => {\n\t\t\tlabel.filter(l => l.id === d.id).style('display', 'block')\n\t\t\tnode.style('opacity', .25).filter(n => n.source === d.source).style('opacity', 1)\n\t\t})\n\t\t.on('mouseleave', d => {\n\t\t\tlabel.filter(l => l.id === d.id).style('display', 'none')\n\t\t\tnode.style('opacity', '')\n\t\t})\n\t\t.on('click', d => {\n\t\t\t// console.log('clicked on', d)\n\t\t\t// if double click/tap\n\t\t\tif((d3.event.timeStamp - last) < 500) {\n\t\t\t\ttoggleSubnodes(d, 'restart the force');\n\t\t\t}\n\t\t\tlast = d3.event.timeStamp;\n\t\t\t// do this after the nodes have been opened\n\t\t\tselectLabel(d);\n\t\t\tselectSameComposition(d);\n\t\t\tdisplayTitle([d]);\n\t\t})\n\t\t.merge(node)\n\t\t.style('cursor', function(d) { return d.subNodes && d.subNodes.length ? 'pointer' : 'auto'; })\n\t\t.attr(\"fill\", d => d.opened === true ? 'white' : color(d.category))\n\t\t.attr('stroke', function(d) { if(d.totalSubNodes > 0) return d3.color(color(d.category)).darker(1) })\n\t\t.attr(\"r\", function(d) { return d.opened ? r(1) : r(d.totalSubNodes + 1) }) // +1 means plus itself\n\n\tpresumed = presumed.data(nodes.filter(d => d.isGuessed), d => d.id)\n\tpresumed.exit().remove();\n\tpresumed = presumed.enter().append('circle')\n\t\t.classed('presumed', true)\n\t\t.attr('r', 1.5)\n\t\t.attr('fill', d => d3.color(color(d.category)).darker(1))\n\t\t.merge(presumed)\n\n\t// Apply the general update pattern to the links.\n\tlink = link.data(links, d => d.source.id + \"-\" + d.target.id);\n\tlink.exit().remove();\n\tlink = link.enter().append(\"line\")\n\t\t.classed('link', true)\n\t\t.classed('part-of', function(d) { return d.kind === 'part_of' })\n\t\t.attr('stroke-width', 0.5)\n\t\t.attr('stroke', '#ccc')\n\t\t.merge(link);\n\n\t// Apply the general update pattern to the labels.\n\tlabel = label.data(nodes, d => d.id);\n\tlabel.exit().remove();\n\tlabel = label.enter().append(\"text\")\n\t\t.classed('label', true)\n\t\t.style('display', 'none')\n\t\t.attr('text-anchor', 'middle')\n\t\t.style('pointer-events', 'none')\n\t\t.text(d => d.label)\n\t\t.merge(label);\n\n\t// Apply the general update pattern to the convex hulls.\n\thull = hull.data(hullsData, d => d[0].id);\n\thull.exit().remove();\n\thull = hull.enter().append(\"path\")\n\t\t.classed('hull', true)\n\t\t.attr('fill', d => color(d[0].category))\n\t\t.style('opacity', .25)\n\t\t.merge(hull);\n\n\tsimulation.nodes(nodes);\n\tif(simulation.force(\"link\")) {\n\t\tsimulation.force(\"link\").links(links);\n\t}\n\tsimulation.alpha(1).restart();\n\n}\n\nV.filter = (filters, theOriginalData) => {\n\t// console.log('filter');\n\t// console.log('filters:', filters);\n\t// console.log('graph:', graph)\n\tglobalFilters = filters;\n\n\tlet surviveFilters = []\n\n\t// the search can open parent-nodes, so can modyfy the data structure and the BodyViz\n\t// for this reason put it before the others\n\tif(filters.search.length) {\n\n\t\tsurviveFilters[2] = _.clone(filters.search, true);\n\n\t\tlet parents2open = [];\n\t\tfilters.search.forEach(s => {\n\t\t\tsearch4Parent(s);\n\t\t});\n\n\t\tfunction search4Parent(nodeId) {\n\t\t\tconst thisNode = theOriginalData.filter(od => od.id === nodeId)[0];\n\t\t\tif(thisNode.part_of !== \"\") {\n\t\t\t\tparents2open.push(thisNode.part_of);\n\t\t\t\tsearch4Parent(thisNode.part_of);\n\t\t\t}\n\t\t}\n\n\t\tif(parents2open.length > 0) {\n\t\t\tparents2open.reverse().forEach((parentId, i) => {\n\t\t\t\tconst parent_id = theOriginalData.filter(od => od.id === parentId)[0].id;\n\t\t\t\tsurviveFilters[2].push(parent_id);\n\t\t\t\tconst parent = nodes.filter(d => d.id === parent_id)[0]\n\t\t\t\topenSubnodes(parent, 'do not restart the force');\n\t\t\t})\n\n\t\t\tV.update(filters)\n\n\t\t\tfilters.search.forEach(an_id => {\n\t\t\t\tselectLabel({ id: an_id })\n\t\t\t})\n\t\t}\n\t}\n\n\tlet pubTypes = filters.kinds;\n\tsurviveFilters[0] = nodes.filter(d => {\n\t\tlet check = pubTypes.map(e => d.publicationType.indexOf(e) > -1)\n\t\treturn check.indexOf(true) > -1;\n\t}).map(d => d.id);\n\n\tlet pubThemes = filters.themes;\n\tsurviveFilters[1] = nodes.filter(d => {\n\t\tlet check = pubThemes.map(e => d.themes.indexOf(e) > -1)\n\t\treturn check.indexOf(true) > -1;\n\t}).map(d => d.id);\n\n\tlet mergeSurvived = [];\n\tsurviveFilters.forEach((d, i) => {\n\t\tif(i === 0) {\n\t\t\tmergeSurvived = d;\n\t\t} else {\n\t\t\tmergeSurvived = _.intersection(mergeSurvived, surviveFilters[i]);\n\t\t}\n\t})\n\n\treset();\n\n\tmergeSurvived.forEach(m => {\n\t\tconst this_node = nodes.filter(n => n.id === m);\n\t\tif(this_node.length > 0) selectNode(this_node[0]);\n\t})\n}\n\nV.openAll = () => {\n\trunAll(nodes);\n\n\tfunction runAll(nodesList) {\n\t\tnodesList.forEach(n => {\n\t\t\tif(n.totalSubNodes > 0) {\n\t\t\t\topenSubnodes(n, 'do not restart simulation');\n\t\t\t\trunAll(n.subNodes);\n\t\t\t}\n\t\t});\n\t}\n}\n\nV.closeAll = () => {\n\tnodes.filter(d => d.part_of === '').forEach(function(d) {\n\t\tcloseSubnodes(d, 'do not restart simulation');\n\t})\n}\n\nV.destroy = () => {}\n\n// Other functions\nconst openSubnodes = (d, doRestart) => {\n\t// If it happens that the node is already open, just skip.\n\tif(d.opened) return;\n\n\t// If not, let's open it\n\td.opened = true;\n\n\t// fix the position only if it is a \"root node\"\n\tif(d.part_of === '') {\n\t\td.fx = d.x;\n\t\td.fy = d.y;\n\t} else {\n\t\td.x = nodes.filter(n => n.id === d.part_of)[0].x\n\t\td.fy = nodes.filter(n => n.id === d.part_of)[0].y + r.range()[0] * 2 * 3\n\t}\n\n\t// make subnodes appear at the place of their parent\n\td.subNodes.forEach(function(subNode) {\n\t\tsubNode.x = d.x;\n\t\tsubNode.y = d.y;\n\t\t// subNode.isSelected = true;\n\t})\n\n\t// Make convex hull\n\tvar thisHullNodes = [d].concat(d.subNodes); // first element in array is always the one opened, so we can use its ID as identifier for the convex hull\n\thullsData.push(thisHullNodes);\n\n\t// check if the first point of the hull is inside another hulls\n\t// if so it means this hull should be part of that opened\n\t// add these points to that hullsData\n\thullsData.forEach(function(thisHull) {\n\t\t// if the element is in the array, but is not the first\n\t\tif(thisHull.indexOf(thisHullNodes[0]) > 0) {\n\t\t\tthisHullNodes.forEach(function(n, i) {\n\t\t\t\tif(i !== 0) {\n\t\t\t\t\tthisHull.push(n);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t})\n\n\t// calculate Graph\n\tvar augmentedNodes = nodes.concat(d.subNodes);\n\tgraph = ParseMatrixData.calculateNetwork(augmentedNodes);\n\tnodes = graph.nodes;\n\tlinks = graph.edges;\n\tif(doRestart === 'restart the force') {\n\t\tV.update();\n\t}\n}\nconst closeSubnodes = (d, doRestart) => {\n\t// If it is already opened or if it has no children, just skip\n\tif(!d.opened || d.totalSubNodes === 0) return;\n\n\td.opened = false;\n\tdelete d.fx;\n\tdelete d.fy;\n\n\tvar subNodes2Remove = [];\n\tvar hulls2Remove = [d.id]\n\n\t// recursive functions, it makes possible to close contained cluster of nodes\n\tfunction collectSubNodes(parentNode) {\n\t\tparentNode.subNodes.forEach(childNode => {\n\t\t\tif(childNode.opened) {\n\t\t\t\tchildNode.opened = false;\n\t\t\t\thulls2Remove.push(childNode.id);\n\t\t\t\tcollectSubNodes(childNode);\n\t\t\t}\n\t\t});\n\t\tsubNodes2Remove.push(parentNode.subNodes);\n\t}\n\n\tcollectSubNodes(d);\n\n\t// cycle in the subNodes2Remove array and for each list of sub-nodes to be removed remove and re-calculate the network.\n\t// Probably not the best way, but the simplest at the moment of the coding.\n\tsubNodes2Remove.forEach(subNodes => {\n\n\t\tlet toRemove = subNodes.map(d => d.id)\n\t\tlet filtered = nodes.filter(el => {\n\t\t\treturn !toRemove.includes(el.id);\n\t\t})\n\n\t\t// remove this hull\n\t\thullsData = hullsData.filter(function(h) {\n\t\t\treturn !hulls2Remove.includes(h[0].id);\n\t\t})\n\n\t\t// remove extra points from the outer hull\n\t\thullsData.forEach(function(thisHull, i) {\n\t\t\thullsData[i] = thisHull.filter(function(n) {\n\t\t\t\treturn !toRemove.includes(n.id);\n\t\t\t})\n\t\t})\n\n\t\t// calculate graph\n\t\tgraph = ParseMatrixData.calculateNetwork(filtered)\n\t\tnodes = graph.nodes;\n\t\tlinks = graph.edges;\n\t})\n\n\tif(doRestart === 'restart the force') {\n\t\tV.update();\n\t}\n}\nconst toggleSubnodes = (d, doRestart) => {\n\t// console.log(\"Ohhhhh, let's toggle the sub nodes of\", d.label, d.id)\n\tif(d.opened) {\n\t\tunselectLabel(d);\n\t\tcloseSubnodes(d, doRestart);\n\t} else if(d.subNodes && d.subNodes.length) {\n\t\tselectLabel(d);\n\t\topenSubnodes(d, doRestart);\n\t} else {\n\t\tconsole.log('No nodes to expand');\n\t}\n}\n\n// Interactions\nconst displayTitle = (arr) => {\n\t// show composition title\n\tinformation = information.data(arr, function(d) { return d.id; });\n\tinformation.exit().remove();\n\tinformation = information.enter().append(\"text\")\n\t\t.classed('information', true)\n\t\t.attr('text-anchor', d => (x(d.year) >= width / 2) ? 'end' : 'start')\n\t\t.attr('x', d => (x(d.year) >= width / 2) ? x(d.year) + 4.8 : x(d.year) - 3.2)\n\t\t.attr('y', height - 10)\n\t\t.text(d => (x(d.year) >= width / 2) ? d.sourceTitle + ' ↓' : '↓ ' + d.sourceTitle)\n\t\t.merge(information);\n}\n\nconst selectLabel = (d) => {\n\tlabel.filter(l => l.id === d.id).classed('selected', true)\n}\nconst unselectLabel = (d) => {\n\tlabel.filter(l => l.id === d.id).classed('selected', false)\n}\n\nconst selectNode = (d) => {\n\tsvg.classed('there-is-selection', true)\n\tnode.filter(n => n.id === d.id).classed('selected', true)\n}\nconst unselectNode = (d) => {\n\tnode.filter(n => n.id === d.id).classed('selected', false)\n\n\tif(svg.selectAll('.selected').size() === 0) {\n\t\tsvg.classed('there-is-selection', false)\n\t}\n}\n\nconst selectSameComposition = (d) => {\n\tsvg.classed('there-is-selection', true)\n\tnode.filter(n => n.source === d.source).classed('selected', true)\n}\nconst unselectSameComposition = (d) => {\n\tnode.filter(n => n.source === d.source).classed('selected', false)\n\n\tif(svg.selectAll('.selected').size() === 0) {\n\t\tsvg.classed('there-is-selection', false)\n\t}\n}\n\nconst reset = () => {\n\tsvg.selectAll('*').classed('selected', false).classed('zoom-selected', false);\n\tsvg.selectAll('.tick').classed('cat-selected', false).selectAll('rect').attr('fill', 'transparent')\n\tsvg.classed('there-is-selection', false)\n\tdisplayTitle([]);\n}\n\nconst exportSelected = () => {\n\tconst selected = svg.selectAll('.selected')\n\tlet selectedData = selected.data()\n\n\tselectedData = d3.nest()\n\t\t.key(d => d.source)\n\t\t.entries(selectedData)\n\t\t.map(d => {\n\t\t\treturn {\n\t\t\t\t'composition_id': d.key,\n\t\t\t\t'composition_title': d.values[0].sourceTitle\n\t\t\t}\n\t\t})\n\n\t// console.log(selectedData);\n\t//\n\t// console.log(globalFilters);\n\n\tlet envs = '';\n\tif(globalFilters.themes.length === 0) {\n\t\tenvs = '👀 No environments selected\\n'\n\t} else {\n\t\tif(globalFilters.themes.length === 7) {\n\t\t\tenvs += `(🐖 All environments)\\n`\n\t\t} else {\n\t\t\tenvs += '\\n'\n\t\t}\n\t\tglobalFilters.themes.forEach((d) => {\n\t\t\tenvs += `- \"${d}\"\\n`;\n\t\t})\n\t}\n\n\tlet pubTypes = '';\n\tif(globalFilters.kinds.length == 0) {\n\t\tpubTypes = '👀 No venues selected\\n'\n\t} else {\n\t\tif(globalFilters.kinds.length === 3) {\n\t\t\tpubTypes += `(🐖 All venues)\\n`\n\t\t} else {\n\t\t\tenvs += '\\n'\n\t\t}\n\t\tglobalFilters.kinds.forEach((d) => {\n\t\t\tpubTypes += `- \"${d}\"\\n`;\n\t\t})\n\t}\n\n\tlet searchedTerm = '- No search'\n\tif(d3.select('.filter-search input').property(\"value\") !== '') searchedTerm = d3.select('.filter-search input').property(\"value\")\n\nconst export_data = `Exporting composition titles highlighted through the following filters:\n\n📚 Publication venues ${pubTypes}\n\n🏞 Environments ${envs}\n\n🕵️‍♀️ Searched term:\n${searchedTerm}\n\ncomposition_id\\tcomposition_title\n${selectedData.map(d=>{\n\treturn d.composition_id + '\\t' + d.composition_title\n}).join(`\n`)}\n`\n\t// console.log(export_data)\n\n\tlet the_date = new Date()\n\n\tthe_date = d3.timeFormat(\"%Y_%m_%d %X\")(the_date)\n\n\tdownload(export_data, `selection [${the_date}].txt`, 'text/plain')\n\n\t// Function to download data to a file\n\tfunction download(data, filename, type) {\n\t\tconsole.log('download')\n\t\tvar file = new Blob([data], { type: type });\n\t\tif(window.navigator.msSaveOrOpenBlob) // IE10+\n\t\t\twindow.navigator.msSaveOrOpenBlob(file, filename);\n\t\telse { // Others\n\t\t\tvar a = document.createElement(\"a\"),\n\t\t\t\turl = URL.createObjectURL(file);\n\t\t\ta.href = url;\n\t\t\ta.download = filename;\n\t\t\tdocument.body.appendChild(a);\n\t\t\ta.click();\n\t\t\tsetTimeout(function() {\n\t\t\t\tdocument.body.removeChild(a);\n\t\t\t\twindow.URL.revokeObjectURL(url);\n\t\t\t}, 0);\n\t\t}\n\t}\n\n}\n\n// trigger actions with keyboard\n\ndocument.addEventListener('keydown', triggerActions);\n\nfunction triggerActions(e) {\n\tif(e.key === 'd') exportSelected();\n\t// if (e.key === 'L') label.classed('make-visible', false)\n}\n\n//\n//\n//\n//\n// convex hull from http://bl.ocks.org/hollasch/f70f1fe7700f092b5a505e3efd1d9232\n//\n//\n//\n//\n\nvar hullPadding = collisionPadding;\n\nvar vecScale = function(scale, v) {\n\t// Returns the vector 'v' scaled by 'scale'.\n\treturn [scale * v[0], scale * v[1]];\n}\n\nvar vecSum = function(pv1, pv2) {\n\t// Returns the sum of two vectors, or a combination of a point and a vector.\n\treturn [pv1[0] + pv2[0], pv1[1] + pv2[1]];\n}\n\nvar unitNormal = function(p0, p1) {\n\t// Returns the unit normal to the line segment from p0 to p1.\n\tvar n = [p0[1] - p1[1], p1[0] - p0[0]];\n\tvar nLength = Math.sqrt(n[0] * n[0] + n[1] * n[1]);\n\treturn [n[0] / nLength, n[1] / nLength];\n};\n\nvar strictHull = function(polyPoints) {\n\t// This method returns a polygon given the specified points. The points are assumed to be in polygon order.\n\treturn (\n\t\t'M ' + polyPoints[0] +\n\t\t' L ' +\n\t\td3.range(1, polyPoints.length)\n\t\t.map(function(i) { return polyPoints[i]; })\n\t\t.join(' L') +\n\t\t' Z'\n\t);\n};\n\nvar roundedHull = function(polyPoints, data) {\n\t// Returns the SVG path data string representing the polygon, expanded and rounded.\n\thullPadding = d3.max(data, function(d) {\n\t\treturn d.opened ? r(1) + collisionPadding : r(d.totalSubNodes + 1) + collisionPadding;\n\t})\n\n\t// Handle special cases\n\tif(!polyPoints || polyPoints.length < 1) return \"\";\n\tif(polyPoints.length === 1) return roundedHull1(polyPoints, data);\n\tif(polyPoints.length === 2) return roundedHull2(polyPoints, data);\n\n\tvar segments = new Array(polyPoints.length);\n\n\t// Calculate each offset (outwards) segment of the convex hull.\n\tfor(var segmentIndex = 0; segmentIndex < segments.length; ++segmentIndex) {\n\t\tvar p0 = (segmentIndex === 0) ? polyPoints[polyPoints.length - 1] : polyPoints[segmentIndex - 1];\n\t\tvar p1 = polyPoints[segmentIndex];\n\n\t\t// Compute the offset vector for the line segment, with length = hullPadding.\n\t\tvar offset = vecScale(hullPadding, unitNormal(p0, p1));\n\n\t\tsegments[segmentIndex] = [vecSum(p0, offset), vecSum(p1, offset)];\n\t}\n\n\tvar arcData = 'A ' + [hullPadding, hullPadding, '0,0,0,'].join(',');\n\n\tsegments = segments.map(function(segment, index) {\n\t\tvar pathFragment = \"\";\n\t\tif(index === 0) {\n\t\t\tvar pathFragment = 'M ' + segments[segments.length - 1][1] + ' ';\n\t\t}\n\t\tpathFragment += arcData + segment[0] + ' L ' + segment[1];\n\n\t\treturn pathFragment;\n\t});\n\n\treturn segments.join(' ');\n}\n\nvar roundedHull1 = function(polyPoints, data) {\n\t// Returns the path for a rounded hull around a single point (a circle).\n\n\tvar p1 = [polyPoints[0][0], polyPoints[0][1] - hullPadding];\n\tvar p2 = [polyPoints[0][0], polyPoints[0][1] + hullPadding];\n\n\treturn 'M ' + p1 +\n\t\t' A ' + [hullPadding, hullPadding, '0,0,0', p2].join(',') +\n\t\t' A ' + [hullPadding, hullPadding, '0,0,0', p1].join(',');\n};\n\nvar roundedHull2 = function(polyPoints, data) {\n\t// Returns the path for a rounded hull around two points (a \"capsule\" shape).\n\n\tvar offsetVector = vecScale(hullPadding, unitNormal(polyPoints[0], polyPoints[1]));\n\tvar invOffsetVector = vecScale(-1, offsetVector);\n\n\tvar p0 = vecSum(polyPoints[0], offsetVector);\n\tvar p1 = vecSum(polyPoints[1], offsetVector);\n\tvar p2 = vecSum(polyPoints[1], invOffsetVector);\n\tvar p3 = vecSum(polyPoints[0], invOffsetVector);\n\n\treturn 'M ' + p0 +\n\t\t' L ' + p1 + ' A ' + [hullPadding, hullPadding, '0,0,0', p2].join(',') +\n\t\t' L ' + p3 + ' A ' + [hullPadding, hullPadding, '0,0,0', p0].join(',');\n};\n","import React, { Component } from 'react';\nimport './PlacesMatrix.css'\nimport V from './matrix.d3'\n\nclass PlacesMatrix extends Component {\n\n  componentDidMount() {\n    console.log('componentDidMount')\n    this._chart = V.initialize(\n        this._rootNode,\n        this.props.data,\n        this.props.filters\n    );\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    console.log('componentDidUpdate')\n\n    if (this.props.filters.openAll !== prevProps.filters.openAll) {\n      if (this.props.filters.openAll) {\n        V.openAll();\n      } else {\n        V.closeAll();\n      }\n    }\n\n    if (this.props.filters.update) {\n      V.update(this.props.filters);\n    }\n    V.filter(this.props.filters, this.props.originalData);\n  }\n\n  componentWillUnmount() {\n    console.log('componentWillUnmount')\n    V.destroy(this._rootNode);\n  }\n\n  _setRef(componentNode) {\n      this._rootNode = componentNode;\n  }\n\n\n  render() {\n    const style={\n      width: '100%',\n      height: '100%'\n    }\n    return <svg id={this.props.id} style={style} ref={this._setRef.bind(this)}></svg>\n  }\n}\n\nexport default PlacesMatrix;\n","import React, { Component } from 'react';\nimport BodyViz from '../general/BodyViz';\nimport MainMenu from '../general/MainMenu';\nimport * as d3 from 'd3';\n\nimport Loading from '../general/Loading';\n\nimport SetOption from '../general/SetOption'\nimport TimeFilter from '../visualizations/TimeFilter'\nimport MultipleSelection from '../general/MultipleSelection'\nimport FilterSearch from '../general/FilterSearch'\n\nimport MoreInfo from '../general/MoreInfo';\n\nimport PlacesMatrix from '../visualizations/PlacesMatrix';\nimport ParseMatrixData from './parse-matrix-data';\n\nclass PlacesMatrixView extends Component {\n\n  constructor(props){\n    super(props);\n    this.loadData = this.loadData.bind(this);\n    this.state = { data:'data still not loaded', isLoading: true };\n    this.openAll = this.openAll.bind(this);\n    this.changeSpan = this.changeSpan.bind(this);\n    this.changePublications = this.changePublications.bind(this);\n    this.changeThemes = this.changeThemes.bind(this);\n    this.searchRecord = this.searchRecord.bind(this);\n    this.resetSearch = this.resetSearch.bind(this);\n  }\n\n  loadData() {\n    d3.tsv('./places-matrix-data.tsv')\n      .then( data => {\n        const graph = ParseMatrixData.parser(data);\n        return graph;\n      })\n      .then(data=>{\n        const themes = [\"fabbrica\",\"guerra\",\"mare\",\"metropoli\",\"natura ligure\",\"paesaggio urbano\",'nessuno']\n        const kinds = ['raccolta','volume','altro']\n        this.setState({\n          data: data.graph,\n          originalData: data.data,\n          dataTimeFilter: d3.extent(data.graph.nodes, d => d.year),\n          themes: themes,\n          publicationsTypes: kinds,\n          searchOptions: [\n            { label: 'luogo', dimension: 'label'},\n            { label: 'raccolta', dimension: 'pubVenueTitle'},\n            { label: 'titolo', dimension:'sourceTitle'}\n          ],\n          isLoading: false,\n          filters: {\n            update: true,\n            openAll: false,\n            themes: themes,\n            kinds: kinds,\n            search: [],\n            span: d3.extent(data.graph.nodes, d => d.year)\n          }\n        })\n      })\n  }\n\n  componentDidMount() {\n    this.loadData();\n  }\n\n  changeSpan(newSpan) {\n    this.setState(prevState => ({\n      filters: {                    // object that we want to update\n        ...prevState.filters,       // keep all other key-value pairs\n        span:newSpan,\n        update: true                // update the value of specific key\n      }\n    }))\n  }\n\n  changePublications(newPublications) {\n    this.setState(prevState => ({\n      filters: {                    // object that we want to update\n        ...prevState.filters,       // keep all other key-value pairs\n        kinds: newPublications,  // update the value of specific key\n        update: false\n      }\n    }))\n  }\n\n  changeThemes(newThemes) {\n    this.setState(prevState => ({\n      filters: {                    // object that we want to update\n        ...prevState.filters,       // keep all other key-value pairs\n        themes: newThemes,  // update the value of specific key\n        update: false\n      }\n    }))\n  }\n\n  searchRecord(searchResults) {\n    this.setState(prevState => ({\n      filters: {                    // object that we want to update\n        ...prevState.filters,       // keep all other key-value pairs\n        search: searchResults,      // update the value of specific key\n        update: false\n      }\n    }))\n  }\n\n  resetSearch() {\n    this.setState(prevState => ({\n      filters: {                    // object that we want to update\n        ...prevState.filters,       // keep all other key-value pairs\n        search: [],\n        update: true\n      }\n    }))\n  }\n\n  openAll(value) {\n    this.setState(prevState => ({\n      filters: {                    // object that we want to update\n        ...prevState.filters,       // keep all other key-value pairs\n        openAll: value,\n        update: true\n      }\n    }))\n  }\n\n  render() {\n    // console.log('filters',this.state.filters)\n    return (\n      <div>\n        <div className=\"the-header\">\n          <MainMenu className=\"main-menu\" style={{gridColumn: 'span 1'}}/>\n\n          { this.state.isLoading && <Loading style={{gridColumn: 'span 2'}} /> }\n          { !this.state.isLoading && <SetOption style={{gridColumn: 'span 2'}} selected={this.openAll} title=\"Apri tutto\"/> }\n\n          { this.state.isLoading && <Loading style={{gridColumn: 'span 6'}} /> }\n          { !this.state.isLoading && <TimeFilter style={{gridColumn: 'span 6'}} data={this.state.dataTimeFilter} changeSpan={this.changeSpan} title=\"Imposta un filtro temporale\"/> }\n\n          { this.state.isLoading && <Loading style={{gridColumn: 'span 4'}} /> }\n          { !this.state.isLoading && <MultipleSelection style={{gridColumn: 'span 4'}} options={this.state.publicationsTypes} changeOptions={this.changePublications} title=\"Tipo di pubblicazione\" id=\"multiple-selection-publications\"/> }\n\n          { this.state.isLoading && <Loading style={{gridColumn: 'span 4'}} /> }\n          { !this.state.isLoading && <MultipleSelection style={{gridColumn: 'span 4'}} options={this.state.themes} changeOptions={this.changeThemes} title=\"Evidenzia un ambiente\" id=\"multiple-selection-themes\"/> }\n\n          { this.state.isLoading && <Loading style={{gridColumn: 'span 6'}} /> }\n          { !this.state.isLoading && <FilterSearch style={{gridColumn: 'span 6'}} data={this.state.data} originalData={this.state.originalData} options={this.state.searchOptions} searchRecord={this.searchRecord} search={this.state.filters.search} resetSearch={this.resetSearch} minLength={1} title=\"Cerca\"/> }\n\n          { this.state.isLoading && <Loading style={{gridColumn: 'span 1'}} /> }\n          { !this.state.isLoading && <MoreInfo style={{gridColumn: 'span 1'}}></MoreInfo>}\n\n        </div>\n\n        <BodyViz className=\"the-body-viz\">\n          { this.state.isLoading && <Loading /> }\n          { !this.state.isLoading && <PlacesMatrix data={this.state.data} originalData={this.state.originalData} filters={this.state.filters} /> }\n        </BodyViz>\n      </div>\n    );\n  }\n}\n\nexport default PlacesMatrixView;\n","import React from 'react';\nimport './App.css';\nimport PlacesMatrixView from './PlacesMatrixView/PlacesMatrixView';\n// import ContainerComp from './ContainerComp/ContainerComp';\n\nfunction App() {\n  return (\n      <PlacesMatrixView />\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}