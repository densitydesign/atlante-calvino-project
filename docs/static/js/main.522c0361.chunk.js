(window["webpackJsonpatlante-calvino-project"]=window["webpackJsonpatlante-calvino-project"]||[]).push([[0],[,,,,,,,,,,,function(t,e,n){t.exports=n(24)},,,,,function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),i=n(9),o=n.n(i),c=(n(16),n(17),n(2)),s=n(3),l=n(5),u=n(4),d=n(7),f=n(6),p=(n(18),function(t){function e(){return Object(c.a)(this,e),Object(l.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{className:"the-header",style:this.props.style},this.props.children)}}]),e}(a.Component)),h=(n(19),function(t){function e(){return Object(c.a)(this,e),Object(l.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{className:this.props.className},this.props.children)}}]),e}(a.Component)),g=(n(20),function(t){function e(){return Object(c.a)(this,e),Object(l.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{className:"main-menu",style:this.props.style},"M")}}]),e}(a.Component)),m=n(1),y=function(t){function e(){return Object(c.a)(this,e),Object(l.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){return r.a.createElement("div",{style:this.props.style},"Loading ...")}}]),e}(a.Component),b=(n(21),{initialize:function(t,e,n){b.changeSpan=n;b.margin={top:0,right:15,bottom:t.getBoundingClientRect().height-20,left:15},b.svg=m.u(t),b.width=t.getBoundingClientRect().width-b.margin.left-b.margin.right,b.height=t.getBoundingClientRect().height-b.margin.top-b.margin.bottom,b.svg.append("defs").append("clipPath").attr("id","timeclip").append("rect").classed("clip",!0).attr("x",0).attr("y",b.margin.top).attr("width",b.width+b.margin.left+b.margin.right).attr("height",b.height).attr("transform","translate("+-b.margin.left+","+-b.margin.top+")"),b.x=m.t().range([0,b.width]).domain(m.f(e,(function(t){return t}))),b.xAxis=m.a(b.x),b.brush=m.c().extent([[0,0],[b.width,b.height]]).handleSize(30).on("brush end",x),b.context=b.svg.append("g").attr("class","context").attr("transform","translate("+b.margin.left+","+b.margin.top+")"),b.info=b.context.append("g").selectAll(".info"),b.line=b.context.append("g").selectAll(".info-line"),b.dotted=b.context.append("g").selectAll(".dotted"),b.context.append("line").attr("x1",0).attr("y1",b.height/2).attr("x2",b.width).attr("y2",b.height/2).attr("stroke","var(--dark-green)"),b.context.append("g").attr("class","brush").call(b.brush).call(b.brush.move,b.x.range())},update:function(t){b.info=b.info.data(t,(function(t){return t})),b.info.exit().remove(),b.info=b.info.enter().append("text").attr("class","info").attr("x",(function(t){return b.x(t)})).attr("y",b.height+b.margin.top+12).attr("text-anchor",(function(t,e){return function(t,n,a){return e%2===0?n(t)>=a/4?"end":"start":n(t)<=a/4*3?"start":"end"}(t,b.x,b.width)})).text((function(t){return t.getFullYear()})).merge(b.info),b.line=b.line.data(t,(function(t){return t})),b.line.exit().remove(),b.line=b.line.enter().append("line").attr("class","info-line").attr("stroke","var(--calvino-red)").attr("stroke-width","2px").attr("x1",(function(t){return b.x(t)})).attr("y1",0).attr("x2",(function(t){return b.x(t)})).attr("y2",b.height).merge(b.line),b.dotted=b.dotted.data([t],(function(t,e){return t})),b.dotted.exit().remove(),b.dotted=b.dotted.enter().append("line").attr("class","dotted").attr("x1",b.info._groups[0][0].getBBox().x+b.info._groups[0][0].getBBox().width+5).attr("x2",b.info._groups[0][1].getBBox().x-5).attr("y1",b.height+b.margin.top+6).attr("y2",b.height+b.margin.top+6).attr("stroke-width","1.5px").attr("stroke","var(--dark-green)").attr("stroke-linecap","round").attr("stroke-dasharray","0,15").merge(b.dotted)},destroy:function(t){}}),v=b;function x(){if((!m.e.sourceEvent||"zoom"!==m.e.sourceEvent.type)&&m.e.selection){var t=m.e.selection||b.x.range();t=t.map((function(t){return b.x.invert(t)})),b.changeSpan(t),t=t.map((function(t){return new Date(t)})),b.update(t)}}var k=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(l.a)(this,Object(u.a)(e).call(this,t))).changeSpan=n.changeSpan.bind(Object(d.a)(n)),n}return Object(f.a)(e,t),Object(s.a)(e,[{key:"changeSpan",value:function(t){this.props.changeSpan(t)}},{key:"componentDidMount",value:function(){this._chart=v.initialize(this._rootNode,this.props.data,this.changeSpan)}},{key:"componentDidUpdate",value:function(){}},{key:"componentWillUnmount",value:function(){v.destroy(this._rootNode)}},{key:"_setRef",value:function(t){this._rootNode=t}},{key:"render",value:function(){return r.a.createElement("div",{style:this.props.style},r.a.createElement("h5",null,this.props.title),r.a.createElement("svg",{id:"time-filter",ref:this._setRef.bind(this)}))}}]),e}(a.Component),j=k;k.defaultProps={title:"Time Filter"};var O=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(l.a)(this,Object(u.a)(e).call(this,t))).handleChange=n.handleChange.bind(Object(d.a)(n)),n}return Object(f.a)(e,t),Object(s.a)(e,[{key:"handleChange",value:function(t){var e=t.target.value;this.props.changeOptions(e)}},{key:"render",value:function(){return r.a.createElement("div",{style:this.props.style},r.a.createElement("h5",null,this.props.title),r.a.createElement("select",{id:this.props.id,onChange:this.handleChange},this.props.options.map((function(t,e){return r.a.createElement("option",{key:e},t)}))))}}]),e}(a.Component),E=O;O.defaultProps={title:"Select an option"};n(22);var N=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(l.a)(this,Object(u.a)(e).call(this,t))).handleChange=n.handleChange.bind(Object(d.a)(n)),n}return Object(f.a)(e,t),Object(s.a)(e,[{key:"handleChange",value:function(t){var e=t.target.checked;this.props.selected(e)}},{key:"render",value:function(){return r.a.createElement("div",{className:"set-option",style:this.props.style},r.a.createElement("h5",null,this.props.title),r.a.createElement("label",{className:"switch"},r.a.createElement("input",{type:"checkbox",onChange:this.handleChange}),r.a.createElement("span",{className:"slider round"})))}}]),e}(a.Component),S=N;N.defaultProps={title:"Option"};n(23);var w,C,_,A,T,z,L,P,D,B,F,R,M,U,W,I,q,H,J,G,Y={parser:function(t){t.forEach((function(t){t.year=new Date(t.year)}));var e=t.map((function(t){return t.year=new Date(t.year),t.id||(t.id=t["data.id"]),{id:t.id,label:t.Occorrenza,part_of:t["Parte di ID"],source:t.Fonte,sourceTitle:t["Titolo Fonte"],year:+t.year,category:t.Categoria,totalSubNodes:0,publicationType:t["Pubblicazione Fonte"],isGuessed:t["Luogo desunto"],themes:t.Tema}}));return e=Y.handleHierarchies(e),Y.calculateNetwork(e)},handleHierarchies:function(t){var e=m.n().key((function(t){return t.part_of})).entries(t);return e.filter((function(t){return""===t.key}))[0].values.forEach((function(t){var n=e.find((function(e){return e.key===t.id}));n&&(t.subNodes=n.values,t.totalSubNodes=n.values.length,n.values.forEach((function(n){var a=e.find((function(t){return t.key===n.id}));a&&(n.subNodes=a.values,n.totalSubNodes=a.values.length,t.totalSubNodes+=n.totalSubNodes,a.values.forEach((function(n){var a=e.find((function(t){return t.key===n.id}));a&&(n.subNodes=a.values,n.totalSubNodes=a.values.length,t.totalSubNodes+=n.totalSubNodes,a.values.forEach((function(a){var r=e.find((function(t){return t.key===a.id}));r&&(a.subNodes=r.values,a.totalSubNodes=r.values.length,t.totalSubNodes+=n.totalSubNodes)})))})))})))})),e.filter((function(t){return""===t.key}))[0].values},calculateNetwork:function(t){var e=[];return m.n().key((function(t){return t.source})).entries(t).forEach((function(t){t.values.filter((function(t){return""!==t.part_of})).forEach((function(n,a){var r;r={source:n.id,target:n.part_of,volume:t.key,source_part_of:n.part_of,kind:"part_of"},e.push(r)}))})),{nodes:t,edges:e,root_nodes:t.filter((function(t){return t.subNodes}))}}},$=Y,K={},Q=["generico_non_terrestre","nominato_non_terrestre","nominato_terrestre","generico_terrestre","inventato","no_ambientazione"],V=["#3131ff","#bbbbff","#ffce00","#ff6c39","#00c19c","#cecece"],X=[],Z=[],tt=[],et=0,nt=!1;function at(){q.style("opacity",1),H.classed("selected",!1).style("display","none"),(J=J.data([],(function(t){return t.id}))).exit().remove()}function rt(t,e){if(t.opened){t.opened=!1,t.fx=null,t.fy=null;var n=[],a=[t.id];return function t(e){e.subNodes.forEach((function(e){e.opened&&(e.opened=!1,a.push(e.id),t(e))})),n.push(e.subNodes)}(t),n.forEach((function(t){var e=t.map((function(t){return t.id})),n=X.filter((function(t){return!e.includes(t.id)}));(tt=tt.filter((function(t){return!a.includes(t[0].id)}))).forEach((function(t,n){tt[n]=t.filter((function(t){return!e.includes(t.id)}))})),w=$.calculateNetwork(n)})),void(!1!==e&&K.update(w,C))}if(t.subNodes&&t.subNodes.length){t.subNodes.forEach((function(e,n){n>0&&(e.x=t.x,e.y=t.y)})),t.opened=!0;var r=[t].concat(t.subNodes);tt.push(r),tt.forEach((function(t){t.indexOf(r[0])>0&&r.forEach((function(e,n){0!==n&&t.push(e)}))}));var i=X.concat(t.subNodes);w=$.calculateNetwork(i),X=w.nodes,Z=w.edges,!1!==e&&K.update(w,C)}else console.log("No nodes to expand")}L={top:0,right:50,bottom:75,left:50},K.initialize=function(t,e,n){console.log("init",e,n),(w=e).rootNodes,R=m.u(t).style("touch-action","manipulation"),P=R.node().getBoundingClientRect().width-L.left-L.right,D=R.node().getBoundingClientRect().height-L.top-L.bottom,_=m.t().range([0,P]).domain(m.f(e.nodes,(function(t){return t.year}))),B=m.a(_),A=m.r().range([0,D]).padding(.5),F=m.b(A).tickSize(P).tickFormat((function(t){return t=t.replace(/_/g," ")})),A.domain(Q),T=m.s().exponent(.5).range([3.5,25]).domain([1,m.m(e.nodes,(function(t){return t.totalSubNodes}))]),z=m.q().domain(Q).range(V),R.append("rect").classed("reset",!0).attr("x",L.left).attr("width",P).attr("height",D).attr("fill","transparent").on("click",at),M=R.append("g").attr("transform","translate(".concat(L.left,",").concat(L.top,")")),U=M.append("g").attr("class","x-axis"),M.append("g").attr("class","y-axis").attr("transform","translate(0, 0)").call(F).call((function(t){return t.selectAll(".tick text").style("text-transform","capitalize")})).call((function(t){return t.select(".domain").remove()})).call((function(t){return t.selectAll(".tick line").attr("stroke-opacity",.5).attr("stroke-dasharray","2,2")})).call((function(t){return t.selectAll(".tick text").attr("x",4).attr("dy",-A.step()/10)})),I=M.append("g").classed("links",!0).selectAll(".link"),W=M.append("g").classed("hulls",!0).selectAll(".hull"),q=M.append("g").classed("nodes",!0).selectAll(".node"),H=M.append("g").classed("labels",!0).selectAll(".label"),J=M.append("g").classed("informations",!0).selectAll(".information"),G=m.j(X).force("charge",m.i().strength(-1)).force("link",m.h().strength(.35).distance(T.range()[0]+1).id((function(t){return t.id}))).force("x",m.k((function(t){return t.x})).strength((function(t){return""===t.part_of?1:0}))).force("y",m.l((function(t){return t.y})).strength((function(t){return""===t.part_of?.7:0}))).force("collision",m.g((function(t){return t.opened?T(1)+.75:T(t.totalSubNodes+1)+.75})).iterations(32).strength(.5)).on("tick",(function(){q.attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})),H.attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})),I.attr("x1",(function(t){return t.source.x})).attr("y1",(function(t){return t.source.y})).attr("x2",(function(t){return t.target.x})).attr("y2",(function(t){return t.target.y})),W.attr("d",(function(t){var e=t.map((function(t){return[t.x,t.y]})),n=e.length<3?e:m.o(e);return ut(n,t)}))})).on("end",(function(){console.log("simulation ended")})).stop(),K.update(e,n)},K.update=function(t,e){console.log("update viz"),t||(t=w),X=t.nodes,Z=t.edges,e&&(C=e,e.openAll!=nt&&(console.log("open or close all",e.openAll),nt=e.openAll),e.timeFilter&&(X=X.filter((function(t){var n=new Date(t.year);return n>=e.timeFilter[0]&&n<=e.timeFilter[1]}))),e.selectedPublications&&("tutti"===e.selectedPublications?q.classed("faded",!1):q.classed("faded",!1).classed("faded",(function(t){return"altro"===e.selectedPublications?""==!t.publicationType:!t.publicationType.includes(e.selectedPublications)}))),e.selectedThemes&&("tutti"===e.selectedThemes?q.classed("faded",!1):q.classed("faded",!1).classed("faded",(function(t){return!t.themes||!t.themes.includes(e.selectedThemes)})))),e.update&&(_.domain(m.f(X,(function(t){return t.year}))),U.attr("transform","translate(".concat(0,", ",D,")")).call(B),t.nodes.forEach((function(t){t.opened&&(t.fx=_(t.year)),t.x=_(t.year),t.y=A(t.category)})),G.force("x").x((function(t){return t.x})),(q=q.data(X,(function(t){return t.id}))).exit().remove(),q=q.enter().append("circle").attr("class",(function(t){return"node"})).on("click",(function(t){[t].forEach((function(t){q.filter((function(e){return e.source!==t.source})).style("opacity",.1),H.filter((function(e){return t.id===e.id})).classed("selected",!0).style("display","block")})),(J=J.data([t],(function(t){return t.id}))).exit().remove(),J=J.enter().append("text").classed("information",!0).classed("label",!0).attr("text-anchor",(function(t){return _(t.year)>=P/2?"end":"start"})).attr("x",(function(t){return _(t.year)>=P/2?_(t.year)+4.8:_(t.year)-3.2})).attr("y",D-10).text((function(t){return _(t.year)>=P/2?t.sourceTitle+" \u2193":"\u2193 "+t.sourceTitle})).merge(J),m.e.timeStamp-et<500&&(t.fx=1*t.x,t.fy=1*t.y,rt(t)),et=m.e.timeStamp})).attr("key",(function(t){return t.id})).attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).merge(q).style("cursor",(function(t){return t.subNodes&&t.subNodes.length?"pointer":"auto"})).attr("fill",(function(t){return!0===t.opened?"white":z(t.category)})).attr("stroke",(function(t){if(t.totalSubNodes>0)return m.d(z(t.category)).darker(.7)})).style("opacity",1).attr("r",(function(t){return t.opened?T(1):T(t.totalSubNodes+1)})),(I=I.data(Z,(function(t){return t.source.id+"-"+t.target.id}))).exit().remove(),I=I.enter().append("line").classed("link",!0).classed("part-of",(function(t){return"part_of"===t.kind})).attr("stroke-width",.5).attr("stroke","#ccc").on("click",(function(t){return console.log(t)})).merge(I),(H=H.data(X,(function(t){return t.id}))).exit().remove(),H=H.enter().append("text").classed("label",!0).style("display","none").attr("text-anchor","middle").style("pointer-events","none").text((function(t){return t.label})).merge(H),(W=W.data(tt,(function(t){return t[0].id}))).exit().remove(),W=W.enter().append("path").classed("hull",!0).attr("fill",(function(t){return z(t[0].category)})).style("opacity",.25).on("click",(function(t){m.e.timeStamp-et<500&&rt(t[0]),et=m.e.timeStamp})).merge(W),G.nodes(X),G.force("link").links(Z),G.alpha(1).restart())},K.destroy=function(){};var it=K,ot=.75,ct=function(t,e){return[t*e[0],t*e[1]]},st=function(t,e){return[t[0]+e[0],t[1]+e[1]]},lt=function(t,e){var n=[t[1]-e[1],e[0]-t[0]],a=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return[n[0]/a,n[1]/a]},ut=function(t,e){if(ot=m.m(e,(function(t){return t.opened?T(1)+.75:T(t.totalSubNodes+1)+.75})),!t||t.length<1)return"";if(1===t.length)return dt(t,e);if(2===t.length)return ft(t,e);for(var n=new Array(t.length),a=0;a<n.length;++a){var r=0===a?t[t.length-1]:t[a-1],i=t[a],o=ct(ot,lt(r,i));n[a]=[st(r,o),st(i,o)]}var c="A "+[ot,ot,"0,0,0,"].join(",");return(n=n.map((function(t,e){var a="";if(0===e)a="M "+n[n.length-1][1]+" ";return a+=c+t[0]+" L "+t[1]}))).join(" ")},dt=function(t,e){var n=[t[0][0],t[0][1]-ot],a=[t[0][0],t[0][1]+ot];return"M "+n+" A "+[ot,ot,"0,0,0",a].join(",")+" A "+[ot,ot,"0,0,0",n].join(",")},ft=function(t,e){var n=ct(ot,lt(t[0],t[1])),a=ct(-1,n),r=st(t[0],n),i=st(t[1],n),o=st(t[1],a),c=st(t[0],a);return"M "+r+" L "+i+" A "+[ot,ot,"0,0,0",o].join(",")+" L "+c+" A "+[ot,ot,"0,0,0",r].join(",")},pt=function(t){function e(){return Object(c.a)(this,e),Object(l.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){this._chart=it.initialize(this._rootNode,this.props.data,this.props.filters)}},{key:"componentDidUpdate",value:function(){it.update(null,this.props.filters)}},{key:"componentWillUnmount",value:function(){it.destroy(this._rootNode)}},{key:"_setRef",value:function(t){this._rootNode=t}},{key:"render",value:function(){return r.a.createElement("svg",{id:this.props.id,style:{width:"100%",height:"100%"},ref:this._setRef.bind(this)})}}]),e}(a.Component),ht=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(l.a)(this,Object(u.a)(e).call(this,t))).loadData=n.loadData.bind(Object(d.a)(n)),n.state={data:"data still not loaded",isLoading:!0,openAll:!1},n.changeSpan=n.changeSpan.bind(Object(d.a)(n)),n.changeThemes=n.changeThemes.bind(Object(d.a)(n)),n.changePublications=n.changePublications.bind(Object(d.a)(n)),n.openAll=n.openAll.bind(Object(d.a)(n)),n}return Object(f.a)(e,t),Object(s.a)(e,[{key:"loadData",value:function(){var t=this;m.v("./places-matrix-data.tsv").then((function(t){return $.parser(t)})).then((function(e){t.setState({data:e,dataTimeFilter:m.f(e.nodes,(function(t){return t.year})),themes:["tutti","fabbrica","guerra","mare","metropoli","natura ligure","paesaggio urbano","protagonista bambino","viaggio"],publicationsTypes:["tutti","raccolta","volume","altro"],isLoading:!1,filters:{update:!0,openAll:!1}})}))}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"changeSpan",value:function(t){this.setState({span:t,filters:{timeFilter:t,update:!0}})}},{key:"changeThemes",value:function(t){this.setState({filters:{selectedThemes:t,update:!1}})}},{key:"changePublications",value:function(t){this.setState({filters:{selectedPublications:t,update:!1}})}},{key:"openAll",value:function(t){this.setState({filters:{openAll:t,update:!0}})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(p,null,r.a.createElement(g,{style:{gridColumn:"span 1"}}),r.a.createElement("div",{style:{gridColumn:"span 2"}}),r.a.createElement(S,{style:{gridColumn:"span 2",display:"none"},selected:this.openAll,title:"Apri tutto"}),this.state.isLoading&&r.a.createElement(y,{style:{gridColumn:"span 6"}}),!this.state.isLoading&&r.a.createElement(j,{style:{gridColumn:"span 6"},data:this.state.dataTimeFilter,changeSpan:this.changeSpan,title:"Imposta un filtro temporale"}),this.state.isLoading&&r.a.createElement(y,{style:{gridColumn:"span 4"}}),!this.state.isLoading&&r.a.createElement(E,{style:{gridColumn:"span 4"},options:this.state.publicationsTypes,changeOptions:this.changePublications,title:"Tipo di pubblicazione"}),this.state.isLoading&&r.a.createElement(y,{style:{gridColumn:"span 4"}}),!this.state.isLoading&&r.a.createElement(E,{style:{gridColumn:"span 4"},options:this.state.themes,changeOptions:this.changeThemes,title:"Evidenzia un tema"}),r.a.createElement("div",{style:{gridColumn:"span 6"}},"ricerca"),r.a.createElement("div",{style:{gridColumn:"span 1"}},"help")),r.a.createElement(h,{className:"the-body-viz"},this.state.isLoading&&r.a.createElement(y,null),!this.state.isLoading&&r.a.createElement(pt,{data:this.state.data,filters:this.state.filters})))}}]),e}(a.Component);var gt=function(){return r.a.createElement(ht,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(gt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}],[[11,1,2]]]);
//# sourceMappingURL=main.522c0361.chunk.js.map